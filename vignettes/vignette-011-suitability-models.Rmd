---
title: "vignette-011-suitability-models"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{vignette-011-suitability-models}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: inline
bibliography: references.bib
link-citations: yes
---

```{r, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

How to Build, Evaluate, and Save Ecological Niche Models of Suitability for *Ailanthus altissima* (TOH) and *Lycorma delicatula* (SLF)

***

This vignette is designed to demonstrate the workflow that lead to the creation of the three suitability models used to assess the risk of *Lycorma* paninvasion. The description will not include actual running of some steps of this workflow, as some are unwieldy. Instead, information to ensure proper replication of those steps is provided. Notably, the maxent runs are not conducted in this vignette, although the means to do so within `R` may be possible.

The scope of this vignette is as follows:

  1. Reading and Visualization of Presence Data
  2. Preparation of Spatial Data
  3. Evaluation of Spatial Data Collinearity
  4. Building and evaluating Maxent SDMs for the three models
  5. Conversion of Maxent Output from ASCII to GEOTIFF
  6. Extraction of Summary Statistics by Geopolitical Unit from Maxent models

# Setup

We load the packages that are necessary to complete any analyses that allow us to demonstrate the workflow. Packages may include comments to clarify their purpose or the steps in which they are used.

```{r setup, warning=FALSE, results='hide', message=FALSE}
library(slfrsk) #this package
library(tidyverse)  #data manipulation
library(here) #making directory pathways easier on different instances
library(ENMTools) #enviro collinearity analyses
library(patchwork) #easy combined plots
```

# 1. Reading and Visualization of Presence Data

We built models of both SLF and TOH from presence records obtained from public and collaborator databases (queried 24-09-2018 and 26-09-2018, respectively; @kim_molecular_2013, @gbif_gbif:_2019). As is standard practice, we checked all records for quality, removed duplicate and imprecise records, and obtained 8,578 TOH and 145 SLF unique and cleaned presence records.

```{r read in presence records and show on a quick map, fig.height= 10, fig.width=10}
#load data
data("slf_points")
data("toh_points")

#plot points on map: TOH
map_toh <- ggplot() +
  geom_polygon(data = map_data('world'), aes(x = long, y = lat, group = group), fill = "#778899", color = "black", lwd = 0.15) + #world map
  geom_point(data = toh_points, aes(x = x, y = y), color = "blue") +
  theme_bw() +
  labs(x = "", y = "") +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "#6699cc")) +
  coord_quickmap(xlim = c(-164.5, 163.5), ylim = c(-55,85)) +
  ggtitle(label = "TOH Presence")

#plot points on map: SLF
map_slf <- ggplot() +
  geom_polygon(data = map_data('world'), aes(x = long, y = lat, group = group), fill = "#778899", color = "black", lwd = 0.15) + #world map
  geom_point(data = slf_points, aes(x = x, y = y), color = "red") +
  theme_bw() +
  labs(x = "", y = "") +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "#6699cc")) +
  coord_quickmap(xlim = c(-164.5, 163.5), ylim = c(-55,85)) +
  ggtitle(label = "SLF Presence")

#patchwork output of both maps
map_toh / map_slf

```

# 2. Preparation of Spatial Data

To discern which environmental variables to use in the species distribution models (SDMs), we had to minimize collinearity among included covariates (@peterson_ecological_2011). To do so, we estimated pairwise correlation coefficients for 22 global raster covariates hypothesized to influence SLF and TOH distributions: the 20 WorldClim topographic and bioclimatic variables (@hijmans_very_2005, @fick_worldclim_2017), forest height (@simard_mapping_2011),  and access to cities (@weiss_global_2018). 

For tractability of modeling at a global scale, we first downsized the resolution of these covariate rasters with `raster::aggregate(fact = 2, fun = mean, expand = TRUE, na.rm = TRUE)` and cropped their extent to $[-180, 180]$ for latitude and  $[-60, 84]$ for longitude.

```{r}
#WRITING CHUNKS TO HOLD
#We fit these covariates combined to SLF and TOH presences, but BIO02 and ELEV explained <1.0% of the variation, so we removed these two covariates and refit the remaining covariates under default settings (v3.4.1) except for the availability of all model features and an applied threshold rule of "minimum training presence" (Phillips et al. 2006, Pearson et al. 2007). 
```

With the correlations, we identified 6 of the 22 covariates that had minimal cross-correlations: annual mean temperature (**BIO01**), mean diurnal temperature range (**BIO02**), annual precipitation (**BIO12**), precipitation seasonality (**BIO15**), elevation (**ELEV**), and access to cities (**ATC**). 


# Visualize Models

# Save Models

# References
