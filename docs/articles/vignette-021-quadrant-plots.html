<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>vignette-021-quadrant-plots â€¢ slfrsk</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="vignette-021-quadrant-plots">
<meta property="og:description" content="slfrsk">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">slfrsk</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">9999.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette-010-tidy-data.html">vignette-010-tidy-data</a>
    </li>
    <li>
      <a href="../articles/vignette-021-quadrant-plots.html">vignette-021-quadrant-plots</a>
    </li>
    <li>
      <a href="../articles/vignette-030-risk-maps.html">vignette-030-risk-maps</a>
    </li>
    <li>
      <a href="../articles/vignette-040-ee-data.html">vignette-040-ee-data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="vignette-021-quadrant-plots_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>vignette-021-quadrant-plots</h1>
            
      
      
      <div class="hidden name"><code>vignette-021-quadrant-plots.Rmd</code></div>

    </div>

    
    
<p>new edited version of the correlation plots</p>
<div id="to-do" class="section level1">
<h1 class="hasAnchor">
<a href="#to-do" class="anchor"></a>To do:</h1>
<ol style="list-style-type: decimal">
<li><strong>V1 : <del>Stack the two figures</del>, <del>flip the axes</del>, <del>include the legend</del>, <del>remove the quadrant labels</del>, <del>make it so that the small white points are visible</del>.</strong></li>
</ol>
<ul>
<li><del>labeling is wrong on the corrplots for states relative to the infected</del></li>
<li><del>rm observed max suitability in boxplot names</del></li>
<li><del>rm the outliers for boxplots</del></li>
<li><del>scale up the size for the points in the scatter</del></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>V2: Same as V1, but remove the boxplots.</li>
<li>V3: Same as V2, but plot colored symbols to indicate the means of yes/no wine.</li>
<li>V4: Same as V3, but remove the individual points for the states/countries and plot points with SEs on both axes.</li>
</ol>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">slfrsk</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">here</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggrepel</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">grid</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">gridExtra</span>) <span class="co">#only needed if one uses grid.arrange() in plotting</span></pre></body></html></div>
</div>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<div id="read-in-data" class="section level2">
<h2 class="hasAnchor">
<a href="#read-in-data" class="anchor"></a>Read in data</h2>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"states_summary_present"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"states_summary_future"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"countries_summary_present"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"countries_summary_future"</span>)</pre></body></html></div>
</div>
<div id="toggle-different-versions" class="section level2">
<h2 class="hasAnchor">
<a href="#toggle-different-versions" class="anchor"></a>Toggle different versions</h2>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># Set these variables to run different versions of the figures.</span>
<span class="co"># Make transport scaled between one and zero (but note that establishment must be uncommented below)</span>
<span class="no">one_zero</span> <span class="kw">&lt;-</span> <span class="fl">TRUE</span>

<span class="co"># Replace this with max mean quantile_0.50 quantile_0.75 quantile_0.90 to edit which metric to plot for establishment</span>
<span class="co">#to run this, one needs to use different extract data sources further back in the cleaning process (vig01) by selecting a different variable</span>
<span class="co">#estab_to_plot &lt;- "max" # max was used for the quadrant figures</span>

<span class="co"># Need a flag to switch if we want present or future infected states transport</span>
<span class="no">present_transport</span> <span class="kw">&lt;-</span> <span class="fl">FALSE</span>

<span class="co"># Set what type of multiple correlation you want to calculate</span>
<span class="no">method_cor</span> <span class="kw">&lt;-</span> <span class="st">"spearman"</span>

<span class="co"># set whether to look at grape yield or wine production primarily NOTE THAT PLOTS ARE NOT CLEAN FOR WINE!!!</span>
<span class="co">#impact_prod &lt;- "wine"</span>
<span class="no">impact_prod</span> <span class="kw">&lt;-</span> <span class="st">"grapes"</span>

<span class="co"># Plot the native countries?</span>
<span class="no">native</span> <span class="kw">&lt;-</span> <span class="fl">TRUE</span>

<span class="co"># remove unnecessary "countries" NOTE USA IS REMOVED HERE</span>
<span class="co">#Philippines is also removed, as the grape yield data for it was several orders of magnitude smaller than anything else reported and so close to zero that it caused log transformation scaling issues</span>
<span class="no">rem_usa</span> <span class="kw">&lt;-</span> <span class="fl">TRUE</span>

<span class="co"># If you want to label both of the countries (or states) with established SLF</span>
<span class="no">label.JPN.KOR</span> <span class="kw">&lt;-</span> <span class="fl">TRUE</span>
<span class="no">label.us.infected</span> <span class="kw">&lt;-</span> <span class="fl">TRUE</span>   <span class="co">#PRESENT: adding DE, MD, NJ  FUTURE: adding DE, MD, NJ, OH, WV</span>

<span class="co"># If you want the legend plotted on the states scatter?</span>
<span class="co"># plot_state_legend &lt;- TRUE</span></pre></body></html></div>
<p>rescale the trade mass data to be between zero and one or <span class="math inline">\(log_{10}(+1)\)</span> transform the regular version.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># scale the import data</span>

<span class="kw">if</span>(<span class="no">one_zero</span>){
  <span class="no">states_summary_present</span> <span class="kw">&lt;-</span> <span class="no">states_summary_present</span> <span class="kw">%&gt;%</span>
    <span class="co"># transport</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span>(<span class="no">avg_infected_mass</span>+<span class="fl">1</span>)) <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> (<span class="no">avg_infected_mass_scaled</span> - <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">avg_infected_mass_scaled</span>))) <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="no">avg_infected_mass_scaled</span> / <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">avg_infected_mass_scaled</span>)) <span class="kw">%&gt;%</span>
    <span class="co"># establishment</span>
    <span class="fu">mutate</span>(<span class="kw">grand_mean_max_scaled</span> <span class="kw">=</span> <span class="no">grand_mean_max</span>)
  <span class="co"># mutate(grand_mean_max_scaled = (grand_mean_max - min(grand_mean_max))) %&gt;%</span>
  <span class="co"># mutate(grand_mean_max_scaled = grand_mean_max_scaled / max(grand_mean_max_scaled))</span>
  <span class="no">states_summary_future</span> <span class="kw">&lt;-</span> <span class="no">states_summary_future</span> <span class="kw">%&gt;%</span>
    <span class="co"># transport</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span>(<span class="no">avg_infected_mass</span>+<span class="fl">1</span>)) <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> (<span class="no">avg_infected_mass_scaled</span> - <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">avg_infected_mass_scaled</span>))) <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="no">avg_infected_mass_scaled</span> / <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">avg_infected_mass_scaled</span>)) <span class="kw">%&gt;%</span>
    <span class="co"># establishment</span>
    <span class="fu">mutate</span>(<span class="kw">grand_mean_max_scaled</span> <span class="kw">=</span> <span class="no">grand_mean_max</span>)

} <span class="kw">else</span> {
  <span class="no">states_summary_present</span> <span class="kw">&lt;-</span> <span class="no">states_summary_present</span> <span class="kw">%&gt;%</span>
    <span class="co"># transport</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">avg_infected_mass</span>+<span class="fl">1</span>)) <span class="co"># %&gt;%</span>
  <span class="co">#mutate(avg_infected_mass_scaled = scale(avg_infected_mass_scaled)) %&gt;%</span>
    <span class="co"># establishment</span>
  <span class="co">#mutate(grand_mean_max_scaled = scale(grand_mean_max))</span>
  <span class="no">states_summary_future</span> <span class="kw">&lt;-</span> <span class="no">states_summary_future</span> <span class="kw">%&gt;%</span>
    <span class="co"># transport</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">avg_infected_mass</span>+<span class="fl">1</span>))

}</pre></body></html></div>
<p>Modify the native countries established category</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="kw">if</span>(<span class="no">native</span>){
  <span class="no">countries_summary_present</span>$<span class="no">status</span>[<span class="no">countries_summary_present</span>$<span class="no">geopol_unit</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"China"</span>, <span class="st">"India"</span>, <span class="st">"Taiwan"</span>, <span class="st">"Vietnam"</span>)] <span class="kw">&lt;-</span> <span class="st">"native"</span>
  <span class="no">countries_summary_future</span>$<span class="no">status</span>[<span class="no">countries_summary_future</span>$<span class="no">geopol_unit</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"China"</span>, <span class="st">"India"</span>, <span class="st">"Taiwan"</span>, <span class="st">"Vietnam"</span>)] <span class="kw">&lt;-</span> <span class="st">"native"</span>

} <span class="kw">else</span> {
  <span class="no">countries_summary_present</span>$<span class="no">status</span>[<span class="no">countries_summary_present</span>$<span class="no">geopol_unit</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"China"</span>, <span class="st">"India"</span>, <span class="st">"Taiwan"</span>, <span class="st">"Vietnam"</span>)] <span class="kw">&lt;-</span> <span class="st">"not established"</span>
  <span class="no">countries_summary_future</span>$<span class="no">status</span>[<span class="no">countries_summary_future</span>$<span class="no">geopol_unit</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"China"</span>, <span class="st">"India"</span>, <span class="st">"Taiwan"</span>, <span class="st">"Vietnam"</span>)] <span class="kw">&lt;-</span> <span class="st">"not established"</span>

  }</pre></body></html></div>
<p>Remove Unnecessary Countries</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="kw">if</span>(<span class="no">rem_usa</span>){ <span class="co"># TRUE if you want to remove the USA</span>
  <span class="no">rems</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Akrotiri and Dhekelia"</span>
            ,<span class="st">"?land"</span>
            ,<span class="st">"American Samoa"</span>
            ,<span class="st">"Bouvet Island"</span>
            ,<span class="st">"British Indian Ocean Territory"</span>
            ,<span class="st">"Caspian Sea"</span>
            ,<span class="st">"Christmas Island"</span>
            ,<span class="st">"Clipperton Island"</span>
            ,<span class="st">"Cocos Islands"</span>
            ,<span class="st">"Falkland Islands"</span>
            ,<span class="st">"Faroe Islands"</span>
            ,<span class="st">"French Southern Territories"</span>
            ,<span class="st">"Heard Island and McDonald Islands"</span>
            ,<span class="st">"Mayotte"</span>
            ,<span class="st">"Northern Mariana Islands"</span>
            ,<span class="st">"Paracel Islands"</span>
            ,<span class="st">"Pitcairn Islands"</span>
            ,<span class="st">"Saint Pierre and Miquelon"</span>
            ,<span class="st">"Tokelau"</span>
            ,<span class="st">"United States Minor Outlying Islands"</span>
            ,<span class="st">"Wallis and Futuna"</span>
            ,<span class="st">"United States"</span>
            ,<span class="st">"Philippines"</span>)
} <span class="kw">else</span> {
  <span class="no">rems</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Akrotiri and Dhekelia"</span>
            ,<span class="st">"?land"</span>
            ,<span class="st">"American Samoa"</span>
            ,<span class="st">"Bouvet Island"</span>
            ,<span class="st">"British Indian Ocean Territory"</span>
            ,<span class="st">"Caspian Sea"</span>
            ,<span class="st">"Christmas Island"</span>
            ,<span class="st">"Clipperton Island"</span>
            ,<span class="st">"Cocos Islands"</span>
            ,<span class="st">"Falkland Islands"</span>
            ,<span class="st">"Faroe Islands"</span>
            ,<span class="st">"French Southern Territories"</span>
            ,<span class="st">"Heard Island and McDonald Islands"</span>
            ,<span class="st">"Mayotte"</span>
            ,<span class="st">"Northern Mariana Islands"</span>
            ,<span class="st">"Paracel Islands"</span>
            ,<span class="st">"Pitcairn Islands"</span>
            ,<span class="st">"Saint Pierre and Miquelon"</span>
            ,<span class="st">"Tokelau"</span>
            ,<span class="st">"United States Minor Outlying Islands"</span>
            ,<span class="st">"Wallis and Futuna"</span>
            ,<span class="st">"Philippines"</span>)

}

<span class="co">#do the rm now</span>
<span class="no">countries_summary_present</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_present</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="no">ID</span> <span class="kw">%in%</span> <span class="no">rems</span>)
<span class="no">countries_summary_future</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_future</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="no">ID</span> <span class="kw">%in%</span> <span class="no">rems</span>)</pre></body></html></div>
<p>Now rescale countries as states</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co"># scale the import data</span>

<span class="kw">if</span>(<span class="no">one_zero</span>){

  <span class="no">countries_summary_present</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_present</span> <span class="kw">%&gt;%</span>
    <span class="co"># transport</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span>(<span class="no">avg_infected_mass</span>+<span class="fl">1</span>)) <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> (<span class="no">avg_infected_mass_scaled</span> - <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">avg_infected_mass_scaled</span>))) <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="no">avg_infected_mass_scaled</span> / <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">avg_infected_mass_scaled</span>)) <span class="kw">%&gt;%</span>
    <span class="co"># establishment</span>
    <span class="fu">mutate</span>(<span class="kw">grand_mean_max_scaled</span> <span class="kw">=</span> <span class="no">grand_mean_max</span>)
  <span class="co"># mutate(grand_mean_max_scaled = (grand_mean_max - min(grand_mean_max))) %&gt;%</span>
  <span class="co"># mutate(grand_mean_max_scaled = grand_mean_max_scaled / max(grand_mean_max_scaled))</span>

  <span class="no">countries_summary_future</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_future</span> <span class="kw">%&gt;%</span>
    <span class="co"># transport</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span>(<span class="no">avg_infected_mass</span>+<span class="fl">1</span>)) <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> (<span class="no">avg_infected_mass_scaled</span> - <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">avg_infected_mass_scaled</span>))) <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="no">avg_infected_mass_scaled</span> / <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">avg_infected_mass_scaled</span>)) <span class="kw">%&gt;%</span>
    <span class="co"># establishment</span>
    <span class="fu">mutate</span>(<span class="kw">grand_mean_max_scaled</span> <span class="kw">=</span> <span class="no">grand_mean_max</span>)

} <span class="kw">else</span> {

  <span class="no">countries_summary_present</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_present</span> <span class="kw">%&gt;%</span>
    <span class="co"># transport</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">avg_infected_mass</span>+<span class="fl">1</span>)) <span class="co"># %&gt;%</span>
  <span class="co">#mutate(avg_infected_mass_scaled = scale(avg_infected_mass_scaled)) %&gt;%</span>
    <span class="co"># establishment</span>
  <span class="co">#mutate(grand_mean_max_scaled = scale(grand_mean_max))</span>

  <span class="no">countries_summary_future</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_future</span> <span class="kw">%&gt;%</span>
    <span class="co"># transport</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">avg_infected_mass</span>+<span class="fl">1</span>))

}</pre></body></html></div>
<p>Make a version of the country data that lacks zeros for trade mass</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co">#rm the trade mass zero countries</span>
<span class="no">countries_summary_nozeros_present</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_present</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">log10_avg_infected_mass</span> <span class="kw">!=</span> <span class="fl">0</span>)
<span class="no">countries_summary_nozeros_future</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_future</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">log10_avg_infected_mass</span> <span class="kw">!=</span> <span class="fl">0</span>)

<span class="co">#rescale and log transform countries with the zeros for trade mass rm</span>
<span class="no">countries_summary_nozeros_present</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_nozeros_present</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">avg_infected_mass</span>+<span class="fl">1</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> (<span class="no">avg_infected_mass_scaled</span>-<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">avg_infected_mass_scaled</span>))) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="no">avg_infected_mass_scaled</span>/<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">avg_infected_mass_scaled</span>))
<span class="no">countries_summary_nozeros_future</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_nozeros_future</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">avg_infected_mass</span>+<span class="fl">1</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> (<span class="no">avg_infected_mass_scaled</span>-<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">avg_infected_mass_scaled</span>))) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="no">avg_infected_mass_scaled</span>/<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">avg_infected_mass_scaled</span>))</pre></body></html></div>
</div>
</div>
<div id="plotting" class="section level1">
<h1 class="hasAnchor">
<a href="#plotting" class="anchor"></a>Plotting</h1>
<div id="plotting-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-parameters" class="anchor"></a>Plotting parameters</h2>
<p>Now we have some plotting parameters to make visible up front</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co"># Choose quadrant intercepts</span>
<span class="no">q_intercepts</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">transport</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">establishment</span> <span class="kw">=</span> <span class="fl">0.5</span>)

<span class="no">hh</span> <span class="kw">=</span> <span class="fl">.001</span> <span class="co">#set margins</span>
<span class="no">plots_which</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">TRUE</span>,<span class="fl">FALSE</span>) <span class="co"># Do not change this flips between plotting the states or plotting countries</span>
<span class="no">top_to_plot</span> <span class="kw">&lt;-</span> <span class="fl">10</span> <span class="co"># How many countries and states to highlight for labels?</span>
<span class="no">nudge_JPNKOR.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">.05</span>,<span class="fl">0</span>)
<span class="no">nudge_JPNKOR.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.07</span>,<span class="fl">.1</span>)
<span class="no">nudge_JPNKOR_future.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.00</span>,<span class="fl">0</span>)
<span class="no">nudge_JPNKOR_future.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.08</span>,<span class="fl">.1</span>)
<span class="no">nudge_us.infected_present.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.00</span>, -<span class="fl">0.02</span>,-<span class="fl">0.04</span>)  <span class="co">#PRESENT: adding DE, MD, NJ  </span>
<span class="no">nudge_us.infected_present.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.10</span>,-<span class="fl">0.10</span>,-<span class="fl">0.10</span>)
<span class="no">nudge_us.infected_future.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">0.00</span>,-<span class="fl">0.10</span>, <span class="fl">0.02</span>,-<span class="fl">0.04</span>,<span class="fl">0.00</span>)  <span class="co">#FUTURE: adding OH, DE, MD, NJ, WV</span>
<span class="no">nudge_us.infected_future.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">0.10</span>, <span class="fl">0.10</span>,-<span class="fl">0.17</span>, <span class="fl">0.08</span>,<span class="fl">0.15</span>)
<span class="co">#lx &lt;- 0.22</span>
<span class="co">#ly &lt;- 0.25</span>
<span class="co">#hy &lt;- 0.77</span>
<span class="co">#hx &lt;- 0.78</span>
<span class="no">risk_color</span> <span class="kw">&lt;-</span> <span class="st">"gray40"</span>
<span class="no">risk_size</span> <span class="kw">&lt;-</span> <span class="fl">5</span>

<span class="co">#risk_labels &lt;-data.frame(label = c("low\nrisk","moderate\nrisk","moderate\nrisk","high\nrisk"),</span>
<span class="co">#                        x = c(lx,lx,hx,hx),</span>
<span class="co">#                        y = c(ly,hy,ly,hy),</span>
<span class="co">#                        hjust = c(0,0,0,0),</span>
<span class="co">#                        vjust = c(0,0,0,0))</span>

<span class="no">i</span> <span class="kw">&lt;-</span> <span class="fl">1</span></pre></body></html></div>
<p><img src="vignette-021-quadrant-plots_files/figure-html/plot%20figures-1.png" width="720"><img src="vignette-021-quadrant-plots_files/figure-html/plot%20figures-2.png" width="720"></p>
<p>Combine the plots into a stacked plot nicely with the legend</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co">#set up a layout grid</span>
  <span class="no">lay</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>,<span class="fl">NA</span>,<span class="fl">NA</span>,<span class="fl">NA</span>),
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>,<span class="fl">NA</span>,<span class="fl">NA</span>,<span class="fl">NA</span>),
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>,<span class="fl">NA</span>, <span class="fl">3</span>, <span class="fl">3</span>),
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">NA</span>,<span class="fl">NA</span>,<span class="fl">NA</span>,<span class="fl">NA</span>, <span class="fl">3</span>, <span class="fl">3</span>),
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>,<span class="fl">NA</span>, <span class="fl">3</span>, <span class="fl">3</span>),
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>,<span class="fl">NA</span>,<span class="fl">NA</span>,<span class="fl">NA</span>),
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>,<span class="fl">NA</span>,<span class="fl">NA</span>,<span class="fl">NA</span>)
  )

<span class="kw">if</span>(<span class="no">present_transport</span>){
    <span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(),<span class="st">"vignettes"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"combined_present_max_"</span>,<span class="no">impact_prod</span>,<span class="st">".pdf"</span>)),<span class="kw">width</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">12</span>)

} <span class="kw">else</span>{
    <span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(),<span class="st">"vignettes"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"combined_future_max_"</span>,<span class="no">impact_prod</span>,<span class="st">".pdf"</span>)),<span class="kw">width</span> <span class="kw">=</span> <span class="fl">7.5</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">12</span>)

}
  <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span>(<span class="no">states_grob</span>, <span class="no">countries_grob</span>, <span class="no">legend_country</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">7</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">6</span>, <span class="kw">layout_matrix</span> <span class="kw">=</span> <span class="no">lay</span>, <span class="kw">heights</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>), <span class="kw">widths</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0.1</span>,<span class="fl">0.57</span>,<span class="fl">0.57</span>))
  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span>(<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>())

<span class="co">#nice version for knitting</span>
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span>(<span class="no">states_grob</span>, <span class="no">countries_grob</span>, <span class="no">legend_country</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">7</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">6</span>, <span class="kw">layout_matrix</span> <span class="kw">=</span> <span class="no">lay</span>, <span class="kw">heights</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>), <span class="kw">widths</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0.1</span>,<span class="fl">0.6</span>,<span class="fl">0.6</span>))</pre></body></html></div>
<p><img src="vignette-021-quadrant-plots_files/figure-html/combined%20plot%20with%20legend-1.png" width="960"> Save with the legend as a separate file</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co">#save the plots w/o legend</span>
<span class="co">#set up a layout grid</span>
  <span class="no">lay</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>,<span class="fl">NA</span>),
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>,<span class="fl">NA</span>),
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>,<span class="fl">NA</span>),
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">NA</span>,<span class="fl">NA</span>,<span class="fl">NA</span>,<span class="fl">NA</span>,<span class="fl">NA</span>,<span class="fl">NA</span>),
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>,<span class="fl">NA</span>),
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>,<span class="fl">NA</span>),
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>,<span class="fl">NA</span>)
  )

<span class="kw">if</span>(<span class="no">present_transport</span>){
    <span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(),<span class="st">"vignettes"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"combined_present_max_"</span>,<span class="no">impact_prod</span>,<span class="st">"_nolegend.pdf"</span>)),<span class="kw">width</span> <span class="kw">=</span> <span class="fl">7.5</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">12</span>)
} <span class="kw">else</span>{
    <span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(),<span class="st">"vignettes"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"combined_future_max_"</span>,<span class="no">impact_prod</span>,<span class="st">"_nolegend.pdf"</span>)),<span class="kw">width</span> <span class="kw">=</span> <span class="fl">7.5</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">12</span>)
}
<span class="co">#finish out the plotting</span>
  <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span>(<span class="no">states_grob</span>, <span class="no">countries_grob</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">7</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">6</span>, <span class="kw">layout_matrix</span> <span class="kw">=</span> <span class="no">lay</span>, <span class="kw">heights</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>), <span class="kw">widths</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.99</span>,<span class="fl">0.99</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>))
  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span>(<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>())


<span class="co">#save the legend</span>
<span class="kw">if</span>(<span class="no">present_transport</span>){
  <span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(),<span class="st">"vignettes"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"legend_combined_present_max"</span>,<span class="no">impact_prod</span>,<span class="st">".pdf"</span>)),<span class="kw">width</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">10</span>)
} <span class="kw">else</span>{
  <span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(),<span class="st">"vignettes"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"legend_combined_future_max"</span>,<span class="no">impact_prod</span>,<span class="st">".pdf"</span>)),<span class="kw">width</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">10</span>)
}
<span class="co">#finish out the plotting</span>
<span class="fu"><a href="https://rdrr.io/r/grid/grid.draw.html">grid.draw</a></span>(<span class="no">legend_country</span>)
<span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span>(<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>())</pre></body></html></div>
<p>alignment correlation code: note how it is cor(grapeprod, predicted(lm(grapeprod~transport+establishment)). 1. Can you make a quick decreasing sorted barchart of states and countries combined together (only if grapeprod is not scale(grapeprod) of the predicted values in that correlation lm. 2. Then perhaps color coded according to high low wine and with the top 10 labeled.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co">#combine the states and countries grape production data</span>
<span class="no">states_summary_future</span> <span class="kw">%&gt;%</span>
  <span class="fu">bind_rows</span>(<span class="no">.</span>, <span class="no">countries_summary_future</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">avg_prod</span> <span class="kw">!=</span> <span class="fl">0</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>() +
  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span>(<span class="no">ID</span>, (<span class="no">avg_prod</span>)), <span class="kw">y</span> <span class="kw">=</span> <span class="no">avg_prod</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span>(<span class="no">avg_prod</span>)), <span class="kw">stat</span> <span class="kw">=</span> <span class="st">"identity"</span>) +
  <span class="fu">scale_y_log10</span>() +
  <span class="fu">coord_flip</span>()</pre></body></html></div>
<p><img src="vignette-021-quadrant-plots_files/figure-html/make%20barchart%20of%20grape%20production%20states%20and%20countries%20together-1.png" width="960"></p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="co">#size_to_plot = avg_prod</span>
<span class="co">#x_to_plot = avg_infected_mass_scaled</span>
<span class="co">#y_to_plot = grand_mean_max_scaled</span>

<span class="co">#STATES</span>
<span class="no">states_summary_future_pred</span> <span class="kw">&lt;-</span> <span class="no">states_summary_future</span> <span class="kw">%&gt;%</span>
<span class="co">#first reorder the data to match the order in the plotting</span>
  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">grapes</span>), (<span class="no">avg_prod</span>)) <span class="kw">%&gt;%</span>
<span class="co">#now bind the fitted values in</span>
  <span class="co">#left_join(., cbind(states.impact.model$model, pred_avg_prod = states.impact.model$fitted.values), by = c("avg_infected_mass_scaled" = "x_to_plot", "grand_mean_max_scaled" = "y_to_plot")) %&gt;%</span>
  <span class="co">#select(ID:geopol_unit, grapes, avg_prod,size_to_plot:pred_avg_prod)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">.</span>, <span class="kw">pred_avg_prod</span> <span class="kw">=</span> <span class="no">states.impact.model</span>$<span class="no">fitted.values</span>) <span class="kw">%&gt;%</span>
  <span class="fu">as_tibble</span>()

<span class="co">#COUNTRIES</span>
<span class="no">countries_summary_future_pred</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_future</span> <span class="kw">%&gt;%</span>
<span class="co">#first reorder the data to match the order in the plotting</span>
  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">grapes</span>), (<span class="no">avg_prod</span>)) <span class="kw">%&gt;%</span>
<span class="co">#now bind the fitted values in</span>
  <span class="co">#left_join(., cbind(countries.impact.model$model, pred_avg_prod = countries.impact.model$fitted.values), by = c("avg_infected_mass_scaled" = "x_to_plot", "grand_mean_max_scaled" = "y_to_plot")) %&gt;%</span>
  <span class="co">#select(ID:geopol_unit, grapes, avg_prod,size_to_plot:pred_avg_prod)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">.</span>, <span class="kw">pred_avg_prod</span> <span class="kw">=</span> <span class="no">countries.impact.model</span>$<span class="no">fitted.values</span>) <span class="kw">%&gt;%</span>
  <span class="fu">as_tibble</span>()

<span class="no">states_summary_future_pred</span> <span class="kw">%&gt;%</span>
  <span class="fu">bind_rows</span>(<span class="no">.</span>, <span class="no">countries_summary_future_pred</span>) <span class="kw">%&gt;%</span>
  <span class="co">#((predicted - min(predicted)) / max(predicted-min(predicted)))*10</span>
  <span class="fu">mutate</span>(<span class="kw">scaled_pred_avg_prod</span> <span class="kw">=</span> ((<span class="no">pred_avg_prod</span> - <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">pred_avg_prod</span>)) / <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">pred_avg_prod</span> - <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">pred_avg_prod</span>)))*<span class="fl">10</span>) <span class="kw">%&gt;%</span>
  <span class="co">#filter(log10(pred_avg_prod) &gt; 0) %&gt;% #some values produced are NaN due to negative predicted grape production... this warning is supressed, since they are filtered out</span>
  <span class="fu">ggplot</span>() +
  <span class="co">#geom_bar(aes(x = reorder(ID, (pred_avg_prod)), y = pred_avg_prod, fill = log10(pred_avg_prod)), stat = "identity") +</span>
  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span>(<span class="no">ID</span>, (<span class="no">scaled_pred_avg_prod</span>)), <span class="kw">y</span> <span class="kw">=</span> <span class="no">scaled_pred_avg_prod</span>, <span class="kw">fill</span> <span class="kw">=</span> (<span class="no">scaled_pred_avg_prod</span>)), <span class="kw">stat</span> <span class="kw">=</span> <span class="st">"identity"</span>) +
  <span class="co">#scale_y_log10() +</span>
  <span class="fu">coord_flip</span>()</pre></body></html></div>
<p><img src="vignette-021-quadrant-plots_files/figure-html/fuse%20the%20predicted%20values%20back%20into%20states%20and%20countries%20summary%20data-1.png" width="1152"></p>
<p>Make scatter of predicted as y-axis and market size (your USD variable)</p>
<ol style="list-style-type: decimal">
<li>We need to see if Risk (predicted values from that alignment cor lm) is correlated to regional market size.</li>
<li>If it looks good, and then we might color it by wine production from white to purple and add a regression line.</li>
</ol>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">states_summary_future_pred</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">category</span> <span class="kw">=</span> <span class="st">"state"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">bind_rows</span>(<span class="no">.</span>, <span class="no">countries_summary_future_pred</span> <span class="kw">%&gt;%</span> <span class="fu">mutate</span>(<span class="kw">category</span> <span class="kw">=</span> <span class="st">"country"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">avg_infected_trade</span> <span class="kw">&gt;</span> <span class="fl">0</span> <span class="kw">&amp;</span> <span class="no">pred_avg_prod</span> <span class="kw">&gt;</span> <span class="fl">0</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">avg_infected_trade</span>,  <span class="kw">y</span> <span class="kw">=</span> <span class="no">pred_avg_prod</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">category</span>)) +
  <span class="fu">geom_point</span>() +
  <span class="fu">scale_x_log10</span>()</pre></body></html></div>
<p><img src="vignette-021-quadrant-plots_files/figure-html/use%20the%20predicted%20values%20for%20grape%20avg_prod%20and%20avg_infected_trade-1.png" width="700"></p>
<div class="sourceCode" id="cb15"><html><body><pre class="r">
<span class="no">combined.impact.model</span> <span class="kw">&lt;-</span> <span class="no">states_summary_future_pred</span> <span class="kw">%&gt;%</span>
  <span class="fu">bind_rows</span>(<span class="no">.</span>, <span class="no">countries_summary_future_pred</span>) <span class="kw">%&gt;%</span>
  <span class="co">#filter(avg_infected_trade &gt; 0 &amp; pred_avg_prod &gt; 0) %&gt;%</span>
<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">.</span>, <span class="kw">formula</span> <span class="kw">=</span> <span class="no">avg_prod</span> ~ <span class="no">avg_infected_mass_scaled</span> + <span class="no">grand_mean_max_scaled</span>)</pre></body></html></div>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">states_summary_future_pred</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">category</span> <span class="kw">=</span> <span class="st">"state"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">bind_rows</span>(<span class="no">.</span>, <span class="no">countries_summary_future_pred</span> <span class="kw">%&gt;%</span> <span class="fu">mutate</span>(<span class="kw">category</span> <span class="kw">=</span> <span class="st">"country"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">ID</span>, <span class="no">geopol_unit</span>, <span class="no">category</span>) <span class="kw">%&gt;%</span>
  <span class="fu">write_csv</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">.</span>, <span class="kw">path</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(),<span class="st">"data-raw"</span>, <span class="st">"wine_market.csv"</span>))</pre></body></html></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by M.R. Helmus.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
