<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Species Distribution Modeling • slfrsk</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Species Distribution Modeling">
<meta property="og:description" content="slfrsk">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">slfrsk</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/vignette-001-overview.html">Overview</a>
</li>
<li>
  <a href="../articles/vignette-002-terms.html">Definitions</a>
</li>
<li>
  <a href="../articles/vignette-040-ee-data.html">Paninvasion Severity Assessment App</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Analyses
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Step 1: Estimate Invasion Potentials</a>
      <ul class="dropdown-menu" role="menu">
<li class="divider">
        <li>
          <a href="../articles/vignette-060-spread-figure.html">Identify Invaded States/Reg. Incidents</a>
        </li>
        <li>
          <a href="../articles/vignette-042-trade-presence.html">Confirm SLF--Trade Tonnage Relationship</a>
        </li>
        <li>
          <a href="../articles/vignette-003-get-gbif-data.html">Get GBIF Records</a>
        </li>
        <li>
          <a href="../articles/vignette-010-tidy-data.html">Data Tidying</a>
        </li>
        <li>
          <a href="../articles/vignette-011-suitability-models.html">Species Distribution Modeling</a>
        </li>
        <li class="divider">
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Step 2: Calculate Alignment Correlations</a>
      <ul class="dropdown-menu" role="menu">
<li class="divider">
        <li>
          <a href="../articles/vignette-030-potentials-maps.html">Invasion Potential Maps</a>
        </li>
        <li class="dropdown-submenu">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Invasion Potential Alignment</a>
          <ul class="dropdown-menu" role="menu">
<li class="divider">
            <li>
              <a href="../articles/vignette-021-quadrant-plots.html">Published (Max)</a>
            </li>
            <li>
              <a href="../articles/vignette-026-quadrant-plots-alt-median.html">Alternate (Median)</a>
            </li>
            <li>
              <a href="../articles/vignette-027-quadrant-plots-alt-mean.html">Alternate (Mean)</a>
            </li>
            <li class="divider">
          </ul>
</li>
        <li class="divider">
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Step 3: Quantify Paninvasion Risk</a>
      <ul class="dropdown-menu" role="menu">
<li class="divider">
        <li>
          <a href="../articles/vignette-041-market-plot.html">Paninvasion Risk</a>
        </li>
        <li class="divider">
      </ul>
</li>
    <li class="divider">
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ieco-lab/slfrsk">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="vignette-011-suitability-models_files/header-attrs-2.8/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Species Distribution Modeling</h1>
            
      
      
      <div class="hidden name"><code>vignette-011-suitability-models.Rmd</code></div>

    </div>

    
    
<p>How to Build, Evaluate, and Save Species Distribution Models for <em>Ailanthus altissima</em> (TOH) and <em>Lycorma delicatula</em> (SLF)</p>
<hr>
<p>This vignette is designed to demonstrate the workflow that lead to the creation of the three species distribution models (SDMs) used to assess the risk of <strong>SLF</strong> paninvasion. The description will not include actual running of some steps of this workflow, as some are unwieldy. Instead, information to ensure proper replication of those steps is provided. Notably, the MaxEnt runs are not conducted in this vignette, although the means to do so within <code>R</code> may be possible.</p>
<p>The scope of this vignette is as follows:</p>
<ol style="list-style-type: decimal">
<li>Reading and Visualization of Presence Data</li>
<li>Preparation of Spatial Data</li>
<li>Evaluation of Spatial Data Collinearity</li>
<li>Building and evaluating MaxEnt SDMs</li>
<li>Visualizing SDMs and Extracting Summary Statistics by Geopolitical Unit</li>
</ol>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>We load the packages that are necessary to complete any analyses that allow us to demonstrate the workflow. Packages may include comments to clarify their purpose or the steps in which they are used.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">slfrsk</span><span class="op">)</span> <span class="co">#this package, has extract_enm()</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>  <span class="co">#data manipulation</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span> <span class="co">#making directory pathways easier on different instances</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ENMTools</span><span class="op">)</span> <span class="co">#enviro collinearity analyses</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span> <span class="co">#easy combined plots</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span> <span class="co">#rescale the plots easily</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://rgdal.r-forge.r-project.org">rgdal</a></span><span class="op">)</span> <span class="co">#load shapefiles</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">doParallel</span><span class="op">)</span> <span class="co">#parallized extraction</span></code></pre></div>
</div>
<div id="reading-and-visualization-of-presence-data" class="section level1">
<h1 class="hasAnchor">
<a href="#reading-and-visualization-of-presence-data" class="anchor"></a>1. Reading and Visualization of Presence Data</h1>
<p>We built models of both SLF and TOH from presence records obtained from public databases (as seen in the <strong>“GBIF Records” vignette</strong>). As is standard practice, we checked all records for quality, removed duplicate and imprecise records, and obtained 8,022 TOH and 325 SLF unique and cleaned presence records.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#load data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"slf_points"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"toh_points"</span><span class="op">)</span>

<span class="co">#plot points on map: TOH</span>
<span class="va">map_toh</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">'world'</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"#FFFFFF"</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span> <span class="co">#world map</span>
  <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">toh_points</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#0072b2"</span>, alpha <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        <span class="co">#plot.background = element_rect(fill ="#f0f8ff"),</span>
        panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#f0f8ff"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  
  <span class="fu">coord_quickmap</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">164.5</span>, <span class="fl">163.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">55</span>,<span class="fl">85</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span>label <span class="op">=</span> <span class="st">"TOH Presence"</span><span class="op">)</span>

<span class="co">#plot points on map: SLF</span>
<span class="va">map_slf</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">'world'</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"#FFFFFF"</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span> <span class="co">#world map</span>
  <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">slf_points</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#d55e00"</span>, alpha <span class="op">=</span> <span class="fl">0.50</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        <span class="co">#plot.background = element_rect(fill ="#f0f8ff"),</span>
        panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#f0f8ff"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_quickmap</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">164.5</span>, <span class="fl">163.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">55</span>,<span class="fl">85</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span>label <span class="op">=</span> <span class="st">"SLF Presence"</span><span class="op">)</span>

<span class="co">#patchwork output of both maps</span>
<span class="va">map_toh</span> <span class="op">/</span> <span class="va">map_slf</span></code></pre></div>
<p><img src="vignette-011-suitability-models_files/figure-html/read%20in%20presence%20records%20and%20show%20on%20a%20quick%20map-1.png" width="960" style="display: block; margin: auto auto auto 0;"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">'world'</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"#FFFFFF"</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span> <span class="co">#world map</span>
<span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">toh_points</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#0072b2"</span>, alpha <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span> <span class="op">+</span>
<span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">slf_points</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#d55e00"</span>, alpha <span class="op">=</span> <span class="fl">0.50</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        <span class="co">#plot.background = element_rect(fill ="#f0f8ff"),</span>
        panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#f0f8ff"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co">#theme_bw() +</span>
  <span class="fu">coord_quickmap</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">164.5</span>, <span class="fl">163.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">55</span>,<span class="fl">85</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="preparation-of-spatial-data" class="section level1">
<h1 class="hasAnchor">
<a href="#preparation-of-spatial-data" class="anchor"></a>2. Preparation of Spatial Data</h1>
<p>To discern which environmental variables to use in the species distribution models (SDMs), we had to minimize collinearity among included covariates (<span class="citation"><a href="#ref-peterson_ecological_2011" role="doc-biblioref">A. Townsend Peterson et al.</a> (<a href="#ref-peterson_ecological_2011" role="doc-biblioref">2011</a>)</span>). To do so, we estimated pairwise correlation coefficients for 22 global raster covariates hypothesized to influence SLF and TOH distributions: the 20 WorldClim topographic and bioclimatic variables (<span class="citation"><a href="#ref-hijmans_very_2005" role="doc-biblioref">Hijmans et al.</a> (<a href="#ref-hijmans_very_2005" role="doc-biblioref">2005</a>)</span>, <span class="citation"><a href="#ref-fick_worldclim_2017" role="doc-biblioref">Fick and Hijmans</a> (<a href="#ref-fick_worldclim_2017" role="doc-biblioref">2017</a>)</span>), forest height (<span class="citation"><a href="#ref-simard_mapping_2011" role="doc-biblioref">Simard et al.</a> (<a href="#ref-simard_mapping_2011" role="doc-biblioref">2011</a>)</span>), and access to cities (<span class="citation"><a href="#ref-weiss_global_2018" role="doc-biblioref">Weiss et al.</a> (<a href="#ref-weiss_global_2018" role="doc-biblioref">2018</a>)</span>).</p>
<p>To limit the raster data of covariates to the area of interest, we cropped their extent to <span class="math inline">\([-180, 180]\)</span> for latitude and <span class="math inline">\([-60, 84]\)</span> for longitude and ensured that the extent and resolutions matched one another by using one layer as a reference raster with <code>raster::resample(method = "bilinear)</code>. This corrected any mismatching among cropped rasters of different sources (example code below).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span>  <span class="co">#open no run if</span>
  
<span class="co">#my path to the GoogleDrive shared directory</span>
<span class="va">mypath</span> <span class="op">&lt;-</span> <span class="st">"/Volumes/GoogleDrive/Shared drives/slfData/data/slfRisk/raw_env"</span>
  
<span class="co">#ensure that extent is identical</span>
<span class="co">#get file names</span>
<span class="va">env.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">mypath</span>,<span class="st">"originals"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"[.]tif"</span>, full.names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">env.short</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">mypath</span>,<span class="st">"originals"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"[.]tif"</span>, full.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co">#change the labeling of the output layers</span>
<span class="va">output.files</span> <span class="op">&lt;-</span> <span class="va">env.short</span>

<span class="co">#change weird BIOCLIM prefix</span>
<span class="va">output.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"wc2.0_bio_30s"</span>, replacement <span class="op">=</span> <span class="st">"global_bio"</span>, x <span class="op">=</span> <span class="va">output.files</span><span class="op">)</span>
<span class="co">#change weird ENVIREM prefix</span>
<span class="va">output.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"current_30arcsec"</span>, replacement <span class="op">=</span> <span class="st">"global_env"</span>, x <span class="op">=</span> <span class="va">output.files</span><span class="op">)</span>
<span class="co">#change weird ATC prefix</span>
<span class="va">output.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"2015_accessibility_to_cities_v1.0"</span>, replacement <span class="op">=</span> <span class="st">"global_atc"</span>, x <span class="op">=</span> <span class="va">output.files</span><span class="op">)</span>

<span class="co">#crop one of the BIOCLIM layers to set the bounding box and resolution to have files fixed</span>
<span class="va">same.extent</span> <span class="op">&lt;-</span> <span class="fu">extent</span><span class="op">(</span><span class="op">-</span><span class="fl">180</span>, <span class="fl">180</span>, <span class="op">-</span><span class="fl">60</span>, <span class="fl">84</span><span class="op">)</span>
<span class="va">master_layer</span> <span class="op">&lt;-</span> <span class="fu">crop</span><span class="op">(</span><span class="fu">raster</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">mypath</span>,<span class="st">"originals/wc2.0_bio_30s_01.tif"</span><span class="op">)</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">same.extent</span>, overwrite <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co">#reset extent stepwise</span>
<span class="kw">for</span><span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>

  <span class="co">#ensure that the CRS is consistent</span>
  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="op">(</span><span class="va">env.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span>
  <span class="fu">crs</span><span class="op">(</span><span class="va">rast.hold</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"</span>
  <span class="co">#resample to fit the extent/resolution of the reference BIOCLIM layer</span>
  <span class="co">#use bilinear interpolation, since values are continuous</span>
  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">resample</span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, y <span class="op">=</span> <span class="fu">raster</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">mypath</span>,<span class="st">"v1/global_bio_01.tif"</span><span class="op">)</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"bilinear"</span><span class="op">)</span>

  <span class="co">#write out the new resampled rasters!</span>
  <span class="fu">writeRaster</span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">mypath</span>,<span class="st">"v1"</span>, <span class="va">output.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="op">}</span>

<span class="op">}</span> <span class="co">#closes no run if</span></code></pre></div>
<p>For tractability, we first downsized the resolution of these global covariate rasters with <code><a href="https://rdrr.io/pkg/raster/man/aggregate.html">raster::aggregate(fact = 2, fun = mean, expand = TRUE, na.rm = TRUE)</a></code> before assessing collinearity (see example code below). However, the full resolution covariates were used to build all models.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span>  <span class="co">#open no run if</span>
  
<span class="co">#my path to the GoogleDrive shared directory</span>
<span class="va">mypath</span> <span class="op">&lt;-</span> <span class="st">"/Volumes/GoogleDrive/Shared drives/slfData/data/slfRisk/raw_env"</span>
  
<span class="co">#list the enviro layers to load sequentially</span>
<span class="va">env.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">mypath</span>,<span class="st">"v1"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">".tif"</span>, full.names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">env.short</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">mypath</span>,<span class="st">"v1"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">".tif"</span>, full.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co">#downsampling by a factor of 2 (read 2 cells deep around a cell) and take the mean of the cells</span>
<span class="kw">for</span><span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">holder</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="op">(</span><span class="va">env.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span>
  <span class="va">down_holder</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">holder</span>, fact <span class="op">=</span> <span class="fl">2</span>, fun <span class="op">=</span> <span class="va">mean</span>, expand <span class="op">=</span> <span class="cn">TRUE</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, filename <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">mypath</span>,<span class="st">"v1_downsampled"</span>, <span class="va">env.short</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="op">}</span>

<span class="op">}</span> <span class="co">#closes no run if</span></code></pre></div>
</div>
<div id="evaluation-of-spatial-data-collinearity" class="section level1">
<h1 class="hasAnchor">
<a href="#evaluation-of-spatial-data-collinearity" class="anchor"></a>3. Evaluation of Spatial Data Collinearity</h1>
<p>To evaluate the correlations among the covariates, we used <code><a href="https://rdrr.io/pkg/ENMTools/man/raster.cor.matrix.html">ENMTools::raster.cor.matrix(method = "pearson")</a></code>. Note that this code may still take quite some time to run. For brevity, we have included a version of the correlation matrix with the compendium for quick review (location: <code>/data-raw/env_cor_v1_downsampled.csv</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span>  <span class="co">#open no run if</span>

<span class="co">#my path to the GoogleDrive shared directory</span>
<span class="va">mypath</span> <span class="op">&lt;-</span> <span class="st">"/Volumes/GoogleDrive/Shared drives/slfData/data/slfRisk/raw_env"</span>

<span class="co">#load the downsampled layers and stack for raster.cor.matrix command</span>

<span class="co">#list of layer paths</span>
<span class="va">env.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">mypath</span>,<span class="st">"v1_downsampled"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">".tif"</span>, full.names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="co">#stack the downsized layers</span>
<span class="va">env</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">)</span>

<span class="co">#evaluate correlations for raster layers</span>
<span class="co">#create a correlation matrix for picking model layers</span>
<span class="va">env.corr</span> <span class="op">&lt;-</span> <span class="fu">ENMTools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ENMTools/man/raster.cor.matrix.html">raster.cor.matrix</a></span><span class="op">(</span><span class="va">env</span>, method <span class="op">=</span> <span class="st">"pearson"</span><span class="op">)</span>

<span class="co">#write out the correlations as a csv</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">env.corr</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"data-raw/env_cor_v1_downsampled.csv"</span><span class="op">)</span>, col.names <span class="op">=</span> <span class="cn">TRUE</span>, row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="op">}</span> <span class="co">#closes no run if</span></code></pre></div>
<p>To visualize the correlations between pairs of environmental covariates easily, we take the absolute value of all correlations and present the strength of relationships as a heatmap.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#re-read the correlation table in again</span>
<span class="va">env.cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"data-raw/env_cor_v1_downsampled.csv"</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="co">#here, we make cor's absolute values and make the data tidy to make it easier to plot in ggplot2</span>
<span class="va">env.cor</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span>
<span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>covar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">covar</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">covar</span>, names_to <span class="op">=</span> <span class="st">"var"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">var</span>, <span class="va">covar</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_tile</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">var</span>, y <span class="op">=</span> <span class="va">covar</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>discrete <span class="op">=</span> <span class="cn">FALSE</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"abs(Correlation)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">guides</span><span class="op">(</span>x <span class="op">=</span>  <span class="fu">guide_axis</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-011-suitability-models_files/figure-html/visualize%20env%20correlations-1.png" width="768" style="display: block; margin: auto auto auto 0;"></p>
<p>With the correlations, we identified 6 of the 22 covariates that had minimal cross-correlations: annual mean temperature (<strong>BIO01</strong>), mean diurnal temperature range (<strong>BIO02</strong>), annual precipitation (<strong>BIO12</strong>), precipitation seasonality (<strong>BIO15</strong>), elevation (<strong>ELEV</strong>), and access to cities (<strong>ATC</strong>). These variables were then converted to ASCII files (<code>.asc</code>), as required by MaxEnt (example code below). We also set all <code>NA</code> values to <code>-9999</code>, which is the default value recognized as <code>NA</code> by MaxEnt.</p>
<p>Note that these <code>.asc</code> files are massive. It is not advisable to run this chunk unless you are certain that you have sufficient space to do so. It is for this reason (in part) that we do not provide this file type for all covariates.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span>  <span class="co">#open no run if</span>

<span class="co">#my path to the GoogleDrive shared directory</span>
<span class="va">mypath</span> <span class="op">&lt;-</span> <span class="st">"/Volumes/GoogleDrive/Shared drives/slfData/data/slfRisk/raw_env"</span>

<span class="co">#get and set file names  </span>
<span class="va">env.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">mypath</span>,<span class="st">"v1"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"[.]tif"</span>, full.names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">env.short</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">mypath</span>,<span class="st">"v1"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"[.]tif"</span>, full.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="va">env.asc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">".tif"</span>, replacement <span class="op">=</span> <span class="st">".asc"</span>, x <span class="op">=</span> <span class="va">env.short</span><span class="op">)</span>

<span class="co">#loop to convert and make sure to set NA values to -9999</span>
<span class="kw">for</span><span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">file_to_asc</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="op">(</span><span class="va">env.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span>
  <span class="fu">NAvalue</span><span class="op">(</span><span class="va">file_to_asc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">9999</span>
  <span class="fu">writeRaster</span><span class="op">(</span>x <span class="op">=</span> <span class="va">file_to_asc</span>, filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"v1_maxent"</span>, <span class="va">env.asc</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"ascii"</span>, overwrite <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="op">}</span>

  <span class="op">}</span> <span class="co">#closes no run if</span></code></pre></div>
</div>
<div id="building-and-evaluating-maxent-sdms" class="section level1">
<h1 class="hasAnchor">
<a href="#building-and-evaluating-maxent-sdms" class="anchor"></a>4. Building and evaluating MaxEnt SDMs</h1>
<div id="focal-models" class="section level2">
<h2 class="hasAnchor">
<a href="#focal-models" class="anchor"></a>Focal Models</h2>
<p>To further evaluate environmental covariates, we modeled each of them individually with SLF. To do this, we used MaxEnt (v3.4.1, available at <a href="https://biodiversityinformatics.amnh.org/open_source/maxent/" class="uri">https://biodiversityinformatics.amnh.org/open_source/maxent/</a>) under default parameters, excluding the following changes (<span class="citation"><a href="#ref-phillips_maximum_2006" role="doc-biblioref">Phillips, Anderson, and Schapire</a> (<a href="#ref-phillips_maximum_2006" role="doc-biblioref">2006</a>)</span>, <span class="citation"><a href="#ref-pearson_predicting_2007" role="doc-biblioref">Pearson et al.</a> (<a href="#ref-pearson_predicting_2007" role="doc-biblioref">2007</a>)</span>):</p>
<ul>
<li>All feature types were made available but still set to <code>Auto Features</code> (Linear, Quadratic, Product, Threshold, and Hinge set to <code>TRUE</code> before setting Auto Features to <code>TRUE</code>)</li>
<li>
<code>Create response curves</code> was set to <code>TRUE</code>
</li>
<li>
<code>Do jackknife to measure variable importance</code> was set to <code>TRUE</code>
</li>
<li>
<code>Replicates</code> set to <code>5</code> for SLF (this sets the number of <em>k</em>-fold crossvalidation replicates and determines the test proportion from <em>k</em>)</li>
<li>
<code>Apply threshold rule</code> set to <code>Minimum training presence</code>
</li>
<li>
<code>Threads</code> set to the available number of processor threads available</li>
</ul>
<p>After fitting individual models, we fit these 6 covariates combined to SLF and TOH presences, except that the number of <code>Replicates = 10</code> for <strong>TOH</strong>, rather than <code>Replicates = 5</code>. The resultant two models are:</p>
<ol style="list-style-type: decimal">
<li>
<em>sdm_toh</em>—a multivariate SDM of TOH</li>
<li>
<em>sdm_slf1</em>—a multivariate SDM of SLF</li>
</ol>
<p>A third model was created from <em>sdm_toh</em> suitability and <strong>SLF</strong> presence records, based on evidence supporting the strong affinity of SLF for TOH as a preferred host (<span class="citation"><a href="#ref-parra_usda-aphis-ppq-cphst_2018" role="doc-biblioref">Parra, Moylett, and Bulluck</a> (<a href="#ref-parra_usda-aphis-ppq-cphst_2018" role="doc-biblioref">2018</a>)</span>, <span class="citation">(<a href="#ref-urban_perspective:_2019" role="doc-biblioref"><strong>urban_perspective:_2019?</strong></a>)</span>):</p>
<ol start="3" style="list-style-type: decimal">
<li>
<em>sdm_slf2</em>—a single variate SDM of SLF</li>
</ol>
<p>Here, we report in a simple table the metrics used to evaluate the various models that were considered as well as the percent contribution of each variable to each model (where applicable). Model validation was conducted with <em>k</em>-fold cross-validation (<em>k</em> partitions discussed above) via evaluation of the receiver operating characteristic of the AUC and omission error (<span class="citation"><a href="#ref-fielding_review_1997" role="doc-biblioref">Fielding and Bell</a> (<a href="#ref-fielding_review_1997" role="doc-biblioref">1997</a>)</span>, <span class="citation"><a href="#ref-phillips_maximum_2006" role="doc-biblioref">Phillips, Anderson, and Schapire</a> (<a href="#ref-phillips_maximum_2006" role="doc-biblioref">2006</a>)</span>, <span class="citation"><a href="#ref-pearson_predicting_2007" role="doc-biblioref">Pearson et al.</a> (<a href="#ref-pearson_predicting_2007" role="doc-biblioref">2007</a>)</span>, <span class="citation"><a href="#ref-anderson_species-specific_2011" role="doc-biblioref">Anderson and Gonzalez</a> (<a href="#ref-anderson_species-specific_2011" role="doc-biblioref">2011</a>)</span>).</p>
<p>For AUC, the fraction of true positives relative to type I error (positive background points) is compared at all possible thresholds for each model (<span class="citation"><a href="#ref-fielding_review_1997" role="doc-biblioref">Fielding and Bell</a> (<a href="#ref-fielding_review_1997" role="doc-biblioref">1997</a>)</span>, <span class="citation"><a href="#ref-phillips_maximum_2006" role="doc-biblioref">Phillips, Anderson, and Schapire</a> (<a href="#ref-phillips_maximum_2006" role="doc-biblioref">2006</a>)</span>). The resultant plot’s area under the curve is assessed relative to a random model (<span class="math inline">\(AUC = 0.50\)</span>), such that values close to <span class="math inline">\(1.00\)</span> indicate strong model performance and those <span class="math inline">\(\leq 0.50\)</span> suggest poor performance (<span class="citation"><a href="#ref-fielding_review_1997" role="doc-biblioref">Fielding and Bell</a> (<a href="#ref-fielding_review_1997" role="doc-biblioref">1997</a>)</span>). Given presence only data, measured AUC cannot reach <span class="math inline">\(1.00\)</span>, but model AUCs that approach <span class="math inline">\(1.00\)</span> are considered to perform well (<span class="citation"><a href="#ref-wiley_niche_2003" role="doc-biblioref">Wiley et al.</a> (<a href="#ref-wiley_niche_2003" role="doc-biblioref">2003</a>)</span>, <span class="citation"><a href="#ref-phillips_maximum_2006" role="doc-biblioref">Phillips, Anderson, and Schapire</a> (<a href="#ref-phillips_maximum_2006" role="doc-biblioref">2006</a>)</span>).</p>
<p>Given recent concerns with model evaluation with AUC (<span class="citation"><a href="#ref-peterson_rethinking_2008" role="doc-biblioref">A. Townsend Peterson, Papeş, and Soberón</a> (<a href="#ref-peterson_rethinking_2008" role="doc-biblioref">2008</a>)</span>, <span class="citation"><a href="#ref-lobo_auc:_2008" role="doc-biblioref">Lobo, Jiménez-Valverde, and Real</a> (<a href="#ref-lobo_auc:_2008" role="doc-biblioref">2008</a>)</span>, <span class="citation"><a href="#ref-jimenezvalverde_insights_2012" role="doc-biblioref">Jiménez‐Valverde</a> (<a href="#ref-jimenezvalverde_insights_2012" role="doc-biblioref">2012</a>)</span>), we confirmed model performance with average omission error, which measures the proportion of presence point(s) predicted with suitability less than the minimum training presence threshold (<span class="citation"><a href="#ref-pearson_predicting_2007" role="doc-biblioref">Pearson et al.</a> (<a href="#ref-pearson_predicting_2007" role="doc-biblioref">2007</a>)</span>, <span class="citation"><a href="#ref-anderson_species-specific_2011" role="doc-biblioref">Anderson and Gonzalez</a> (<a href="#ref-anderson_species-specific_2011" role="doc-biblioref">2011</a>)</span>).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#read in summary table and view</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"models_summary"</span><span class="op">)</span>

<span class="co">#print results</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">models_summary</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="5%">
<col width="8%">
<col width="12%">
<col width="11%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">model</th>
<th align="right">avg_test_auc</th>
<th align="right">avg_omission_error</th>
<th align="right">atc_contribution</th>
<th align="right">bio01_contribution</th>
<th align="right">bio02_contribution</th>
<th align="right">bio12_contribution</th>
<th align="right">bio15_contribution</th>
<th align="right">elev_contribution</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">sdm_toh</td>
<td align="right">0.7779</td>
<td align="right">0.0003</td>
<td align="right">61.03</td>
<td align="right">36.74</td>
<td align="right">0.06</td>
<td align="right">1.08</td>
<td align="right">0.81</td>
<td align="right">0.28</td>
</tr>
<tr class="even">
<td align="left">sdm_slf1</td>
<td align="right">0.9828</td>
<td align="right">0.0064</td>
<td align="right">57.16</td>
<td align="right">22.97</td>
<td align="right">1.95</td>
<td align="right">11.63</td>
<td align="right">5.96</td>
<td align="right">0.32</td>
</tr>
<tr class="odd">
<td align="left">sdm_slf2</td>
<td align="right">0.9675</td>
<td align="right">0.0032</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<p>The three models performed similarly, albeit with small differences across model performance metrics. Notably, the variables that contributed most the <em>sdm_toh</em> also contributed most to <em>sdm_slf1</em>, albeit at differing amounts. Thus, we created a consensus output map by averaging the three models as an ensemble.</p>
<p>To visualize the models and produce the ensemble model image, we first had to convert the mean model for each set of replicates (<code>species_name_avg.asc</code>) and convert it to a GeoTIFF (<code>.tif</code>), which is more easily visualized and stored (example code below).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span>  <span class="co">#open no run if</span>

<span class="co">#my path to the GoogleDrive shared directory</span>
<span class="va">mypath</span> <span class="op">&lt;-</span> <span class="st">"/Volumes/GoogleDrive/Shared drives/slfRiskMapping/data/slfRisk"</span>

<span class="co">#read in file as ASCII raster</span>
<span class="va">enm_data_slf</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"maxent_models/10_21_20_maxent_slf_full/Lycorma_delicatula__White,_1845__avg.asc"</span><span class="op">)</span><span class="op">)</span>

<span class="co">#make sure CRS is WGS84</span>
<span class="fu">crs</span><span class="op">(</span><span class="va">enm_data_slf</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"</span>

<span class="co">#write out as a geotiff</span>
<span class="fu">writeRaster</span><span class="op">(</span>x <span class="op">=</span> <span class="va">enm_data_slf</span>, filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">mypath</span>,<span class="st">"maxent_models/slf.tif"</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"GTiff"</span><span class="op">)</span>

  <span class="op">}</span> <span class="co">#closes no run if</span></code></pre></div>
</div>
<div id="ensemble-model" class="section level2">
<h2 class="hasAnchor">
<a href="#ensemble-model" class="anchor"></a>Ensemble Model</h2>
<p>To create the ensemble model image, we averaged the three models (see code below). The resultant model image was used to extract summary statistics by geopolitical unit.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="cn">FALSE</span>){  <span class="co">#open no run if</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#my path to the GoogleDrive shared directory</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>mypath <span class="ot">&lt;-</span> <span class="st">"/Volumes/GoogleDrive/Shared drives/slfRiskMapping/data/slfRisk"</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#read in a geotiff version of the maxent suitability for all three models</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>toh <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">file.path</span>(mypath,<span class="st">"maxent_models/toh.tif"</span>))</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>slf <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">file.path</span>(mypath,<span class="st">"maxent_models/slf.tif"</span>))</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>slftoh <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">file.path</span>(mypath,<span class="st">"maxent_models/slftoh.tif"</span>))</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#stack the rasters</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>enm_data <span class="ot">&lt;-</span> <span class="fu">stack</span>(<span class="fu">c</span>(toh, slf, slftoh))</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">#make mean raster</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>enm_ensemble <span class="ot">&lt;-</span> <span class="fu">mean</span>(enm_data)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">#write out the resulting file</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(<span class="at">x =</span> enm_ensemble, <span class="at">filename =</span> <span class="fu">file.path</span>(mypath, <span class="st">"maxent_models/slftoh_ensemble_mean.tif"</span>, <span class="at">format =</span> <span class="st">"GTiff"</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="er">}</span> <span class="co">#closes no run if</span></span></code></pre></div>
</div>
</div>
<div id="visualizing-sdms-and-extracting-summary-statistics-by-geopolitical-unit" class="section level1">
<h1 class="hasAnchor">
<a href="#visualizing-sdms-and-extracting-summary-statistics-by-geopolitical-unit" class="anchor"></a>5. Visualizing SDMs and Extracting Summary Statistics by Geopolitical Unit</h1>
<div id="visualization" class="section level2">
<h2 class="hasAnchor">
<a href="#visualization" class="anchor"></a>Visualization</h2>
<p>To make visualization more tractable, we reduced the size of the SDMs by using <code><a href="https://rdrr.io/pkg/raster/man/aggregate.html">raster::aggregate(fun = mean, expand = TRUE, na.rm = TRUE)</a></code> (setting <code>fact=</code> to <code>4</code> for <code>states</code> and <code>10</code> for <code>countries</code>) to reduce the SDM raster resolution. We also clipped the SDMs to the continental US to produce the files used for separate <code>states</code> and <code>countries</code> visualization. The three models can be visualized below for the US and then the world:</p>
<div id="usa-maps" class="section level3">
<h3 class="hasAnchor">
<a href="#usa-maps" class="anchor"></a>USA Maps</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#read in the data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"slf_usa_df"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"slftoh_usa_df"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"toh_usa_df"</span><span class="op">)</span>

<span class="co">#plot just the states and suitability first</span>
<span class="va">sdm_toh_usa</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">toh_usa_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html">rescale</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.9</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>limits<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Suitability"</span>, colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#e31a1c"</span>,<span class="st">"#fd8d3c"</span>, <span class="st">"#fecc5c"</span>, <span class="st">"#FFFFFF"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">'state'</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_quickmap</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">124.7628</span>, <span class="op">-</span><span class="fl">66.94889</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">24.52042</span>, <span class="fl">49.3833</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span>label <span class="op">=</span> <span class="st">"sdm_toh USA"</span><span class="op">)</span>
<span class="va">sdm_slf1_usa</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">slf_usa_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html">rescale</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.9</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>limits<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Suitability"</span>, colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#e31a1c"</span>,<span class="st">"#fd8d3c"</span>, <span class="st">"#fecc5c"</span>, <span class="st">"#FFFFFF"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">'state'</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_quickmap</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">124.7628</span>, <span class="op">-</span><span class="fl">66.94889</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">24.52042</span>, <span class="fl">49.3833</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span>label <span class="op">=</span> <span class="st">"sdm_slf1 USA"</span><span class="op">)</span>
<span class="va">sdm_slf2_usa</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">slftoh_usa_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html">rescale</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.9</span>, show.legend <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>limits<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Suitability"</span>, colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#e31a1c"</span>,<span class="st">"#fd8d3c"</span>, <span class="st">"#fecc5c"</span>, <span class="st">"#FFFFFF"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">'state'</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_quickmap</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">124.7628</span>, <span class="op">-</span><span class="fl">66.94889</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">24.52042</span>, <span class="fl">49.3833</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span>label <span class="op">=</span> <span class="st">"sdm_slf2 USA"</span><span class="op">)</span>

<span class="co">#visualize together</span>
<span class="va">sdm_toh_usa</span> <span class="op">/</span> <span class="va">sdm_slf1_usa</span> <span class="op">/</span> <span class="va">sdm_slf2_usa</span></code></pre></div>
<p><img src="vignette-011-suitability-models_files/figure-html/visualize%20models%20at%20us-1.png" width="960" style="display: block; margin: auto auto auto 0;"></p>
</div>
<div id="world-maps" class="section level3">
<h3 class="hasAnchor">
<a href="#world-maps" class="anchor"></a>World Maps</h3>
<p>Please note that the images for countries are downsized considerably to ensure that the visualization data can be included with the package.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#read in the data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"slf_df"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"slftoh_df"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"toh_df"</span><span class="op">)</span>

<span class="co">#plot just the states and suitability first</span>
<span class="va">sdm_toh</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">toh_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html">rescale</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>limits<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Suitability"</span>, colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#e31a1c"</span>,<span class="st">"#fd8d3c"</span>, <span class="st">"#fecc5c"</span>, <span class="st">"#FFFFFF"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">'world'</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_quickmap</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">164.5</span>, <span class="fl">163.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">55</span>,<span class="fl">85</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span>label <span class="op">=</span> <span class="st">"sdm_toh"</span><span class="op">)</span>
<span class="va">sdm_slf1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">slf_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html">rescale</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>limits<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Suitability"</span>, colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#e31a1c"</span>,<span class="st">"#fd8d3c"</span>, <span class="st">"#fecc5c"</span>, <span class="st">"#FFFFFF"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">'world'</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_quickmap</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">164.5</span>, <span class="fl">163.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">55</span>,<span class="fl">85</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span>label <span class="op">=</span> <span class="st">"sdm_slf1"</span><span class="op">)</span>
<span class="va">sdm_slf2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">slftoh_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html">rescale</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, show.legend <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>limits<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Suitability"</span>, colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#e31a1c"</span>,<span class="st">"#fd8d3c"</span>, <span class="st">"#fecc5c"</span>, <span class="st">"#FFFFFF"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">'world'</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_quickmap</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">164.5</span>, <span class="fl">163.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">55</span>,<span class="fl">85</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span>label <span class="op">=</span> <span class="st">"sdm_slf2"</span><span class="op">)</span>

<span class="co">#visualize together</span>
<span class="va">sdm_toh</span> <span class="op">/</span> <span class="va">sdm_slf1</span> <span class="op">/</span> <span class="va">sdm_slf2</span></code></pre></div>
<p><img src="vignette-011-suitability-models_files/figure-html/visualize%20models%20at%20world-1.png" width="960" style="display: block; margin: auto auto auto 0;"></p>
</div>
<div id="ensemble-maps" class="section level3">
<h3 class="hasAnchor">
<a href="#ensemble-maps" class="anchor"></a>Ensemble Maps</h3>
<p>We can also visualize the ensemble images similarly (see the <code>vignette-030-risk-maps</code> for more detail versions). Note that these visualizations are also downsampled, albeit at <code>fact=4</code> for both maps.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#read in data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"suitability_usa_df"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"suitability_countries_df"</span><span class="op">)</span>

<span class="va">en_usa</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">suitability_usa_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html">rescale</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.9</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>limits<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Suitability"</span>, colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#e31a1c"</span>,<span class="st">"#fd8d3c"</span>, <span class="st">"#fecc5c"</span>, <span class="st">"#FFFFFF"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">'state'</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_quickmap</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">124.7628</span>, <span class="op">-</span><span class="fl">66.94889</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">24.52042</span>, <span class="fl">49.3833</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span>label <span class="op">=</span> <span class="st">"USA Ensemble"</span><span class="op">)</span>

<span class="va">en</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">suitability_countries_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html">rescale</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, show.legend <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>limits<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Suitability"</span>, colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#e31a1c"</span>,<span class="st">"#fd8d3c"</span>, <span class="st">"#fecc5c"</span>, <span class="st">"#FFFFFF"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">'world'</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_quickmap</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">164.5</span>, <span class="fl">163.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">55</span>,<span class="fl">85</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span>label <span class="op">=</span> <span class="st">"Ensemble"</span><span class="op">)</span>

<span class="co">#visualize together</span>
<span class="va">en_usa</span> <span class="op">/</span> <span class="va">en</span></code></pre></div>
<p><img src="vignette-011-suitability-models_files/figure-html/visualize%20ensemble-1.png" width="960" style="display: block; margin: auto auto auto 0;"></p>
</div>
</div>
<div id="extraction-of-summary-statistics" class="section level2">
<h2 class="hasAnchor">
<a href="#extraction-of-summary-statistics" class="anchor"></a>Extraction of Summary Statistics</h2>
<p>With the three original and ensemble SDMs, we extracted summary statistics by geopolitical unit to later use for evaluation of <strong>suitability</strong>. To do this, we use a custom function (<code><a href="../reference/extract_enm.html">slfrsk::extract_enm()</a></code>) that uses a reference shapefile (we use the GADM data saved in the shared GoogleDrive directory but can be obtained online separately, <a href="https://gadm.org/download_world.html" class="uri">https://gadm.org/download_world.html</a>) to isolate the portion of the raster contained within each geopolitical unit and calculate the following summary statistics for suitability values:</p>
<ol style="list-style-type: decimal">
<li><em>mean</em></li>
<li><em>standard deviation</em></li>
<li><em>minimum</em></li>
<li><em>maximum</em></li>
<li>quantiles at the following probabilities:
<ul>
<li><em>0.25</em></li>
<li>
<em>0.50</em> (median)</li>
<li><em>0.75</em></li>
<li><em>0.90</em></li>
</ul>
</li>
</ol>
<p>Here, we demonstrate how we used this function to extract the summary statistics for each <code>state</code> and <code>country</code> used as our measure of <strong>establishment</strong> potential. Note that we do not use the <code>save.plots</code> argument or save the output. We also use the <code>.tif</code> versions of full-scale models for these extractions, due to their smaller size. We show code that works for the <code>ensemble</code> but also include commented-out code to run for an individual model and calculate <code>rsa</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span>  <span class="co">#open no run if</span>

<span class="co">#my path to the GoogleDrive shared directory</span>
<span class="va">mypath</span> <span class="op">&lt;-</span> <span class="st">"/Volumes/GoogleDrive/Shared drives/slfRiskMapping/data/slfRisk"</span>

<span class="co">#shapefile of world by countries</span>
<span class="va">world</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://rgdal.r-forge.r-project.org/reference/readOGR.html">readOGR</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"geo_shapefiles/gadm36_levels_shp/gadm36_0.shp"</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">F</span>, p4s <span class="op">=</span> <span class="st">'+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0'</span><span class="op">)</span>
<span class="co">#shapefile of US states (same sourcce as usa data)</span>
<span class="va">states</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://rgdal.r-forge.r-project.org/reference/readOGR.html">readOGR</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"geo_shapefiles/gadm36_USA_shp/gadm36_USA_1.shp"</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">F</span>, p4s <span class="op">=</span> <span class="st">'+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0'</span><span class="op">)</span>

<span class="co">#load data to test</span>
  <span class="co">#ensemble model</span>
<span class="va">enm_ensemble</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"maxent_models/slftoh_ensemble_mean.tif"</span><span class="op">)</span><span class="op">)</span>

<span class="co">#example of running the function</span>
<span class="co">#extract the states</span>
<span class="va">states_extracts_ensemble</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_enm.html">extract_enm</a></span><span class="op">(</span>enm <span class="op">=</span> <span class="va">enm_ensemble</span>, geoshape <span class="op">=</span> <span class="va">states</span>, id0 <span class="op">=</span> <span class="st">"NAME_1"</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">states</span><span class="op">$</span><span class="va">NAME_1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#optional save the summary data</span>
<span class="fu">write_csv</span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"data-raw/extract_states_slftoh_ensemble_mean.csv"</span><span class="op">)</span>, x <span class="op">=</span> <span class="va">states_extracts_ensemble</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col_names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="co">#countries version</span>
<span class="va">countries_extracts_ensemble</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_enm.html">extract_enm</a></span><span class="op">(</span>enm <span class="op">=</span> <span class="va">enm_ensemble</span>, geoshape <span class="op">=</span> <span class="va">world</span>, id0 <span class="op">=</span> <span class="st">"NAME_0"</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">world</span><span class="op">$</span><span class="va">NAME_0</span><span class="op">)</span><span class="op">)</span>

<span class="fu">write_csv</span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"data-raw/extract_countries_slftoh_ensemble_mean.csv"</span><span class="op">)</span>, x <span class="op">=</span> <span class="va">countries_extracts_ensemble</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col_names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="co">#parallelized version</span>
<span class="va">countries_extracts_ensemble2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_enm2.html">extract_enm2</a></span><span class="op">(</span>enm <span class="op">=</span> <span class="va">enm_ensemble</span>, geoshape <span class="op">=</span> <span class="va">world</span>, id0 <span class="op">=</span> <span class="st">"NAME_0"</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">world</span><span class="op">$</span><span class="va">NAME_0</span><span class="op">)</span>, multipar <span class="op">=</span> <span class="cn">TRUE</span>, ncores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="co">#write out</span>
<span class="fu">write_csv</span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"data-raw/extract_countries_slftoh_ensemble_mean2.csv"</span><span class="op">)</span>, x <span class="op">=</span> <span class="va">countries_extracts_ensemble2</span>, col_names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>


<span class="co">#example with s3</span>
<span class="co">#the threshold if desired:   enm_slftoh$`Minimum training presence Cloglog threshold`[nrow(enm_slftoh)]</span>

<span class="co">#enm_data_slftoh &lt;- raster(file.path(mypath, "maxent_models/11_07_18_maxent_slf+toh_+atc-bio02/lycorma_delicatula_avg.asc"))</span>
<span class="co">#enm_data_slftoh &lt;- raster(file.path(mypath, "maxent_models/slftoh.tif"))</span>
<span class="co">#enm_slftoh &lt;- read_csv(file.path(mypath, "maxent_models/11_07_18_maxent_slf+toh_+atc-bio02/maxentResults.csv"))</span>
<span class="co">#state_extracts_slftoh &lt;- extract_enm(enm = enm_data_slftoh, geoshape = states, id0 = "NAME_1", id = as.character(states$NAME_1), th = enm_slftoh$`Minimum training presence Cloglog threshold`[nrow(enm_slftoh)])</span>

  <span class="op">}</span> <span class="co">#closes no run if</span></code></pre></div>
<p>Ultimately, the saved versions of these extracted suitabilities are saved in <code>/data-raw</code> and then can be handled by the script in the same directory, <code>convert_data-rda.R</code>, to be converted into <code>.rda</code> file(s), which are stored in <code>/data</code> and used by the other vignettes (with few, if any, exceptions that use the shared GoogleDrive).</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-anderson_species-specific_2011" class="csl-entry">
Anderson, Robert P., and Israel Gonzalez. 2011. <span>“Species-Specific Tuning Increases Robustness to Sampling Bias in Models of Species Distributions: <span>An</span> Implementation with <span>Maxent</span>.”</span> <em>Ecological Modelling</em> 222 (15): 2796–2811. <a href="https://doi.org/10.1016/j.ecolmodel.2011.04.011">https://doi.org/10.1016/j.ecolmodel.2011.04.011</a>.
</div>
<div id="ref-fick_worldclim_2017" class="csl-entry">
Fick, Stephen E., and Robert J. Hijmans. 2017. <span>“<span>WorldClim</span> 2: <span>New</span> 1-Km Spatial Resolution Climate Surfaces for Global Land Areas.”</span> <em>International Journal of Climatology</em> 37 (12): 4302–15. <a href="https://doi.org/10.1002/joc.5086">https://doi.org/10.1002/joc.5086</a>.
</div>
<div id="ref-fielding_review_1997" class="csl-entry">
Fielding, Alan H., and John F. Bell. 1997. <span>“A Review of Methods for the Assessment of Prediction Errors in Conservation Presence/Absence Models.”</span> <em>Environmental Conservation</em> 24 (1): 38–49. <a href="https://doi.org/10.1017/S0376892997000088">https://doi.org/10.1017/S0376892997000088</a>.
</div>
<div id="ref-hijmans_very_2005" class="csl-entry">
Hijmans, Robert J., Susan E. Cameron, Juan L. Parra, Peter G. Jones, and Andy Jarvis. 2005. <span>“Very High Resolution Interpolated Climate Surfaces for Global Land Areas.”</span> <em>International Journal of Climatology</em> 25 (15): 1965–78. <a href="https://doi.org/10.1002/joc.1276">https://doi.org/10.1002/joc.1276</a>.
</div>
<div id="ref-jimenezvalverde_insights_2012" class="csl-entry">
Jiménez‐Valverde, Alberto. 2012. <span>“Insights into the Area Under the Receiver Operating Characteristic Curve (<span>AUC</span>) as a Discrimination Measure in Species Distribution Modelling.”</span> <em>Global Ecology and Biogeography</em> 21 (4): 498–507. <a href="https://doi.org/10.1111/j.1466-8238.2011.00683.x">https://doi.org/10.1111/j.1466-8238.2011.00683.x</a>.
</div>
<div id="ref-lobo_auc:_2008" class="csl-entry">
Lobo, Jorge M., Alberto Jiménez-Valverde, and Raimundo Real. 2008. <span>“<span>AUC</span>: <span>A</span> Misleading Measure of the Performance of Predictive Distribution Models.”</span> <em>Global Ecology and Biogeography</em> 17 (2): 145–51. <a href="https://doi.org/10.1111/j.1466-8238.2007.00358.x">https://doi.org/10.1111/j.1466-8238.2007.00358.x</a>.
</div>
<div id="ref-parra_usda-aphis-ppq-cphst_2018" class="csl-entry">
Parra, Greg, Heather Moylett, and Russ Bulluck. 2018. <span>“<span>USDA</span>-<span>APHIS</span>-<span>PPQ</span>-<span>CPHST</span> <span>Technical</span> Working Group Summary Report Spotted Lanternfly, <em><span>Lycorma</span> Delicatula</em> (<span>White</span>, 1845).”</span>
</div>
<div id="ref-pearson_predicting_2007" class="csl-entry">
Pearson, Richard G., Christopher J. Raxworthy, Miguel Nakamura, and A. Townsend Peterson. 2007. <span>“Predicting Species Distributions from Small Numbers of Occurrence Records: <span>A</span> Test Case Using Cryptic Geckos in <span>Madagascar</span>.”</span> <em>Journal of Biogeography</em> 34 (1): 102–17. <a href="https://doi.org/10.1111/j.1365-2699.2006.01594.x">https://doi.org/10.1111/j.1365-2699.2006.01594.x</a>.
</div>
<div id="ref-peterson_rethinking_2008" class="csl-entry">
Peterson, A. Townsend, Monica Papeş, and Jorge Soberón. 2008. <span>“Rethinking Receiver Operating Characteristic Analysis Applications in Ecological Niche Modeling.”</span> <em>Ecological Modelling</em> 213 (1): 63–72. <a href="https://doi.org/10.1016/j.ecolmodel.2007.11.008">https://doi.org/10.1016/j.ecolmodel.2007.11.008</a>.
</div>
<div id="ref-peterson_ecological_2011" class="csl-entry">
Peterson, A Townsend, Jorge Soberón, Richard G Pearson, Robert P Anderson, Enrique Martínez-Meyer, Miguel Nakamura, and Miguel B Araújo. 2011. <em>Ecological Niches and Geographic Distributions</em>. Princeton University Press.
</div>
<div id="ref-phillips_maximum_2006" class="csl-entry">
Phillips, Steven J., Robert P. Anderson, and Robert E. Schapire. 2006. <span>“Maximum Entropy Modeling of Species Geographic Distributions.”</span> <em>Ecological Modelling</em> 190 (3-4): 231–59. <a href="https://doi.org/10.1016/j.ecolmodel.2005.03.026">https://doi.org/10.1016/j.ecolmodel.2005.03.026</a>.
</div>
<div id="ref-simard_mapping_2011" class="csl-entry">
Simard, Marc, Naiara Pinto, Joshua B. Fisher, and Alessandro Baccini. 2011. <span>“Mapping Forest Canopy Height Globally with Spaceborne Lidar.”</span> <em>Journal of Geophysical Research: Biogeosciences</em> 116 (G4). <a href="https://doi.org/10.1029/2011JG001708">https://doi.org/10.1029/2011JG001708</a>.
</div>
<div id="ref-weiss_global_2018" class="csl-entry">
Weiss, D. J., A. Nelson, H. S. Gibson, W. Temperley, S. Peedell, A. Lieber, M. Hancher, et al. 2018. <span>“A Global Map of Travel Time to Cities to Assess Inequalities in Accessibility in 2015.”</span> <em>Nature</em> 553 (7688): 333–36. <a href="https://doi.org/10.1038/nature25181">https://doi.org/10.1038/nature25181</a>.
</div>
<div id="ref-wiley_niche_2003" class="csl-entry">
Wiley, E O, Kristina M McNyset, A Townsend Peterson, C Richard Robins, and Aimee M Stewart. 2003. <span>“Niche Modeling and Geographic Range Predictions in the Marine Environment Using a Machine-Learning Algorithm”</span> 16 (3): 8. https://doi.org/<a href="https://doi.org/10.5670/oceanog.2003.42">https://doi.org/10.5670/oceanog.2003.42</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicholas A. Huron, Jocelyn E. Behm, Matthew R. Helmus.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
