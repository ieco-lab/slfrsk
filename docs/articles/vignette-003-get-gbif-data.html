<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get GBIF Records â€¢ slfrsk</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Get GBIF Records">
<meta property="og:description" content="slfrsk">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">slfrsk</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/vignette-001-overview.html">Overview</a>
</li>
<li>
  <a href="../articles/vignette-002-terms.html">Definitions</a>
</li>
<li>
  <a href="../articles/vignette-040-ee-data.html">Paninvasion Severity App</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Analyses
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li>
      <a href="../articles/vignette-003-get-gbif-data.html">Get GBIF Records</a>
    </li>
    <li>
      <a href="../articles/vignette-010-tidy-data.html">Data Tidying</a>
    </li>
    <li>
      <a href="../articles/vignette-011-suitability-models.html">Suitability Modeling &amp; Evaluation</a>
    </li>
    <li>
      <a href="../articles/vignette-030-potentials-maps.html">Invasion Potentials Maps</a>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Invasion Potential Alignment</a>
      <ul class="dropdown-menu" role="menu">
<li class="divider">
        <li>
          <a href="../articles/vignette-021-quadrant-plots.html">Published (Max)</a>
        </li>
        <li>
          <a href="../articles/vignette-026-quadrant-plots-alt-median.html">Alternate (Median)</a>
        </li>
        <li>
          <a href="../articles/vignette-027-quadrant-plots-alt-mean.html">Alternate (Mean)</a>
        </li>
        <li class="divider">
      </ul>
</li>
    <li>
      <a href="../articles/vignette-041-market-plot.html">Wine Market Shock Severity Evaluation</a>
    </li>
    <li class="divider">
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ieco-lab/slfrsk">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="vignette-003-get-gbif-data_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Get GBIF Records</h1>
            
      
      
      <div class="hidden name"><code>vignette-003-get-gbif-data.Rmd</code></div>

    </div>

    
    
<p>Obtain Coordinate Data from GBIF for SLF and TOH</p>
<hr>
<p>This vignette shows how we obtained the most recent version of data for SLF and TOH coordinates and then cleaned said data for use in SDMs.</p>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>We first loaded the full suite of required libraries. The most critical for this particular vignette is <code>spocc</code>, which is the package that allows us to query <code>GBIF</code> (Global Biodiversity Information Facility).</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">slfrsk</span>) <span class="co">#this package, has extract_enm()</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)  <span class="co">#data manipulation</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">here</span>) <span class="co">#making directory pathways easier on different instances</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">spocc</span>) <span class="co">#query gbif and format as a dataframe</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">scrubr</span>) <span class="co">#clean records for gbif data</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">humboldt</span>) <span class="co">#rarefy points</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tcltk</span>) <span class="co">#humboldt progress bar</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">patchwork</span>) <span class="co">#easy combined plots</span></pre></body></html></div>
</div>
<div id="acquire-and-clean-data" class="section level1">
<h1 class="hasAnchor">
<a href="#acquire-and-clean-data" class="anchor"></a>Acquire and Clean Data</h1>
<div id="acquire-data" class="section level2">
<h2 class="hasAnchor">
<a href="#acquire-data" class="anchor"></a>Acquire Data</h2>
<p>We perform initial queries from GBIF for both SLF and TOH. We set the limit on records to be <span class="math inline">\(10^5\)</span> to capture all TOH records (after an initial test query). Notably, we also limit records to those with coordinates, given our purpose for these data. Our queries use the accepted latin binomial nomenclature for both species.</p>
<p>It bears warning that the TOH query takes a considerable amount of time (<span class="math inline">\(&gt;120s\)</span>). We have it turned off by default (See below for more infomation).</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="kw">if</span>(<span class="fl">FALSE</span>){

<span class="co">#query for both species from gbif with limit of queries to 10^5</span>
<span class="no">slf_gbif</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/spocc/reference/occ.html">occ</a></span>(<span class="kw">query</span> <span class="kw">=</span> <span class="st">'Lycorma delicatula'</span>, <span class="kw">from</span> <span class="kw">=</span> <span class="st">'gbif'</span>, <span class="kw">limit</span> <span class="kw">=</span> <span class="fl">1e5</span>, <span class="kw">has_coords</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">throw_warnings</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">toh_gbif</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/spocc/reference/occ.html">occ</a></span>(<span class="kw">query</span> <span class="kw">=</span> <span class="st">'Ailanthus altissima'</span>, <span class="kw">from</span> <span class="kw">=</span> <span class="st">'gbif'</span>, <span class="kw">limit</span> <span class="kw">=</span> <span class="fl">1e5</span>, <span class="kw">has_coords</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">throw_warnings</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

}</pre></body></html></div>
<p>We then turn the raw output into dataframes via <code>as_tibble()</code>. Oddly, this function fails to strip list items from the TOH data, so we set that particular subset to <code>NULL</code> afterwards to fully flatten the TOH dataset. These results could then be saved for reference/reproducibility and are ultimately called by this vignette to save run time.</p>
<p>We end up also saving a copy of the coordinate results that have been transformed with <code><a href="https://docs.ropensci.org/spocc/reference/occ2df.html">spocc::occ2df()</a></code> as well. The output of this function is a cleaner dataframe that we manipulate for the rest of the vignette.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="kw">if</span>(<span class="fl">FALSE</span>){

<span class="co">#tibble the raw queries for saving</span>
<span class="no">slf_gbif_final</span> <span class="kw">&lt;-</span> <span class="fu">as_tibble</span>(<span class="no">slf_gbif</span>$<span class="no">gbif</span>$<span class="no">data</span>$<span class="no">Lycorma_delicatula</span>)
<span class="no">toh_gbif_final</span> <span class="kw">&lt;-</span> <span class="fu">as_tibble</span>(<span class="no">toh_gbif</span>$<span class="no">gbif</span>$<span class="no">data</span>$<span class="no">Ailanthus_altissima</span>)

<span class="co">#de-listify TOH</span>
<span class="no">toh_gbif_final</span>$<span class="no">networkKeys</span> <span class="kw">&lt;-</span> <span class="kw">NULL</span>

<span class="co">#save the raw queries with the date stamp for current date</span>
<span class="fu">write_csv</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">slf_gbif_final</span>, <span class="kw">file</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(), <span class="st">"data-raw"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>( <span class="st">"slf_gbif_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span>(), <span class="st">"%Y-%d-%m"</span>), <span class="st">".csv"</span>)))
<span class="fu">write_csv</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">toh_gbif_final</span>, <span class="kw">file</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(), <span class="st">"data-raw"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>( <span class="st">"toh_gbif_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span>(), <span class="st">"%Y-%d-%m"</span>), <span class="st">".csv"</span>)))

<span class="co">#turn occ data into df</span>
<span class="no">slf_coords1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/spocc/reference/occ2df.html">occ2df</a></span>(<span class="no">slf_gbif</span>)
<span class="no">toh_coords1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/spocc/reference/occ2df.html">occ2df</a></span>(<span class="no">toh_gbif</span>)

<span class="co">#save the coords as they are</span>
<span class="fu">write_csv</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">slf_coords1</span>, <span class="kw">file</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(), <span class="st">"data-raw"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>( <span class="st">"slf_gbif_raw_coords_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span>(), <span class="st">"%Y-%d-%m"</span>), <span class="st">".csv"</span>)))
<span class="fu">write_csv</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">toh_coords1</span>, <span class="kw">file</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(), <span class="st">"data-raw"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>( <span class="st">"toh_gbif_raw_coords_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span>(), <span class="st">"%Y-%d-%m"</span>), <span class="st">".csv"</span>)))

}</pre></body></html></div>
<p>Here is where we read in the raw data queried for this study:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co">#read in raw data</span>
<span class="no">slf_coords1</span> <span class="kw">&lt;-</span> <span class="fu">read_csv</span>(<span class="kw">file</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(), <span class="st">"data-raw"</span>, <span class="st">"slf_gbif_raw_coords_2020-20-10.csv"</span>))
<span class="no">toh_coords1</span> <span class="kw">&lt;-</span> <span class="fu">read_csv</span>(<span class="kw">file</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(), <span class="st">"data-raw"</span>, <span class="st">"toh_gbif_raw_coords_2020-20-10.csv"</span>))</pre></body></html></div>
</div>
<div id="clean-data" class="section level2">
<h2 class="hasAnchor">
<a href="#clean-data" class="anchor"></a>Clean Data</h2>
<p>Now we can proceed to clean the data for use. We clean the data in three regards:</p>
<ol style="list-style-type: decimal">
<li>consistent taxonomic labels</li>
<li>coordinate veracity</li>
<li>coordinate rarefication</li>
</ol>
<div id="consistent-taxonomy" class="section level3">
<h3 class="hasAnchor">
<a href="#consistent-taxonomy" class="anchor"></a>Consistent Taxonomy</h3>
<p>Firstly, we check for taxonomic consistency in each dataset. <em>Spoiler</em>: SLF is fine and TOH needs to be homogenized. Thankfully, a check of the GBIF page for TOH (<a href="https://www.gbif.org/species/3190653" class="uri">https://www.gbif.org/species/3190653</a>) shows that all of the other names are just junior synonyms. Therefore, we change all of them to the same taxonomy.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co">#check the taxonomy for only correct queries</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">slf_coords1</span>$<span class="no">name</span>) <span class="co">#all the same</span>
<span class="co">#&gt; [1] "Lycorma delicatula (White, 1845)"</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">toh_coords1</span>$<span class="no">name</span>)
<span class="co">#&gt; [1] "Ailanthus altissima (Mill.) Swingle"                              </span>
<span class="co">#&gt; [2] "Ailanthus altissima var. altissima"                               </span>
<span class="co">#&gt; [3] "Ailanthus altissima var. tanakai (Hayata) Kanehira &amp; Sasaki"      </span>
<span class="co">#&gt; [4] "Ailanthus glandulosa Desf."                                       </span>
<span class="co">#&gt; [5] "Ailanthus giraldii Dode"                                          </span>
<span class="co">#&gt; [6] "Ailanthus vilmoriniana Dode"                                      </span>
<span class="co">#&gt; [7] "Ailanthus altissima subsp. tanakai (Miller) Swingle"              </span>
<span class="co">#&gt; [8] "Ailanthus altissima subsp. altissima"                             </span>
<span class="co">#&gt; [9] "Ailanthus altissima var. sutchuenensis (Dode) Rehder &amp; E.H.Wilson"</span>

<span class="co">#toh data contains a bunch of synonyms according to GBIF (https://www.gbif.org/species/3190653)</span>
<span class="co">#therefore, we are going to make them all the same, the top species designation</span>
<span class="no">toh_coords1</span>$<span class="no">name</span> <span class="kw">&lt;-</span> <span class="st">"Ailanthus altissima (Mill.) Swingle"</span></pre></body></html></div>
</div>
<div id="coordinate-veracity" class="section level3">
<h3 class="hasAnchor">
<a href="#coordinate-veracity" class="anchor"></a>Coordinate Veracity</h3>
<p>Coordinate veracity has several components that amount to removing coordinates that do not make sense. Given the difference in raw records for both species, SLF is easily cleaned of dubious records while TOH has too many records and breaks at least one function (<code><a href="https://docs.ropensci.org/scrubr/reference/dedup.html">scrubr::dedup()</a></code>) if run through the cleaning steps with removal of duplicates before rarefication. To account for this, both datasets run <code><a href="https://docs.ropensci.org/scrubr/reference/dedup.html">scrubr::dedup()</a></code> after rarefication.</p>
<p>We make good use of the <code>scrubr</code> package functions to clean coordinates.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">slf_coords1</span> <span class="kw">&lt;-</span> <span class="no">slf_coords1</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://docs.ropensci.org/scrubr/reference/coords.html">coord_incomplete</a></span>() <span class="kw">%&gt;%</span>  <span class="co">#rm incomplete coords, those that lack valid lat and long</span>
  <span class="fu"><a href="https://docs.ropensci.org/scrubr/reference/coords.html">coord_impossible</a></span>() <span class="kw">%&gt;%</span> <span class="co">#rm impossible coords, those that are not possible (e.g., lat &gt; 90)</span>
  <span class="fu"><a href="https://docs.ropensci.org/scrubr/reference/coords.html">coord_unlikely</a></span>()  <span class="co">#rm unlikely coords, such as those at 0,0</span>
<span class="co">#&gt; Assuming 'latitude' is latitude</span>
<span class="co">#&gt; Assuming 'longitude' is longitude</span>

<span class="co">#toh</span>
<span class="no">toh_coords1</span> <span class="kw">&lt;-</span> <span class="no">toh_coords1</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://docs.ropensci.org/scrubr/reference/coords.html">coord_incomplete</a></span>() <span class="kw">%&gt;%</span>  <span class="co">#rm incomplete coords, those that lack valid lat and long</span>
  <span class="fu"><a href="https://docs.ropensci.org/scrubr/reference/coords.html">coord_impossible</a></span>() <span class="kw">%&gt;%</span> <span class="co">#rm impossible coords, those that are not possible (e.g., lat &gt; 90)</span>
  <span class="fu"><a href="https://docs.ropensci.org/scrubr/reference/coords.html">coord_unlikely</a></span>()      <span class="co">#rm unlikely coords, such as those at 0,0</span>
<span class="co">#&gt; Assuming 'latitude' is latitude</span>
<span class="co">#&gt; Assuming 'longitude' is longitude</span></pre></body></html></div>
</div>
<div id="coordinate-rarefication" class="section level3">
<h3 class="hasAnchor">
<a href="#coordinate-rarefication" class="anchor"></a>Coordinate Rarefication</h3>
<p>We now use the <code>humboldt</code> package rarefaction function <code><a href="https://rdrr.io/pkg/humboldt/man/humboldt.occ.rarefy.html">humboldt::humboldt.occ.rarefy()</a></code> to trime points that are <span class="math inline">\(&lt;10 km\)</span> from each other. This cleaning step reduces spatial autocorrelation in our data, which is a good thing! After this, we run the data through <code><a href="https://docs.ropensci.org/scrubr/reference/dedup.html">scrubr::dedup</a></code>.</p>
<p>Note that the rarefaction takes a while for TOH especially (it is cleaning 67000+ records after all). We also manually remove some points from SLF that are clearly incorrect as of Fall 2020 (after consulting colleagues).</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="kw">if</span>(<span class="fl">FALSE</span>){

<span class="co">#rarefy points</span>
<span class="no">slf_coords2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/humboldt/man/humboldt.occ.rarefy.html">humboldt.occ.rarefy</a></span>(<span class="kw">in.pts</span> <span class="kw">=</span> <span class="no">slf_coords1</span>, <span class="kw">colxy</span> <span class="kw">=</span> <span class="fl">2</span>:<span class="fl">3</span>, <span class="kw">rarefy.dist</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">rarefy.units</span> <span class="kw">=</span> <span class="st">"km"</span>, <span class="kw">run.silent.rar</span> <span class="kw">=</span> <span class="no">F</span>)
<span class="no">toh_coords2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/humboldt/man/humboldt.occ.rarefy.html">humboldt.occ.rarefy</a></span>(<span class="kw">in.pts</span> <span class="kw">=</span> <span class="no">toh_coords1</span>, <span class="kw">colxy</span> <span class="kw">=</span> <span class="fl">2</span>:<span class="fl">3</span>, <span class="kw">rarefy.dist</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">rarefy.units</span> <span class="kw">=</span> <span class="st">"km"</span>, <span class="kw">run.silent.rar</span> <span class="kw">=</span> <span class="no">F</span>)

<span class="co">#dedup now</span>
<span class="no">slf_coords3</span> <span class="kw">&lt;-</span> <span class="no">slf_coords2</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://docs.ropensci.org/scrubr/reference/dedup.html">dedup</a></span>(<span class="kw">how</span> <span class="kw">=</span> <span class="st">"one"</span>, <span class="kw">tolerance</span> <span class="kw">=</span> <span class="fl">0.99</span>)
<span class="no">toh_coords3</span> <span class="kw">&lt;-</span> <span class="no">toh_coords2</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://docs.ropensci.org/scrubr/reference/dedup.html">dedup</a></span>(<span class="kw">how</span> <span class="kw">=</span> <span class="st">"one"</span>, <span class="kw">tolerance</span> <span class="kw">=</span> <span class="fl">0.99</span>)

<span class="co">#rm manually incorrect SLF points</span>
<span class="co">#we have points in: MA, NE, OR, DE coast for SLF that need to be removed</span>
<span class="co">#key should work to get rid of identified points</span>
<span class="no">slf_coords3</span> <span class="kw">&lt;-</span> <span class="no">slf_coords2</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">key</span> <span class="kw">!=</span> <span class="st">"2860187641"</span>) <span class="kw">%&gt;%</span> <span class="co">#rm OR---lat, lon:(43.63691, -121.85569)</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">key</span> <span class="kw">!=</span> <span class="st">"2862292948"</span>) <span class="kw">%&gt;%</span> <span class="co">#rm NE---lat, lon:(42.50641,-101.01562)</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">key</span> <span class="kw">!=</span> <span class="st">"2864687343"</span>) <span class="kw">%&gt;%</span> <span class="co">#rm DE---lat, lon:(37.91855, -75.14999)</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="no">key</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"2856537682"</span>, <span class="st">"2851117559"</span>)) <span class="co">#rm MA---lat, lon: (42.20994, -71.18331)</span>

<span class="co">#change order of final coords to be lat, lon</span>
<span class="no">slf_coords3</span> <span class="kw">&lt;-</span> <span class="no">slf_coords3</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">name</span>, <span class="no">latitude</span>, <span class="no">longitude</span>, <span class="no">prov</span>, <span class="no">date</span>, <span class="no">key</span>)
<span class="no">toh_coords3</span> <span class="kw">&lt;-</span> <span class="no">toh_coords3</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">name</span>, <span class="no">latitude</span>, <span class="no">longitude</span>, <span class="no">prov</span>, <span class="no">date</span>, <span class="no">key</span>)

<span class="co">#write the saved final data</span>
<span class="fu">write_csv</span>(<span class="no">slf_coords3</span>, <span class="kw">file</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(), <span class="st">"data-raw"</span>, <span class="st">"slf_gbif_cleaned_coords_2020.csv"</span>))
<span class="fu">write_csv</span>(<span class="no">toh_coords3</span>, <span class="kw">file</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(), <span class="st">"data-raw"</span>, <span class="st">"toh_gbif_cleaned_coords_2020.csv"</span>))

}</pre></body></html></div>
</div>
</div>
</div>
<div id="visualize-data" class="section level1">
<h1 class="hasAnchor">
<a href="#visualize-data" class="anchor"></a>Visualize Data</h1>
<p>We can read in the final data for looking at the spatial coverage despite the thinning.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co">#read in data for viewing differences</span>
<span class="co">#slf_coords3 &lt;- read_csv(file = file.path(here(), "data-raw", "slf_gbif_cleaned_coords_2020.csv"))</span>
<span class="co">#toh_coords3 &lt;- read_csv(file = file.path(here(), "data-raw", "toh_gbif_cleaned_coords_2020.csv"))</span>

<span class="co">#note: we read in slightly modified versions of the same coords. lat/lon were changed to y/x respectively and the species names were cleaned up. see corresponding section in data-raw/convert_data_rda.R for details</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"slf_points"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"slfrsk"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"toh_points"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"slfrsk"</span>)

<span class="co">#plot the difference</span>
<span class="co">#TOH</span>
<span class="no">map_toh</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>() +
  <span class="fu">geom_polygon</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="fu">map_data</span>(<span class="st">'world'</span>), <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">long</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lat</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">group</span>), <span class="kw">fill</span> <span class="kw">=</span> <span class="fl">NA</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"black"</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">0.15</span>) +
  <span class="fu">geom_point</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">toh_coords1</span>, <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">longitude</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">latitude</span>), <span class="kw">color</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>) +
  <span class="fu">geom_point</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">toh_points</span>, <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">x</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">y</span>), <span class="kw">color</span> <span class="kw">=</span> <span class="st">"blue"</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">2</span>) +
  <span class="fu">coord_quickmap</span>(<span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">164.5</span>, <span class="fl">163.5</span>), <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">55</span>,<span class="fl">85</span>)) +
  <span class="fu">ggtitle</span>(<span class="st">"TOH"</span>) +
  <span class="fu">theme</span>(<span class="kw">panel.grid.major</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">panel.grid.minor</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">panel.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>()) +
  <span class="fu">theme_bw</span>()
<span class="co">#SLF</span>
<span class="no">map_slf</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>() +
  <span class="fu">geom_polygon</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="fu">map_data</span>(<span class="st">'world'</span>), <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">long</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lat</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">group</span>), <span class="kw">fill</span> <span class="kw">=</span> <span class="fl">NA</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"black"</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">0.15</span>) +
  <span class="fu">geom_point</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">slf_coords1</span>, <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">longitude</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">latitude</span>), <span class="kw">color</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>) +
  <span class="fu">geom_point</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">slf_points</span>, <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">x</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">y</span>), <span class="kw">color</span> <span class="kw">=</span> <span class="st">"blue"</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">2</span>) +
  <span class="fu">coord_quickmap</span>(<span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">164.5</span>, <span class="fl">163.5</span>), <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">55</span>,<span class="fl">85</span>)) +
  <span class="fu">ggtitle</span>(<span class="st">"SLF"</span>) +
  <span class="fu">theme</span>(<span class="kw">panel.grid.major</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">panel.grid.minor</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">panel.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>()) +
  <span class="fu">theme_bw</span>()

<span class="co">#patchwork output of both maps</span>
<span class="no">map_toh</span> / <span class="no">map_slf</span></pre></body></html></div>
<p><img src="vignette-003-get-gbif-data_files/figure-html/read%20in%20final%20data-1.png" width="960"></p>
<p>We have practically the same coverage with less autocorrelation (note the dropped false records for SLF)! Now we can use these data for SDMs!</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicholas A. Huron, Jocelyn E. Behm, Matthew R. Helmus.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
