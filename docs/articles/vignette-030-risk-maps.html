<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>vignette-030-risk-maps â€¢ slfrsk</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="vignette-030-risk-maps">
<meta property="og:description" content="slfrsk">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">slfrsk</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">9999.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette-010-tidy-data.html">vignette-010-tidy-data</a>
    </li>
    <li>
      <a href="../articles/vignette-021-quadrant-plots.html">vignette-021-quadrant-plots</a>
    </li>
    <li>
      <a href="../articles/vignette-030-risk-maps.html">vignette-030-risk-maps</a>
    </li>
    <li>
      <a href="../articles/vignette-040-ee-data.html">vignette-040-ee-data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="vignette-030-risk-maps_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>vignette-030-risk-maps</h1>
            
      
      
      <div class="hidden name"><code>vignette-030-risk-maps.Rmd</code></div>

    </div>

    
    
<p>Build and Save Maps of Transport and Establishment Potential</p>
<hr>
<p>This vignette produces the published map figures that demonstrate where <em>Lycorma</em> is most likely to become established, the states and countries that trade most with the <code>future</code> scenario infected states, and shows locations of important viticultural areas (areas of high <strong>impact</strong> potential).</p>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>Here we load the packages required to visualize the maps.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">slfrsk</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rgeos</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">scales</span>)</pre></body></html></div>
<div id="toggle-plotting-options" class="section level2">
<h2 class="hasAnchor">
<a href="#toggle-plotting-options" class="anchor"></a>Toggle plotting options</h2>
<p>As in <code>vignette-021-quadrant-plots</code>, we have several parameters that can be modified to visualize different versions of the figures. Here is where one could change the version of data for the map figures via the following:</p>
<ol style="list-style-type: decimal">
<li>present_transport: Use <code>present</code> or <code>future</code> infected U.S. states?
<ul>
<li>default is <code>FALSE</code> for <code>future</code>
</li>
</ul>
</li>
<li>top_to_plot: Set the number of top <strong>transport</strong> potential partners to plot arrows for?
<ul>
<li>default is <code>10</code>
</li>
</ul>
</li>
</ol>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co">#we need a switch for this map that does the same thing for including the following states: New York, Ohio, West Virginia, North Carolina</span>
<span class="no">present_transport</span> <span class="kw">&lt;-</span> <span class="fl">FALSE</span>
<span class="co"># How many countries and states to highlight for labels?</span>
<span class="no">top_to_plot</span> <span class="kw">&lt;-</span> <span class="fl">10</span></pre></body></html></div>
<p>To build the map plots, we have several sources of data that we need to read in, namely:</p>
<ol style="list-style-type: decimal">
<li>viticultural area geographic locations</li>
<li>suitability maps for <code>U.S. states</code> and all <code>countries</code> from the ensemble model</li>
<li>locations to point to trade partners (capital cities of <code>states</code> and <code>countries</code>)</li>
</ol>
<p>Of note, the actual trade data (<strong>transport</strong> potential) will be read conditionally in a later chunk below.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co">#location of wineries (US and COUNTRIES)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"wineries"</span>)
<span class="co">#need usa enviro raster</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"suitability_usa_df"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"suitability_countries_df"</span>)
<span class="co">#state centers for plot</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"states_centers"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"countries_centers"</span>)</pre></body></html></div>
</div>
</div>
<div id="data-preparation" class="section level1">
<h1 class="hasAnchor">
<a href="#data-preparation" class="anchor"></a>Data preparation</h1>
<p>Now that we have most of the data loaded, we can go ahead and conditionally load the <strong>transport</strong> potential data based on the state of <code>present_transport</code>. The <strong>transport</strong> potential data for <code>states</code> and <code>countries</code> are then combined with the appropriate trade partner coordinate data and an approximate center of the <em>Lycorma</em> invasion in the U.S. is added as an origin for depicting trade arrows in the map figures. The <code>states</code> data are presented first and then the <code>countries</code> thereafter.</p>
<div id="states" class="section level2">
<h2 class="hasAnchor">
<a href="#states" class="anchor"></a>States</h2>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co">#need states trade data</span>
<span class="co">#need to read in trade data to shape network in map figure</span>
<span class="kw">if</span>(<span class="no">present_transport</span> <span class="kw">==</span> <span class="fl">TRUE</span>){
  <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"states_summary_present"</span>)
  <span class="no">states_centers</span> <span class="kw">&lt;-</span> <span class="no">states_centers</span> <span class="kw">%&gt;%</span>
    <span class="co">#remove the invaded states</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="no">geopol_unit</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Delaware"</span>, <span class="st">"Maryland"</span>, <span class="st">"New Jersey"</span>, <span class="st">"Pennsylvania"</span>, <span class="st">"Virginia"</span>)) <span class="kw">%&gt;%</span>
    <span class="co">#remove the others in the dataset</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>), !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">y</span>)) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SLF"</span>, <span class="fl">NA</span>, <span class="fl">40.400189</span>, -<span class="fl">75.917622</span>)) <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">x</span>), <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">y</span>))

<span class="co">#now add the "invaded core" == SLF as a column</span>
<span class="no">states_summary_present</span> <span class="kw">&lt;-</span> <span class="no">states_summary_present</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="st">"SLF"</span>, <span class="no">.</span>) <span class="kw">%&gt;%</span>
  <span class="fu">as_tibble</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">origin</span> <span class="kw">=</span> <span class="no">`"SLF"`</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">`"SLF"`</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">origin</span>, <span class="fu">everything</span>())

<span class="co">#now merge the coords for destinations (ONLY WINE PRODUCING STATES)</span>
<span class="no">states_trade_final</span> <span class="kw">&lt;-</span> <span class="fu">left_join</span>(<span class="no">states_summary_present</span>, <span class="no">states_centers</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"geopol_unit"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>), !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">y</span>))

<span class="co">#add the coords for SLF as a separate set of cols</span>
<span class="no">states_trade_final</span> <span class="kw">&lt;-</span> <span class="no">states_centers</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">geopol_unit</span> <span class="kw">==</span> <span class="st">"SLF"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">x</span>,<span class="no">y</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">xend</span> <span class="kw">=</span> <span class="no">x</span>, <span class="kw">yend</span> <span class="kw">=</span> <span class="no">y</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">xend</span>, <span class="no">yend</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">states_trade_final</span>, <span class="no">.</span>) <span class="kw">%&gt;%</span>
  <span class="fu">as_tibble</span>()

} <span class="kw">else</span> {
  <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"states_summary_future"</span>)

    <span class="no">states_centers</span> <span class="kw">&lt;-</span> <span class="no">states_centers</span> <span class="kw">%&gt;%</span>
    <span class="co">#remove the invaded states</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="no">geopol_unit</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Delaware"</span>, <span class="st">"Maryland"</span>, <span class="st">"New Jersey"</span>, <span class="st">"New York"</span>, <span class="st">"North Carolina"</span>, <span class="st">"Ohio"</span>, <span class="st">"Pennsylvania"</span>, <span class="st">"Virginia"</span>, <span class="st">"West Virginia"</span>)) <span class="kw">%&gt;%</span>
    <span class="co">#remove the others in the dataset</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>), !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">y</span>)) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SLF"</span>, <span class="fl">NA</span>, <span class="fl">40.400189</span>, -<span class="fl">75.917622</span>)) <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">x</span>), <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">y</span>))

        <span class="co">#now add the "invaded core" == SLF as a column</span>
    <span class="no">states_summary_future</span> <span class="kw">&lt;-</span> <span class="no">states_summary_future</span> <span class="kw">%&gt;%</span>
      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="st">"SLF"</span>, <span class="no">.</span>) <span class="kw">%&gt;%</span>
      <span class="fu">as_tibble</span>() <span class="kw">%&gt;%</span>
      <span class="fu">mutate</span>(<span class="kw">origin</span> <span class="kw">=</span> <span class="no">`"SLF"`</span>) <span class="kw">%&gt;%</span>
      <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">`"SLF"`</span>) <span class="kw">%&gt;%</span>
      <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">origin</span>, <span class="fu">everything</span>())

    <span class="co">#now merge the coords for destinations (ONLY WINE PRODUCING STATES)</span>
    <span class="no">states_trade_final</span> <span class="kw">&lt;-</span> <span class="fu">left_join</span>(<span class="no">states_summary_future</span>, <span class="no">states_centers</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"geopol_unit"</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>), !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">y</span>))

    <span class="co">#add the coords for SLF as a separate set of cols</span>
    <span class="no">states_trade_final</span> <span class="kw">&lt;-</span> <span class="no">states_centers</span> <span class="kw">%&gt;%</span>
      <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">geopol_unit</span> <span class="kw">==</span> <span class="st">"SLF"</span>) <span class="kw">%&gt;%</span>
      <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">x</span>,<span class="no">y</span>) <span class="kw">%&gt;%</span>
      <span class="fu">mutate</span>(<span class="kw">xend</span> <span class="kw">=</span> <span class="no">x</span>, <span class="kw">yend</span> <span class="kw">=</span> <span class="no">y</span>) <span class="kw">%&gt;%</span>
      <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">xend</span>, <span class="no">yend</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">states_trade_final</span>, <span class="no">.</span>) <span class="kw">%&gt;%</span>
      <span class="fu">as_tibble</span>()

    }</pre></body></html></div>
</div>
<div id="countries" class="section level2">
<h2 class="hasAnchor">
<a href="#countries" class="anchor"></a>Countries</h2>
<div class="sourceCode" id="cb5"><html><body><pre class="r">
<span class="co">#edit the world centers to also have the SLF US invasion point</span>
<span class="no">countries_centers</span> <span class="kw">&lt;-</span> <span class="no">countries_centers</span> <span class="kw">%&gt;%</span>
  <span class="co">#rm the others in the dataset</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>), !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">y</span>)) <span class="kw">%&gt;%</span>
  <span class="co">#add center for SLF invasion in US</span>
  <span class="co">#rbind(c("SLF", NA, -75.917622, 40.400189)) %&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"SLF"</span>, <span class="kw">times</span> <span class="kw">=</span> <span class="fl">4</span>), -<span class="fl">75.917622</span>, <span class="fl">40.400189</span>)) <span class="kw">%&gt;%</span>  <span class="co">#(x,y) for coords</span>
  <span class="co">#add the netherlands, not a wine country but needs a set of coords</span>
  <span class="co">#rbind(c("Netherlands", NA, unlist(gCentroid(SpatialPointsDataFrame(map_data('world')[map_data('world')$region %in% "Netherlands",1:2], data = map_data('world')[map_data('world')$region %in% "Netherlands",]))@coords))) %&gt;%</span>
  <span class="co">#same for indonesia</span>
  <span class="co">#rbind(c("Indonesia", NA, unlist(gCentroid(SpatialPointsDataFrame(map_data('world')[map_data('world')$region %in% "Indonesia",1:2], data = map_data('world')[map_data('world')$region %in% "Indonesia",]))@coords))) %&gt;%</span>
  <span class="co">#same for these if going for top 25: Singapore, Taiwan, Saudi Arabia, Vietnam, Venezuela, Gibraltar</span>
  <span class="co">#mutate(x = as.numeric(x), y = as.numeric(y), avg_wine = as.numeric(avg_wine))</span>
  <span class="fu">mutate</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">x</span>), <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">y</span>))

<span class="co">#now we manually bump Canada's coords up a little bit to make more visible</span>
<span class="no">countries_centers</span>$<span class="no">y</span>[<span class="no">countries_centers</span>$<span class="no">geopol_unit</span> <span class="kw">==</span> <span class="st">"Canada"</span>] <span class="kw">&lt;-</span> <span class="no">countries_centers</span>$<span class="no">y</span>[<span class="no">countries_centers</span>$<span class="no">geopol_unit</span> <span class="kw">==</span> <span class="st">"Canada"</span>] + <span class="fl">5</span>


<span class="kw">if</span>(<span class="no">present_transport</span> <span class="kw">==</span> <span class="fl">TRUE</span>){
  <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"countries_summary_present"</span>)

  <span class="co">#filter out the countries with SLF</span>
  <span class="no">countries_summary_present</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_present</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="no">geopol_unit</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"China"</span>, <span class="st">"Japan"</span>, <span class="st">"Korea, South"</span>, <span class="st">"India"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="st">"SLF"</span>, <span class="no">.</span>) <span class="kw">%&gt;%</span>
  <span class="fu">as_tibble</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">origin</span> <span class="kw">=</span> <span class="no">`"SLF"`</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">`"SLF"`</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">origin</span>, <span class="fu">everything</span>())

  <span class="co">#now merge the coords for destinations (ONLY WINE PRODUCING countries)</span>
<span class="no">countries_trade_final</span> <span class="kw">&lt;-</span> <span class="fu">left_join</span>(<span class="no">countries_summary_present</span>, <span class="no">countries_centers</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"geopol_unit"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>), !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">y</span>))


} <span class="kw">else</span> {
  <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"countries_summary_future"</span>)

  <span class="co">#filter out the countries with SLF</span>
  <span class="no">countries_summary_future</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_future</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="no">geopol_unit</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"China"</span>, <span class="st">"Japan"</span>, <span class="st">"Korea, South"</span>, <span class="st">"India"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="st">"SLF"</span>, <span class="no">.</span>) <span class="kw">%&gt;%</span>
  <span class="fu">as_tibble</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">origin</span> <span class="kw">=</span> <span class="no">`"SLF"`</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">`"SLF"`</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">origin</span>, <span class="fu">everything</span>())

    <span class="co">#now merge the coords for destinations (ONLY WINE PRODUCING countries)</span>
<span class="no">countries_trade_final</span> <span class="kw">&lt;-</span> <span class="fu">left_join</span>(<span class="no">countries_summary_future</span>, <span class="no">countries_centers</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>), !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">y</span>))

}

<span class="co">#add the coords for SLF as a separate set of cols</span>
<span class="no">countries_trade_final</span> <span class="kw">&lt;-</span> <span class="no">countries_centers</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">geopol_unit</span> <span class="kw">==</span> <span class="st">"SLF"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">x</span>,<span class="no">y</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">xend</span> <span class="kw">=</span> <span class="no">x</span>, <span class="kw">yend</span> <span class="kw">=</span> <span class="no">y</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">xend</span>, <span class="no">yend</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">countries_trade_final</span>, <span class="no">.</span>) <span class="kw">%&gt;%</span>
  <span class="fu">as_tibble</span>()</pre></body></html></div>
</div>
</div>
<div id="plots" class="section level1">
<h1 class="hasAnchor">
<a href="#plots" class="anchor"></a>Plots</h1>
<p>We are now able to plot both the <code>states</code> and <code>countries</code> published map figures. We stepwise add in the different features, beginning with the suitability raster and geopolitical boundary outlines (the latter ships with <code>ggplot2</code> in <code>map_data()</code>). We then add <span style="color: red;">red outlines</span> for the U.S. states that have established <em>Lycorma</em> according to the scenario selected with <code>present_transport</code>. Following that, <span style="color:#a020f0;">purple points</span> are added for viticultural areas. Lastly, we add arrows from the approximate center of the <em>Lycorma</em> invasion in the U.S. to high <strong>transport</strong> potential trade partners.</p>
<div id="states-1" class="section level2">
<h2 class="hasAnchor">
<a href="#states-1" class="anchor"></a>States</h2>
<div class="sourceCode" id="cb6"><html><body><pre class="r">
<span class="co">#plot just the states and suitability first</span>
<span class="no">map_plot</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>() +
  <span class="fu">geom_raster</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">suitability_usa_df</span>, <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">x</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">y</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="fu"><a href="https://scales.r-lib.org//reference/rescale.html">rescale</a></span>(<span class="no">value</span>)), <span class="kw">alpha</span><span class="kw">=</span><span class="fl">0.9</span>, <span class="kw">show.legend</span> <span class="kw">=</span> <span class="no">T</span>) +
  <span class="fu">scale_fill_gradientn</span>(<span class="kw">limits</span><span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>), <span class="kw">name</span> <span class="kw">=</span> <span class="st">"Suitability"</span>, <span class="kw">colors</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#e31a1c"</span>,<span class="st">"#fd8d3c"</span>, <span class="st">"#fecc5c"</span>, <span class="st">"#FFFFFF"</span>))) +
  <span class="fu">geom_polygon</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="fu">map_data</span>(<span class="st">'state'</span>), <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">long</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lat</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">group</span>), <span class="kw">fill</span> <span class="kw">=</span> <span class="fl">NA</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"black"</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">0.10</span>) +
  <span class="fu">theme_bw</span>() +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">""</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">""</span>) +
  <span class="fu">theme</span>(<span class="kw">panel.grid.major</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">panel.grid.minor</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">panel.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>()) +
  <span class="fu">coord_quickmap</span>(<span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">124.7628</span>, -<span class="fl">66.94889</span>), <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">24.52042</span>, <span class="fl">49.3833</span>)) +
  <span class="fu">ggtitle</span>(<span class="kw">label</span> <span class="kw">=</span> <span class="st">""</span>)

<span class="co">#add in lines for the infected states</span>
<span class="kw">if</span>(<span class="no">present_transport</span> <span class="kw">==</span> <span class="fl">TRUE</span>){
  <span class="no">map_plot</span> <span class="kw">&lt;-</span> <span class="no">map_plot</span> +
    <span class="fu">geom_polygon</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="fu">map_data</span>(<span class="st">'state'</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Delaware"</span>, <span class="st">"Maryland"</span>, <span class="st">"New Jersey"</span>, <span class="st">"Pennsylvania"</span>, <span class="st">"Virginia"</span>)), <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">long</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lat</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">group</span>), <span class="kw">fill</span> <span class="kw">=</span> <span class="fl">NA</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"#e31a1c"</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">0.75</span>)

} <span class="kw">else</span>{
  <span class="no">map_plot</span> <span class="kw">&lt;-</span> <span class="no">map_plot</span> +
    <span class="fu">geom_polygon</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="fu">map_data</span>(<span class="st">'state'</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Delaware"</span>, <span class="st">"Maryland"</span>, <span class="st">"New Jersey"</span>, <span class="st">"New York"</span>, <span class="st">"North Carolina"</span>, <span class="st">"Ohio"</span>, <span class="st">"Pennsylvania"</span>, <span class="st">"Virginia"</span>, <span class="st">"West Virginia"</span>)), <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">long</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lat</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">group</span>), <span class="kw">fill</span> <span class="kw">=</span> <span class="fl">NA</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"#e31a1c"</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">0.75</span>)
}

<span class="co">#add in the wine AVA data</span>
<span class="no">map_plot</span> <span class="kw">&lt;-</span> <span class="no">map_plot</span> +
    <span class="fu">geom_point</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">wineries</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">Country</span> <span class="kw">==</span> <span class="st">"United States"</span>), <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">x</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">y</span>), <span class="kw">color</span> <span class="kw">=</span> <span class="st">"black"</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"purple"</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1.5</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">21</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.99</span>, <span class="kw">show.legend</span> <span class="kw">=</span> <span class="no">F</span>)

<span class="co">#add in the trade</span>
<span class="no">map_plot</span> <span class="kw">&lt;-</span> <span class="no">map_plot</span> +
    <span class="fu">geom_curve</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">x</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">y</span>, <span class="kw">xend</span> <span class="kw">=</span> <span class="no">xend</span>, <span class="kw">yend</span> <span class="kw">=</span> <span class="no">yend</span>), <span class="kw">data</span> <span class="kw">=</span> <span class="no">states_trade_final</span> <span class="kw">%&gt;%</span>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">avg_infected_mass</span>)) <span class="kw">%&gt;%</span> <span class="no">.</span>[<span class="fl">1</span>:<span class="no">top_to_plot</span>,], <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">curvature</span> <span class="kw">=</span> <span class="fl">0.33</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.8</span>, <span class="kw">show.legend</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"#778899"</span>,
               <span class="kw">arrow</span> <span class="kw">=</span> <span class="fu">arrow</span>(<span class="kw">ends</span> <span class="kw">=</span> <span class="st">"first"</span>, <span class="kw">length</span> <span class="kw">=</span> <span class="fu">unit</span>(<span class="fl">0.01</span>, <span class="st">"npc"</span>), <span class="kw">type</span> <span class="kw">=</span> <span class="st">"closed"</span>))

<span class="co">#show it</span>
<span class="no">map_plot</span></pre></body></html></div>
<p><img src="vignette-030-risk-maps_files/figure-html/the%20US%20map-1.png" width="720"></p>
</div>
<div id="countries-1" class="section level2">
<h2 class="hasAnchor">
<a href="#countries-1" class="anchor"></a>Countries</h2>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co">#plot just the countries and suitability first</span>
<span class="no">map_plot_countries</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>() +
  <span class="fu">geom_raster</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">suitability_countries_df</span>, <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">x</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">y</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="fu"><a href="https://scales.r-lib.org//reference/rescale.html">rescale</a></span>(<span class="no">value</span>)), <span class="kw">alpha</span><span class="kw">=</span><span class="fl">0.9</span>, <span class="kw">show.legend</span> <span class="kw">=</span> <span class="no">T</span>) +
  <span class="fu">scale_fill_gradientn</span>(<span class="kw">limits</span><span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>), <span class="kw">name</span> <span class="kw">=</span> <span class="st">"Suitability"</span>, <span class="kw">colors</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#e31a1c"</span>,<span class="st">"#fd8d3c"</span>, <span class="st">"#fecc5c"</span>, <span class="st">"#FFFFFF"</span>))) +
  <span class="fu">geom_polygon</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="fu">map_data</span>(<span class="st">'world'</span>), <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">long</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lat</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">group</span>), <span class="kw">fill</span> <span class="kw">=</span> <span class="fl">NA</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"black"</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">0.15</span>) +
  <span class="fu">theme_bw</span>() +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">""</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">""</span>) +
  <span class="fu">theme</span>(<span class="kw">panel.grid.major</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">panel.grid.minor</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">panel.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>()) +
  <span class="fu">coord_quickmap</span>(<span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">164.5</span>, <span class="fl">163.5</span>), <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">55</span>,<span class="fl">85</span>)) +
  <span class="fu">ggtitle</span>(<span class="kw">label</span> <span class="kw">=</span> <span class="st">""</span>)

<span class="co">#add in lines for the infected states</span>
<span class="kw">if</span>(<span class="no">present_transport</span> <span class="kw">==</span> <span class="fl">TRUE</span>){
  <span class="no">map_plot_countries</span> <span class="kw">&lt;-</span> <span class="no">map_plot_countries</span> +
    <span class="fu">geom_polygon</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="fu">map_data</span>(<span class="st">'state'</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Delaware"</span>, <span class="st">"Maryland"</span>, <span class="st">"New Jersey"</span>, <span class="st">"Pennsylvania"</span>, <span class="st">"Virginia"</span>)), <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">long</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lat</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">group</span>), <span class="kw">fill</span> <span class="kw">=</span> <span class="fl">NA</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">0.5</span>)
} <span class="kw">else</span>{
  <span class="no">map_plot_countries</span> <span class="kw">&lt;-</span> <span class="no">map_plot_countries</span> +
    <span class="fu">geom_polygon</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="fu">map_data</span>(<span class="st">'state'</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Delaware"</span>, <span class="st">"Maryland"</span>, <span class="st">"New Jersey"</span>, <span class="st">"New York"</span>, <span class="st">"North Carolina"</span>, <span class="st">"Ohio"</span>, <span class="st">"Pennsylvania"</span>, <span class="st">"Virginia"</span>, <span class="st">"West Virginia"</span>)), <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">long</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lat</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">group</span>), <span class="kw">fill</span> <span class="kw">=</span> <span class="fl">NA</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"#e31a1c"</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">0.75</span>)
}


<span class="co">#add in the wine AVA data (global equivalent)</span>
<span class="no">map_plot_countries</span> <span class="kw">&lt;-</span> <span class="no">map_plot_countries</span> +
  <span class="fu">geom_point</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">wineries</span>, <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">x</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">y</span>), <span class="kw">color</span> <span class="kw">=</span> <span class="st">"black"</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"purple"</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">21</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.99</span>, <span class="kw">stroke</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">show.legend</span> <span class="kw">=</span> <span class="no">F</span>)

<span class="co">#add in the trade</span>
<span class="no">map_plot_countries</span> <span class="kw">&lt;-</span> <span class="no">map_plot_countries</span> +
  <span class="fu">geom_curve</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">x</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">y</span>, <span class="kw">xend</span> <span class="kw">=</span> <span class="no">xend</span>, <span class="kw">yend</span> <span class="kw">=</span> <span class="no">yend</span>), <span class="kw">data</span> <span class="kw">=</span> <span class="no">countries_trade_final</span> <span class="kw">%&gt;%</span>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">avg_infected_mass</span>)) <span class="kw">%&gt;%</span> <span class="no">.</span>[<span class="fl">1</span>:<span class="no">top_to_plot</span>,], <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.45</span>, <span class="kw">curvature</span> <span class="kw">=</span> <span class="fl">0.33</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.8</span>, <span class="kw">show.legend</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"#778899"</span>, <span class="kw">arrow</span> <span class="kw">=</span> <span class="fu">arrow</span>(<span class="kw">ends</span> <span class="kw">=</span> <span class="st">"first"</span>, <span class="kw">length</span> <span class="kw">=</span> <span class="fu">unit</span>(<span class="fl">0.01</span>, <span class="st">"npc"</span>), <span class="kw">type</span> <span class="kw">=</span> <span class="st">"closed"</span>))

<span class="co">#print it</span>
<span class="no">map_plot_countries</span></pre></body></html></div>
<p><img src="vignette-030-risk-maps_files/figure-html/plot%20map%20of%20countries-1.png" width="720"></p>
</div>
</div>
<div id="write-plot-output" class="section level1">
<h1 class="hasAnchor">
<a href="#write-plot-output" class="anchor"></a>Write plot output</h1>
<p>Lastly, we can save the output of our map figure plots as <code>.pdf</code> files to <code>/vignettes</code>. Note that this chunk does not run by default when knitting the vignette!</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="kw">if</span>(<span class="no">present_transport</span>){
<span class="co">#states</span>
  <span class="fu">ggsave</span>(<span class="kw">plot</span> <span class="kw">=</span> <span class="no">map_plot</span>, <span class="kw">filename</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(),<span class="st">"vignettes"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"states_map_present.pdf"</span>)), <span class="kw">width</span> <span class="kw">=</span> <span class="fl">7.5</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">6.5</span>, <span class="kw">dpi</span> <span class="kw">=</span> <span class="fl">300</span>)
<span class="co">#countries</span>
  <span class="fu">ggsave</span>(<span class="kw">plot</span> <span class="kw">=</span> <span class="no">map_plot_countries</span>, <span class="kw">filename</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(),<span class="st">"vignettes"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"countries_map_present.pdf"</span>)), <span class="kw">width</span> <span class="kw">=</span> <span class="fl">7.5</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">6.5</span>, <span class="kw">dpi</span> <span class="kw">=</span> <span class="fl">300</span>)
} <span class="kw">else</span>{
  <span class="co">#states</span>
  <span class="fu">ggsave</span>(<span class="kw">plot</span> <span class="kw">=</span> <span class="no">map_plot</span>, <span class="kw">filename</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(),<span class="st">"vignettes"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"states_map_future.pdf"</span>)), <span class="kw">width</span> <span class="kw">=</span> <span class="fl">7.5</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">6.5</span>, <span class="kw">dpi</span> <span class="kw">=</span> <span class="fl">300</span>)
<span class="co">#countries</span>
  <span class="fu">ggsave</span>(<span class="kw">plot</span> <span class="kw">=</span> <span class="no">map_plot_countries</span>, <span class="kw">filename</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(),<span class="st">"vignettes"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"countries_map_future.pdf"</span>)), <span class="kw">width</span> <span class="kw">=</span> <span class="fl">7.5</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">6.5</span>, <span class="kw">dpi</span> <span class="kw">=</span> <span class="fl">300</span>)
}</pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by M.R. Helmus.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
