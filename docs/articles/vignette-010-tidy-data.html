<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Tidying • slfrsk</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Data Tidying">
<meta property="og:description" content="slfrsk">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">slfrsk</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/vignette-001-overview.html">Overview</a>
</li>
<li>
  <a href="../articles/vignette-002-terms.html">Definitions</a>
</li>
<li>
  <a href="../articles/vignette-040-ee-data.html">Paninvasion Severity App</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Analyses
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Step 1: Estimate Invasion Potentials</a>
      <ul class="dropdown-menu" role="menu">
<li class="divider">
        <li>
          <a href="../articles/vignette-003-get-gbif-data.html">Get GBIF Records</a>
        </li>
        <li>
          <a href="../articles/vignette-010-tidy-data.html">Data Tidying</a>
        </li>
        <li>
          <a href="../articles/vignette-011-suitability-models.html">Species Distribution Modeling</a>
        </li>
        <li class="divider">
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Step 2: Calculate Alignment Correlations</a>
      <ul class="dropdown-menu" role="menu">
<li class="divider">
        <li>
          <a href="../articles/vignette-030-potentials-maps.html">Invasion Potential Maps</a>
        </li>
        <li class="dropdown-submenu">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Invasion Potential Alignment</a>
          <ul class="dropdown-menu" role="menu">
<li class="divider">
            <li>
              <a href="../articles/vignette-021-quadrant-plots.html">Published (Max)</a>
            </li>
            <li>
              <a href="../articles/vignette-026-quadrant-plots-alt-median.html">Alternate (Median)</a>
            </li>
            <li>
              <a href="../articles/vignette-027-quadrant-plots-alt-mean.html">Alternate (Mean)</a>
            </li>
            <li class="divider">
          </ul>
</li>
        <li class="divider">
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Step 3: Quantify Paninvasion Severity</a>
      <ul class="dropdown-menu" role="menu">
<li class="divider">
        <li>
          <a href="../articles/vignette-041-market-plot.html">Paninvasion Severity</a>
        </li>
        <li>
          <a href="../articles/vignette-050-ava-temp.html">West Coast AVAs vs Temperature</a>
        </li>
        <li class="divider">
      </ul>
</li>
    <li class="divider">
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ieco-lab/slfrsk">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="vignette-010-tidy-data_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Data Tidying</h1>
            
      
      
      <div class="hidden name"><code>vignette-010-tidy-data.Rmd</code></div>

    </div>

    
    
<p>Wrangle and Tidy Package data</p>
<hr>
<p>All of the following data sources will be read in as raw data from <code>slfrsk/data/</code> (originally cleaned a bit from raw data versions in <code>slfrsk/data-raw/</code>) and then cleaned up individually in this vignette (see <code>/data-raw/convert_data_rda.R</code> for script and commenting that includes earlier unit conversion and transformation of raw data from <code>.csv</code> to <code>.rda</code> files used here). Depending on the situation, the resultant “cleaned/tidied” data may be saved to <code>slfrsk/data/</code> as a new <code>.rda</code> file. In this vignette, the following data are treated:</p>
<ol style="list-style-type: decimal">
<li>Establishment potential</li>
<li>Transport potential</li>
<li>Impact potential</li>
</ol>
<hr>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>Here we load the required packages to prepare the data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">slfrsk</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="establishment" class="section level1">
<h1 class="hasAnchor">
<a href="#establishment" class="anchor"></a>Establishment</h1>
<div id="maxent-ensemble-model" class="section level2">
<h2 class="hasAnchor">
<a href="#maxent-ensemble-model" class="anchor"></a>Maxent Ensemble Model</h2>
<p>Previously, we built three separate species distribution models (SDMs) with MaxEnt. We also obtained summary statistics for suitability in each geopolitical unit (country and U.S. state) in each SDM (as well as an ensemble SDM), which were transferred to the <code>states_extracts</code> and <code>countries_extracts</code> datasets (or <code>states_extracts_ensemble</code> and <code>countries_extracts_ensemble</code> for the ensemble SDM).</p>
<p>Here, we explore the ensemble <em>maximum suitability</em> by obtaining the maximum suitability per geopolitical unit for each SDM and calculating the <em>mean</em> and <em>standard error</em> across the models (or just use the extracted maximum value for ensemble models). These summarized suitabilities constitute our predicted <strong>Establishment potential</strong>.</p>
<p>We also strip <em>Western Sahara</em> from the <code>countries</code> datasets here and for other datsets, as it is not informative for our analyses (zero trade for <strong>Transport potential</strong> below).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#new extract of ensemble</span>
<span class="kw">if</span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"states_extracts_ensemble"</span><span class="op">)</span>

<span class="va">summary_states_extracts</span> <span class="op">&lt;-</span> <span class="va">states_extracts_ensemble</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">geopol_unit</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarize</span><span class="op">(</span>grand_mean_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">obs_max</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"countries_extracts_ensemble"</span><span class="op">)</span>
  
<span class="va">summary_countries_extracts</span> <span class="op">&lt;-</span> <span class="va">countries_extracts_ensemble</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">geopol_unit</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarize</span><span class="op">(</span>grand_mean_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">obs_max</span><span class="op">)</span><span class="op">)</span>

<span class="co">#rm W. Sahara</span>
<span class="va">summary_countries_extracts</span> <span class="op">&lt;-</span> <span class="va">summary_countries_extracts</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">geopol_unit</span> <span class="op">!=</span> <span class="st">"Western Sahara"</span><span class="op">)</span>
  
<span class="op">}</span></code></pre></div>
<hr>
</div>
</div>
<div id="transport" class="section level1">
<h1 class="hasAnchor">
<a href="#transport" class="anchor"></a>Transport</h1>
<div id="import-trade-data" class="section level2">
<h2 class="hasAnchor">
<a href="#import-trade-data" class="anchor"></a>Import Trade Data</h2>
<p>Now that <strong>Establishment</strong> data are nicely organized, we can move on to <strong>Transport</strong>. We estimate <strong>Transport potential</strong> based on the average annual mass of goods traded (in metric tons) with <strong>SLF</strong>-established U.S. states over 2012–2017 (we also track value of traded goods in USD). Our existing data can be partitioned into geopolitical units as above (states and countries), but can further be separated into two categories: 1. states with confirmed <strong>SLF</strong> populations (<code>present</code>) and 2. states that have a high probability of hosting <strong>SLF</strong> populations in the near future based on proximity to <code>present</code> states and records of isolated observations (<code>future</code>).</p>
<p>Although we maintain several possible permutations of data to analyze, we focus on mass of goods traded for <code>future</code> scenarios, as these data are unlikely to be skewed by trade of high value goods that are less likely to lead to transportation of egg masses (e.g., electronics) and provide us with a more careful outlook for risk of slf paninvasion.</p>
<div id="u-s--states" class="section level3">
<h3 class="hasAnchor">
<a href="#u-s--states" class="anchor"></a>U.S. States</h3>
<p>We first treat the states data by adding two letter codes and <strong>SLF</strong>-establishment status. For <code>present</code>, we treat the following states as having established <strong>SLF</strong>: <strong>DE, MD, NJ, PA, and VA</strong>. For <code>future</code>, we add the following states as having established <strong>SLF</strong>: <strong>NC, NY, OH, and WV</strong>. From here, the data are tidied and gathered before calculating the mean and standard error (SE) of trade with established states for 2012–2017. To do so, we first removed all cases of intrastate trade for established states. Then, we calculated the total trade with established states for each year before obtaining the overall mean and SE.</p>
<p>Below, we demonstrate the code for both <code>present</code> and <code>future</code> trade data in value (USD) for U.S. <code>states</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#load states value</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"states_trade_summary_slf"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"states_trade_summary_slf_future"</span><span class="op">)</span>

<span class="co">#code snippet to attach infection status and add state abbreviations</span>
<span class="co">#state id's for adding to extracts</span>
<span class="va">stateid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AL"</span>, <span class="st">"AK"</span>, <span class="st">"AZ"</span>, <span class="st">"AR"</span>, <span class="st">"CA"</span>, <span class="st">"CO"</span>, <span class="st">"CT"</span>, <span class="st">"DE"</span>, <span class="st">"FL"</span>, <span class="st">"GA"</span>, <span class="st">"HI"</span>, <span class="st">"ID"</span>, <span class="st">"IL"</span>, <span class="st">"IN"</span>, <span class="st">"IA"</span>, <span class="st">"KS"</span>, <span class="st">"KY"</span>, <span class="st">"LA"</span>, <span class="st">"ME"</span>, <span class="st">"MD"</span>, <span class="st">"MA"</span>, <span class="st">"MI"</span>, <span class="st">"MN"</span>, <span class="st">"MS"</span>, <span class="st">"MO"</span>, <span class="st">"MT"</span>, <span class="st">"NE"</span>, <span class="st">"NV"</span>, <span class="st">"NH"</span>, <span class="st">"NJ"</span>, <span class="st">"NM"</span>, <span class="st">"NY"</span>, <span class="st">"NC"</span>, <span class="st">"ND"</span>, <span class="st">"OH"</span>, <span class="st">"OK"</span>, <span class="st">"OR"</span>, <span class="st">"PA"</span>, <span class="st">"RI"</span>, <span class="st">"SC"</span>, <span class="st">"SD"</span>, <span class="st">"TN"</span>, <span class="st">"TX"</span>, <span class="st">"UT"</span>, <span class="st">"VT"</span>, <span class="st">"VA"</span>, <span class="st">"WA"</span>, <span class="st">"DC"</span>, <span class="st">"WV"</span>, <span class="st">"WI"</span>, <span class="st">"WY"</span><span class="op">)</span>
<span class="va">stateid</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span><span class="va">stateid</span>, <span class="va">states_trade_summary_slf</span><span class="op">$</span><span class="va">destination</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">stateid</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"geopol_unit"</span><span class="op">)</span>

<span class="co">#PRESENT</span>

<span class="co">#add in the infection status of each state while adding the abbreviations</span>
 <span class="va">states_trade_summary_slf</span> <span class="op">&lt;-</span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">states_trade_summary_slf</span>, <span class="va">stateid</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"destination"</span> <span class="op">=</span> <span class="st">"geopol_unit"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CT"</span>, <span class="st">"DE"</span>, <span class="st">"MD"</span>, <span class="st">"NJ"</span>, <span class="st">"NY"</span>, <span class="st">"OH"</span>, <span class="st">"PA"</span>, <span class="st">"VA"</span>, <span class="st">"WV"</span><span class="op">)</span>, <span class="st">"established"</span>, <span class="st">"not established"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">destination</span>, <span class="va">ID</span>, <span class="va">status</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co">#tidying of data</span>
  <span class="va">states_trade_summary_slf</span> <span class="op">&lt;-</span> <span class="va">states_trade_summary_slf</span> <span class="op">%&gt;%</span>
    <span class="fu">gather</span><span class="op">(</span><span class="op">-</span><span class="va">destination</span><span class="op">:</span><span class="op">-</span><span class="va">status</span>, key <span class="op">=</span> <span class="st">"infected_state"</span>, value <span class="op">=</span> <span class="st">"trade"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>
  
  <span class="co">#total infected states trade, average/SE</span>
  <span class="va">summary_states_trade_value</span> <span class="op">&lt;-</span> <span class="va">states_trade_summary_slf</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">#filter to be just trade with infected states present</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"pa_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"de_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"va_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"nj_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"md_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"ct_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"ny_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"oh_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"wv_"</span><span class="op">)</span>
           <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">#remove the all state trade from consideration</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"201"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"all"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  
    <span class="co">#make a temporary col</span>
    <span class="fu">mutate</span><span class="op">(</span>tempcol <span class="op">=</span> <span class="fu">str_split</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"_"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  
    <span class="co">#group by row</span>
    <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="co">#split out the info about states and years of trade</span>
    <span class="fu">mutate</span><span class="op">(</span>source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tempcol</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tempcol</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">#rm the temp col</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">tempcol</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="co">#group based now on the destination, year, and infection status</span>
    <span class="co">#filter out the intrastate trade for infected states to avoid extra low averages by creating a hybrid string (DestinationState+abbreviated_infected state)</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span>, <span class="va">year</span>, <span class="va">status</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">mutate</span><span class="op">(</span>clear_intra <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">destination</span>, <span class="va">source</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">clear_intra</span> <span class="op">%in%</span> 
             <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Connecticutct"</span>, 
               <span class="st">"Delawarede"</span>, 
               <span class="st">"Marylandmd"</span>, 
               <span class="st">"New Jerseynj"</span>, 
               <span class="st">"New Yorkny"</span>, 
               <span class="st">"Ohiooh"</span>, 
               <span class="st">"Pennsylvaniapa"</span>, 
               <span class="st">"Virginiava"</span>, 
               <span class="st">"West Virginiawv"</span><span class="op">)</span>
           <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">#remove workaround infected intrastate column</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">clear_intra</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">#add up the trade with infected states for each destination state and year (THIS IS NOT AVG INFECTED TRADE YET)</span>
    <span class="fu">summarize</span><span class="op">(</span>avg_infected_trade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">trade</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span>, <span class="va">status</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">#obtain the standard error (SE) of infected trade across years (this repeats across all of the entries across years and thus becomes its own value)</span>
    <span class="fu">mutate</span><span class="op">(</span>se <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">avg_infected_trade</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="co">#summarize the mean and SE across years! (there is no need to actually take the mean of SE here, but it makes summarizing simplier)</span>
    <span class="fu">summarise</span><span class="op">(</span>avg_infected_trade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">avg_infected_trade</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span>  
  
<span class="co">#FUTURE</span>
    <span class="va">states_trade_summary_slf_future</span> <span class="op">&lt;-</span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">states_trade_summary_slf_future</span>, <span class="va">stateid</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"destination"</span> <span class="op">=</span> <span class="st">"geopol_unit"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CT"</span>, <span class="st">"DE"</span>, <span class="st">"MD"</span>, <span class="st">"NC"</span>, <span class="st">"NJ"</span>, <span class="st">"NY"</span>, <span class="st">"OH"</span>, <span class="st">"PA"</span>, <span class="st">"VA"</span>, <span class="st">"WV"</span><span class="op">)</span>, <span class="st">"established"</span>, <span class="st">"not established"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">destination</span>, <span class="va">ID</span>, <span class="va">status</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co">#tidying of data</span>
  <span class="va">states_trade_summary_slf_future</span> <span class="op">&lt;-</span> <span class="va">states_trade_summary_slf_future</span> <span class="op">%&gt;%</span>
    <span class="fu">gather</span><span class="op">(</span><span class="op">-</span><span class="va">destination</span><span class="op">:</span><span class="op">-</span><span class="va">status</span>, key <span class="op">=</span> <span class="st">"infected_state"</span>, value <span class="op">=</span> <span class="st">"trade"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>
  
  <span class="co">#total infected states trade, average/SE</span>
  <span class="va">summary_states_trade_value_future</span> <span class="op">&lt;-</span> <span class="va">states_trade_summary_slf_future</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"pa_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"de_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"va_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"nj_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"md_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"nc_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"ny_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"oh_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"wv_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"ct_"</span><span class="op">)</span>
           <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"201"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"all"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>tempcol <span class="op">=</span> <span class="fu">str_split</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"_"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tempcol</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tempcol</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">tempcol</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span>, <span class="va">year</span>, <span class="va">status</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">#filter out the intrastate trade for infected states to avoid extra low averages</span>
    <span class="fu">mutate</span><span class="op">(</span>clear_intra <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">destination</span>, <span class="va">source</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">clear_intra</span> <span class="op">%in%</span> 
             <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Connecticutct"</span>, 
               <span class="st">"Delawarede"</span>, 
               <span class="st">"Marylandmd"</span>, 
               <span class="st">"North Carolinanc"</span>, 
               <span class="st">"New Jerseynj"</span>, 
               <span class="st">"New Yorkny"</span>, 
               <span class="st">"Ohiooh"</span>, 
               <span class="st">"Pennsylvaniapa"</span>, 
               <span class="st">"Virginiava"</span>, 
               <span class="st">"West Virginiawv"</span>
               <span class="op">)</span>
           <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">#remove workaround infected intrastate column</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">clear_intra</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">summarize</span><span class="op">(</span>avg_infected_trade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">trade</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span>, <span class="va">status</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>se <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">avg_infected_trade</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">summarise</span><span class="op">(</span>avg_infected_trade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">avg_infected_trade</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We repeat the same process for <code>states</code> but for the total mass of imported goods (<code>mass</code>). In doing so, we convert the existing units from kg to <strong>metric tons</strong>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#load states mass</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"states_trade_mass_summary_slf"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"states_trade_mass_summary_slf_future"</span><span class="op">)</span>

<span class="co">#PRESENT</span>
  <span class="co">#add in the infection status of each state while adding the abbreviations</span>
   <span class="va">states_trade_mass_summary_slf</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">states_trade_mass_summary_slf</span>, <span class="va">stateid</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"destination"</span> <span class="op">=</span> <span class="st">"geopol_unit"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CT"</span>, <span class="st">"DE"</span>, <span class="st">"MD"</span>, <span class="st">"NJ"</span>, <span class="st">"NY"</span>, <span class="st">"OH"</span>, <span class="st">"PA"</span>, <span class="st">"VA"</span>, <span class="st">"WV"</span><span class="op">)</span>, <span class="st">"established"</span>, <span class="st">"not established"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">destination</span>, <span class="va">ID</span>, <span class="va">status</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

     <span class="co">#tidying of data and dividing by 1000 to convert from kg to metric tons</span>
  <span class="va">states_trade_mass_summary_slf</span> <span class="op">&lt;-</span> <span class="va">states_trade_mass_summary_slf</span> <span class="op">%&gt;%</span>
    <span class="fu">gather</span><span class="op">(</span><span class="op">-</span><span class="va">destination</span><span class="op">:</span><span class="op">-</span><span class="va">status</span>, key <span class="op">=</span> <span class="st">"infected_state"</span>, value <span class="op">=</span> <span class="st">"mass"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>mass <span class="op">=</span> <span class="va">mass</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>
  
  <span class="co">#mass</span>
  <span class="va">summary_states_trade_mass</span> <span class="op">&lt;-</span> <span class="va">states_trade_mass_summary_slf</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">#filter to be just trade with infected states present</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"pa_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"de_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"va_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"nj_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"md_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"ct_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"ny_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"oh_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"wv_"</span><span class="op">)</span>
           <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"201"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"all"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>tempcol <span class="op">=</span> <span class="fu">str_split</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"_"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tempcol</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tempcol</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">tempcol</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span>, <span class="va">year</span>, <span class="va">status</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">#filter out the intrastate trade for infected states to avoid extra low averages</span>
    <span class="fu">mutate</span><span class="op">(</span>clear_intra <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">destination</span>, <span class="va">source</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">clear_intra</span> <span class="op">%in%</span> 
             <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Connecticutct"</span>, 
               <span class="st">"Delawarede"</span>, 
               <span class="st">"Marylandmd"</span>, 
               <span class="st">"New Jerseynj"</span>, 
               <span class="st">"New Yorkny"</span>, 
               <span class="st">"Ohiooh"</span>, 
               <span class="st">"Pennsylvaniapa"</span>, 
               <span class="st">"Virginiava"</span>, 
               <span class="st">"West Virginiawv"</span><span class="op">)</span>
           <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">#remove workaround infected intrastate column</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">clear_intra</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">summarize</span><span class="op">(</span>avg_infected_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">mass</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span>, <span class="va">status</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>se <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">avg_infected_mass</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">summarise</span><span class="op">(</span>avg_infected_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">avg_infected_mass</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span>

<span class="co">#FUTURE</span>
   <span class="co">#add col to identify infected states</span>
  <span class="va">states_trade_mass_summary_slf_future</span> <span class="op">&lt;-</span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">states_trade_mass_summary_slf_future</span>, <span class="va">stateid</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"destination"</span> <span class="op">=</span> <span class="st">"geopol_unit"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CT"</span>, <span class="st">"DE"</span>, <span class="st">"MD"</span>, <span class="st">"NC"</span>, <span class="st">"NJ"</span>, <span class="st">"NY"</span>, <span class="st">"OH"</span>, <span class="st">"PA"</span>, <span class="st">"VA"</span>, <span class="st">"WV"</span><span class="op">)</span>, <span class="st">"established"</span>, <span class="st">"not established"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">destination</span>, <span class="va">ID</span>, <span class="va">status</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co">#tidying of data and dividing by 1000 to convert from kg to metric tons</span>
  <span class="va">states_trade_mass_summary_slf_future</span> <span class="op">&lt;-</span> <span class="va">states_trade_mass_summary_slf_future</span> <span class="op">%&gt;%</span>
    <span class="fu">gather</span><span class="op">(</span><span class="op">-</span><span class="va">destination</span><span class="op">:</span><span class="op">-</span><span class="va">status</span>, key <span class="op">=</span> <span class="st">"infected_state"</span>, value <span class="op">=</span> <span class="st">"mass"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>mass <span class="op">=</span> <span class="va">mass</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>
  
  <span class="co">#mass</span>
  <span class="va">summary_states_trade_mass_future</span> <span class="op">&lt;-</span> <span class="va">states_trade_mass_summary_slf_future</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"pa_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"de_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"va_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"nj_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"md_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"nc_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"ny_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"oh_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"wv_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"ct_"</span><span class="op">)</span>
           <span class="op">)</span> <span class="op">%&gt;%</span>    
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"201"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"all"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>tempcol <span class="op">=</span> <span class="fu">str_split</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"_"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tempcol</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tempcol</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">tempcol</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span>, <span class="va">year</span>, <span class="va">status</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">#filter out the intrastate trade for infected states to avoid extra low averages</span>
    <span class="fu">mutate</span><span class="op">(</span>clear_intra <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">destination</span>, <span class="va">source</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">clear_intra</span> <span class="op">%in%</span> 
             <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Connecticutct"</span>, 
               <span class="st">"Delawarede"</span>, 
               <span class="st">"Marylandmd"</span>, 
               <span class="st">"North Carolinanc"</span>, 
               <span class="st">"New Jerseynj"</span>, 
               <span class="st">"New Yorkny"</span>, 
               <span class="st">"Ohiooh"</span>, 
               <span class="st">"Pennsylvaniapa"</span>, 
               <span class="st">"Virginiava"</span>, 
               <span class="st">"West Virginiawv"</span>
               <span class="op">)</span>
           <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">#remove workaround infected intrastate column</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">clear_intra</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">summarize</span><span class="op">(</span>avg_infected_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">mass</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span>, <span class="va">status</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>se <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">avg_infected_mass</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">summarise</span><span class="op">(</span>avg_infected_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">avg_infected_mass</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<blockquote>
<p>Here, you can see the summary for the first 10 states for the <code>future</code> trade data for mass of trade (metric tons).</p>
</blockquote>
<table class="table">
<thead><tr class="header">
<th align="left">destination</th>
<th align="left">status</th>
<th align="right">avg_infected_mass</th>
<th align="right">se</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Alabama</td>
<td align="left">not established</td>
<td align="right">8042185.41</td>
<td align="right">89597.110</td>
</tr>
<tr class="even">
<td align="left">Alaska</td>
<td align="left">not established</td>
<td align="right">91775.66</td>
<td align="right">3473.339</td>
</tr>
<tr class="odd">
<td align="left">Arizona</td>
<td align="left">not established</td>
<td align="right">1541726.22</td>
<td align="right">30613.203</td>
</tr>
<tr class="even">
<td align="left">Arkansas</td>
<td align="left">not established</td>
<td align="right">2122765.62</td>
<td align="right">15105.761</td>
</tr>
<tr class="odd">
<td align="left">California</td>
<td align="left">not established</td>
<td align="right">16449015.73</td>
<td align="right">447722.953</td>
</tr>
<tr class="even">
<td align="left">Colorado</td>
<td align="left">not established</td>
<td align="right">1789258.81</td>
<td align="right">25597.146</td>
</tr>
<tr class="odd">
<td align="left">Connecticut</td>
<td align="left">established</td>
<td align="right">24300544.86</td>
<td align="right">249553.550</td>
</tr>
<tr class="even">
<td align="left">Delaware</td>
<td align="left">established</td>
<td align="right">17481966.16</td>
<td align="right">345415.534</td>
</tr>
<tr class="odd">
<td align="left">District of Columbia</td>
<td align="left">not established</td>
<td align="right">3122179.60</td>
<td align="right">30663.092</td>
</tr>
<tr class="even">
<td align="left">Florida</td>
<td align="left">not established</td>
<td align="right">13669574.02</td>
<td align="right">397146.471</td>
</tr>
</tbody>
</table>
</div>
<div id="countries" class="section level3">
<h3 class="hasAnchor">
<a href="#countries" class="anchor"></a>Countries</h3>
<p>From here, we turn to complete the same analyses for <code>countries</code> as states (value of trade in USD and then mass of trade in metric tons). Notably, we do not have to worry about the intrastate trade that we filtered out in the <code>states</code> datasets. As such, we do not bother with attaching a <code>$status</code> identifier to each country (this is done as needed for visualization later).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#COUNTRIES</span>

<span class="co">#VALUE</span>
<span class="co">#load countries values</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"countries_trade_summary_slf"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"countries_trade_summary_slf_future"</span><span class="op">)</span>

<span class="co">#PRESENT</span>

<span class="co">#tidying of data and log transforming values</span>
<span class="va">countries_trade_summary_slf</span> <span class="op">&lt;-</span> <span class="va">countries_trade_summary_slf</span> <span class="op">%&gt;%</span>
  <span class="fu">gather</span><span class="op">(</span><span class="op">-</span><span class="va">destination</span>, key <span class="op">=</span> <span class="st">"infected_state"</span>, value <span class="op">=</span> <span class="st">"trade"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>

  <span class="co">#value</span>
  <span class="va">summary_countries_trade_value</span> <span class="op">&lt;-</span> <span class="va">countries_trade_summary_slf</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"pa_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"de_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"va_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"nj_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"md_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"ct_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"ny_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"oh_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"wv_"</span><span class="op">)</span>
           <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"201"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"all"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>tempcol <span class="op">=</span> <span class="fu">str_split</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"_"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tempcol</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tempcol</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">tempcol</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">summarize</span><span class="op">(</span>avg_infected_trade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">trade</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>se <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">avg_infected_trade</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">summarise</span><span class="op">(</span>avg_infected_trade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">avg_infected_trade</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span>

<span class="co">#FUTURE</span>
  
<span class="co">#tidying of data and log transforming values</span>
<span class="va">countries_trade_summary_slf_future</span> <span class="op">&lt;-</span> <span class="va">countries_trade_summary_slf_future</span> <span class="op">%&gt;%</span>
  <span class="fu">gather</span><span class="op">(</span><span class="op">-</span><span class="va">destination</span>, key <span class="op">=</span> <span class="st">"infected_state"</span>, value <span class="op">=</span> <span class="st">"trade"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>

  <span class="co">#value</span>
  <span class="va">summary_countries_trade_value_future</span> <span class="op">&lt;-</span> <span class="va">countries_trade_summary_slf_future</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"pa_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"de_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"va_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"nj_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"md_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"nc_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"ny_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"oh_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"wv_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"ct_"</span><span class="op">)</span>
           <span class="op">)</span> <span class="op">%&gt;%</span>    
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"201"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"all"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>tempcol <span class="op">=</span> <span class="fu">str_split</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"_"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tempcol</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tempcol</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">tempcol</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">summarize</span><span class="op">(</span>avg_infected_trade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">trade</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>se <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">avg_infected_trade</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">summarise</span><span class="op">(</span>avg_infected_trade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">avg_infected_trade</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span>

<span class="co">#MASS</span>
<span class="co">#load countries mass</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"countries_trade_mass_summary_slf"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"countries_trade_mass_summary_slf_future"</span><span class="op">)</span>

<span class="co">#PRESENT</span>

<span class="co">#tidying of data and converting from kg to metric tons </span>
<span class="va">countries_trade_mass_summary_slf</span> <span class="op">&lt;-</span> <span class="va">countries_trade_mass_summary_slf</span> <span class="op">%&gt;%</span>
  <span class="fu">gather</span><span class="op">(</span><span class="op">-</span><span class="va">destination</span>, key <span class="op">=</span> <span class="st">"infected_state"</span>, value <span class="op">=</span> <span class="st">"mass"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>mass <span class="op">=</span> <span class="va">mass</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>

  <span class="co">#mass</span>
  <span class="va">summary_countries_trade_mass</span> <span class="op">&lt;-</span> <span class="va">countries_trade_mass_summary_slf</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"pa_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"de_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"va_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"nj_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"md_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"ct_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"ny_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"oh_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"wv_"</span><span class="op">)</span>
           <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"201"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"all"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>tempcol <span class="op">=</span> <span class="fu">str_split</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"_"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tempcol</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tempcol</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">tempcol</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">summarize</span><span class="op">(</span>avg_infected_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">mass</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>se <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">avg_infected_mass</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">summarise</span><span class="op">(</span>avg_infected_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">avg_infected_mass</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span>
  
<span class="co">#FUTURE</span>
  
<span class="co">#tidying of data and converting from kg to metric tons </span>
<span class="va">countries_trade_mass_summary_slf_future</span> <span class="op">&lt;-</span> <span class="va">countries_trade_mass_summary_slf_future</span> <span class="op">%&gt;%</span>
  <span class="fu">gather</span><span class="op">(</span><span class="op">-</span><span class="va">destination</span>, key <span class="op">=</span> <span class="st">"infected_state"</span>, value <span class="op">=</span> <span class="st">"mass"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>mass <span class="op">=</span> <span class="va">mass</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>

  <span class="co">#mass</span>
  <span class="va">summary_countries_trade_mass_future</span> <span class="op">&lt;-</span> <span class="va">countries_trade_mass_summary_slf_future</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"pa_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"de_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"va_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"nj_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"md_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"nc_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"ny_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"oh_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"wv_"</span><span class="op">)</span> <span class="op">|</span> 
             <span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"ct_"</span><span class="op">)</span>
           <span class="op">)</span> <span class="op">%&gt;%</span>    
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"201"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"all"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>tempcol <span class="op">=</span> <span class="fu">str_split</span><span class="op">(</span><span class="va">infected_state</span>, <span class="st">"_"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tempcol</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tempcol</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">tempcol</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">summarize</span><span class="op">(</span>avg_infected_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">mass</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">destination</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>se <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">avg_infected_mass</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">summarise</span><span class="op">(</span>avg_infected_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">avg_infected_mass</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<blockquote>
<p>Here, you can see the summary for the first 10 countries for the <code>future</code> trade data for mass of trade (metric tons), just like the <code>states</code> data.</p>
</blockquote>
<table class="table">
<thead><tr class="header">
<th align="left">destination</th>
<th align="right">avg_infected_mass</th>
<th align="right">se</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Afghanistan</td>
<td align="right">29071.49650</td>
<td align="right">9715.82565</td>
</tr>
<tr class="even">
<td align="left">Albania</td>
<td align="right">13101.98933</td>
<td align="right">3989.92572</td>
</tr>
<tr class="odd">
<td align="left">Algeria</td>
<td align="right">138022.73517</td>
<td align="right">35664.42137</td>
</tr>
<tr class="even">
<td align="left">Andorra</td>
<td align="right">96.19667</td>
<td align="right">24.11481</td>
</tr>
<tr class="odd">
<td align="left">Angola</td>
<td align="right">29848.68950</td>
<td align="right">3197.03340</td>
</tr>
<tr class="even">
<td align="left">Anguilla</td>
<td align="right">1281.39267</td>
<td align="right">184.55033</td>
</tr>
<tr class="odd">
<td align="left">Antigua and Barbuda</td>
<td align="right">4080.22700</td>
<td align="right">1238.47426</td>
</tr>
<tr class="even">
<td align="left">Argentina</td>
<td align="right">643884.60350</td>
<td align="right">151554.71666</td>
</tr>
<tr class="odd">
<td align="left">Armenia</td>
<td align="right">6604.53150</td>
<td align="right">968.13989</td>
</tr>
<tr class="even">
<td align="left">Aruba</td>
<td align="right">57376.83367</td>
<td align="right">30835.63316</td>
</tr>
</tbody>
</table>
</div>
<div id="combined-final-trade-data" class="section level3">
<h3 class="hasAnchor">
<a href="#combined-final-trade-data" class="anchor"></a>Combined Final Trade Data</h3>
<p>Now that we have several permutations of trade with <strong>SLF</strong>-established states data (both <code>present</code> and <code>future</code> scenarios) for both geopolitical units (<code>states</code> and <code>countries</code>) as measured in <strong>value</strong> and <strong>mass</strong> (USD and metric tons, respectively), we can combine some of these data into fewer dataframes to minimize the number of files we are juggling for future analyses. To do this, we merge the <strong>value</strong> and <strong>mass</strong> data for each geopolitical unit dataset.</p>
<p>As we do so, we take the time to create <span class="math inline">\(\log_{10}\)</span> transformed versions of the trade <strong>value</strong> and <strong>mass</strong> data. To avoid possible errors for this transformation, we add a constant (<span class="math inline">\(value+1\)</span>) to data prior to transformation. This process for transformation is held constant for <strong>Impact potential</strong> data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#STATES</span>
<span class="va">summary_states_trade</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">summary_states_trade_value</span>, <span class="va">summary_states_trade_mass</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"destination"</span>, <span class="st">"status"</span><span class="op">)</span>, suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"_trade"</span>, <span class="st">"_mass"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>log10_avg_infected_trade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">avg_infected_trade</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>, log10_avg_infected_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">avg_infected_mass</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="va">summary_states_trade_future</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">summary_states_trade_value_future</span>, <span class="va">summary_states_trade_mass_future</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"destination"</span>, <span class="st">"status"</span><span class="op">)</span>, suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"_trade"</span>, <span class="st">"_mass"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>log10_avg_infected_trade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">avg_infected_trade</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>, log10_avg_infected_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">avg_infected_mass</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="co">#COUNTRIES</span>

<span class="va">summary_countries_trade</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">summary_countries_trade_value</span>, <span class="va">summary_countries_trade_mass</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"destination"</span><span class="op">)</span>, suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"_trade"</span>, <span class="st">"_mass"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">destination</span> <span class="op">!=</span> <span class="st">"Western Sahara"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>log10_avg_infected_trade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">avg_infected_trade</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>, log10_avg_infected_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">avg_infected_mass</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="va">summary_countries_trade_future</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">summary_countries_trade_value_future</span>, <span class="va">summary_countries_trade_mass_future</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"destination"</span><span class="op">)</span>, suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"_trade"</span>, <span class="st">"_mass"</span><span class="op">)</span><span class="op">)</span>  <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">destination</span> <span class="op">!=</span> <span class="st">"Western Sahara"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>log10_avg_infected_trade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">avg_infected_trade</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>, log10_avg_infected_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">avg_infected_mass</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<blockquote>
<p>Here is the merged <code>states</code> data for <code>future</code>:</p>
</blockquote>
<table class="table">
<colgroup>
<col width="14%">
<col width="11%">
<col width="13%">
<col width="6%">
<col width="12%">
<col width="7%">
<col width="17%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th align="left">destination</th>
<th align="left">status</th>
<th align="right">avg_infected_trade</th>
<th align="right">se_trade</th>
<th align="right">avg_infected_mass</th>
<th align="right">se_mass</th>
<th align="right">log10_avg_infected_trade</th>
<th align="right">log10_avg_infected_mass</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Alabama</td>
<td align="left">not established</td>
<td align="right">25746519575</td>
<td align="right">86757733</td>
<td align="right">8042185.41</td>
<td align="right">89597.110</td>
<td align="right">10.41072</td>
<td align="right">6.905374</td>
</tr>
<tr class="even">
<td align="left">Alaska</td>
<td align="left">not established</td>
<td align="right">3682900711</td>
<td align="right">231580906</td>
<td align="right">91775.66</td>
<td align="right">3473.339</td>
<td align="right">9.56619</td>
<td align="right">4.962732</td>
</tr>
<tr class="odd">
<td align="left">Arizona</td>
<td align="left">not established</td>
<td align="right">16164900001</td>
<td align="right">134829727</td>
<td align="right">1541726.22</td>
<td align="right">30613.203</td>
<td align="right">10.20857</td>
<td align="right">6.188008</td>
</tr>
<tr class="even">
<td align="left">Arkansas</td>
<td align="left">not established</td>
<td align="right">10808696870</td>
<td align="right">42330206</td>
<td align="right">2122765.62</td>
<td align="right">15105.761</td>
<td align="right">10.03377</td>
<td align="right">6.326902</td>
</tr>
<tr class="odd">
<td align="left">California</td>
<td align="left">not established</td>
<td align="right">114295367886</td>
<td align="right">471914734</td>
<td align="right">16449015.73</td>
<td align="right">447722.953</td>
<td align="right">11.05803</td>
<td align="right">7.216140</td>
</tr>
<tr class="even">
<td align="left">Colorado</td>
<td align="left">not established</td>
<td align="right">15392144303</td>
<td align="right">237938106</td>
<td align="right">1789258.81</td>
<td align="right">25597.146</td>
<td align="right">10.18730</td>
<td align="right">6.252673</td>
</tr>
<tr class="odd">
<td align="left">Connecticut</td>
<td align="left">established</td>
<td align="right">50771613052</td>
<td align="right">367967442</td>
<td align="right">24300544.86</td>
<td align="right">249553.550</td>
<td align="right">10.70562</td>
<td align="right">7.385616</td>
</tr>
<tr class="even">
<td align="left">Delaware</td>
<td align="left">established</td>
<td align="right">26854722185</td>
<td align="right">498504512</td>
<td align="right">17481966.16</td>
<td align="right">345415.534</td>
<td align="right">10.42902</td>
<td align="right">7.242590</td>
</tr>
<tr class="odd">
<td align="left">District of Columbia</td>
<td align="left">not established</td>
<td align="right">11196345230</td>
<td align="right">573341994</td>
<td align="right">3122179.60</td>
<td align="right">30663.092</td>
<td align="right">10.04908</td>
<td align="right">6.494458</td>
</tr>
<tr class="even">
<td align="left">Florida</td>
<td align="left">not established</td>
<td align="right">67241610026</td>
<td align="right">770574348</td>
<td align="right">13669574.02</td>
<td align="right">397146.471</td>
<td align="right">10.82764</td>
<td align="right">7.135755</td>
</tr>
</tbody>
</table>
<blockquote>
<p>And here is the merged <code>countries</code> data for <code>future</code>:</p>
</blockquote>
<table class="table">
<colgroup>
<col width="15%">
<col width="14%">
<col width="8%">
<col width="13%">
<col width="10%">
<col width="19%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="left">destination</th>
<th align="right">avg_infected_trade</th>
<th align="right">se_trade</th>
<th align="right">avg_infected_mass</th>
<th align="right">se_mass</th>
<th align="right">log10_avg_infected_trade</th>
<th align="right">log10_avg_infected_mass</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Afghanistan</td>
<td align="right">235695855</td>
<td align="right">86773679.7</td>
<td align="right">29071.49650</td>
<td align="right">9715.82565</td>
<td align="right">8.372352</td>
<td align="right">4.463482</td>
</tr>
<tr class="even">
<td align="left">Albania</td>
<td align="right">16536138</td>
<td align="right">2452105.0</td>
<td align="right">13101.98933</td>
<td align="right">3989.92572</td>
<td align="right">7.218434</td>
<td align="right">4.117370</td>
</tr>
<tr class="odd">
<td align="left">Algeria</td>
<td align="right">503940704</td>
<td align="right">64383082.2</td>
<td align="right">138022.73517</td>
<td align="right">35664.42137</td>
<td align="right">8.702379</td>
<td align="right">5.139954</td>
</tr>
<tr class="even">
<td align="left">Andorra</td>
<td align="right">1457978</td>
<td align="right">174345.8</td>
<td align="right">96.19667</td>
<td align="right">24.11481</td>
<td align="right">6.163751</td>
<td align="right">1.987651</td>
</tr>
<tr class="odd">
<td align="left">Angola</td>
<td align="right">119484021</td>
<td align="right">34733545.6</td>
<td align="right">29848.68950</td>
<td align="right">3197.03340</td>
<td align="right">8.077310</td>
<td align="right">4.474940</td>
</tr>
<tr class="even">
<td align="left">Anguilla</td>
<td align="right">3681561</td>
<td align="right">196681.7</td>
<td align="right">1281.39267</td>
<td align="right">184.55033</td>
<td align="right">6.566032</td>
<td align="right">3.108021</td>
</tr>
<tr class="odd">
<td align="left">Antigua and Barbuda</td>
<td align="right">14561905</td>
<td align="right">2078482.2</td>
<td align="right">4080.22700</td>
<td align="right">1238.47426</td>
<td align="right">7.163218</td>
<td align="right">3.610791</td>
</tr>
<tr class="even">
<td align="left">Argentina</td>
<td align="right">1201585227</td>
<td align="right">96144901.7</td>
<td align="right">643884.60350</td>
<td align="right">151554.71666</td>
<td align="right">9.079755</td>
<td align="right">5.808809</td>
</tr>
<tr class="odd">
<td align="left">Armenia</td>
<td align="right">22230451</td>
<td align="right">1940347.2</td>
<td align="right">6604.53150</td>
<td align="right">968.13989</td>
<td align="right">7.346948</td>
<td align="right">3.819908</td>
</tr>
<tr class="even">
<td align="left">Aruba</td>
<td align="right">76165589</td>
<td align="right">9470751.5</td>
<td align="right">57376.83367</td>
<td align="right">30835.63316</td>
<td align="right">7.881759</td>
<td align="right">4.758744</td>
</tr>
</tbody>
</table>
<hr>
</div>
</div>
</div>
<div id="impact" class="section level1">
<h1 class="hasAnchor">
<a href="#impact" class="anchor"></a>Impact</h1>
<p>Given the close relationship between cultivation of grapes (<code>grapes</code>) and winemaking (<code>wine</code>), we evaluate impact potential of <strong>SLF</strong> based on data from both.</p>
<div id="grapes" class="section level2">
<h2 class="hasAnchor">
<a href="#grapes" class="anchor"></a>Grapes</h2>
<p>For <code>grapes</code>, two forms of cultivation data were available:</p>
<ol style="list-style-type: decimal">
<li>grape production (metric tons)</li>
<li>grape yield per unit area (metric tons/hectare)</li>
</ol>
<p>Although provide both sources of data, we focus more on <strong>production</strong> as a total measure of output per geopolitical unit.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"states_grapes"</span><span class="op">)</span>

<span class="co">#summarize and log transform</span>
<span class="va">summary_states_grapes</span> <span class="op">&lt;-</span> <span class="va">states_grapes</span> <span class="op">%&gt;%</span>
  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">Item</span>, values_from <span class="op">=</span> <span class="va">Value</span>, id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">geopol_unit</span>, <span class="va">Year</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">geopol_unit</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarize</span><span class="op">(</span>avg_yield <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">grape_yield</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, 
            se_yield <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">grape_yield</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu">n_distinct</span><span class="op">(</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span>,
            avg_prod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">grape_production</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, se_prod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">grape_production</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu">n_distinct</span><span class="op">(</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span>
            <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">drop_na</span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>log10_avg_yield <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">avg_yield</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>, log10_avg_prod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">avg_prod</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"countries_grapes"</span><span class="op">)</span>

<span class="co">#first rm Western Sahara, then summarize and log transform, while adding in the step of changing NA's to zeros</span>
<span class="va">summary_countries_grapes</span> <span class="op">&lt;-</span> <span class="va">countries_grapes</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">geopol_unit</span> <span class="op">!=</span> <span class="st">"Western Sahara"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">Item</span>, values_from <span class="op">=</span> <span class="va">Value</span>, id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">geopol_unit</span>, <span class="va">Year</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">geopol_unit</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarize</span><span class="op">(</span>avg_yield <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">grape_yield</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, 
            se_yield <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">grape_yield</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu">n_distinct</span><span class="op">(</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span>,
            avg_prod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">grape_production</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, se_prod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">grape_production</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu">n_distinct</span><span class="op">(</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span>
            <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">drop_na</span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>log10_avg_yield <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">avg_yield</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>, log10_avg_prod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">avg_prod</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="co">#fix some problematic names of countries</span>
<span class="va">summary_countries_grapes</span><span class="op">$</span><span class="va">geopol_unit</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"Ivoire"</span>, x <span class="op">=</span> <span class="va">summary_countries_grapes</span><span class="op">$</span><span class="va">geopol_unit</span>, value <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Ivory Coast"</span>
<span class="va">summary_countries_grapes</span><span class="op">$</span><span class="va">geopol_unit</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"Bolivia (Plurinational State of)"</span>, x <span class="op">=</span> <span class="va">summary_countries_grapes</span><span class="op">$</span><span class="va">geopol_unit</span>, value <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Bolivia"</span>
<span class="va">summary_countries_grapes</span><span class="op">$</span><span class="va">geopol_unit</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"China, Taiwan Province of"</span>, x <span class="op">=</span> <span class="va">summary_countries_grapes</span><span class="op">$</span><span class="va">geopol_unit</span>, value <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Taiwan"</span>
<span class="va">summary_countries_grapes</span><span class="op">$</span><span class="va">geopol_unit</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"Iran (Islamic Republic of)"</span>, x <span class="op">=</span> <span class="va">summary_countries_grapes</span><span class="op">$</span><span class="va">geopol_unit</span>, value <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Iran"</span>
<span class="va">summary_countries_grapes</span><span class="op">$</span><span class="va">geopol_unit</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"Venezuela (Bolivarian Republic of)"</span>, x <span class="op">=</span> <span class="va">summary_countries_grapes</span><span class="op">$</span><span class="va">geopol_unit</span>, value <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Venezuela"</span>
<span class="va">summary_countries_grapes</span><span class="op">$</span><span class="va">geopol_unit</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"Viet Nam"</span>, x <span class="op">=</span> <span class="va">summary_countries_grapes</span><span class="op">$</span><span class="va">geopol_unit</span>, value <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Vietnam"</span></code></pre></div>
</div>
<div id="wine" class="section level2">
<h2 class="hasAnchor">
<a href="#wine" class="anchor"></a>Wine</h2>
<p>For <code>wine</code>, we were able to obtain wine production for both geopolitical unit datasets in units of mass, metric tons.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"states_wine"</span><span class="op">)</span>

<span class="co">#summarize and log transform</span>
<span class="va">summary_states_wine</span> <span class="op">&lt;-</span> <span class="va">states_wine</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">geopol_unit</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarize</span><span class="op">(</span>avg_wine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Mass</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, se_wine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">Mass</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu">n_distinct</span><span class="op">(</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span>, log10_avg_wine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Mass</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"countries_wine"</span><span class="op">)</span>

<span class="co">#summarize and log transform, then rm anything that started out as NA or zero</span>
<span class="va">summary_countries_wine</span> <span class="op">&lt;-</span> <span class="va">countries_wine</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">geopol_unit</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarize</span><span class="op">(</span>avg_wine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Mass</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, se_wine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">Mass</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu">n_distinct</span><span class="op">(</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span>, log10_avg_wine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Mass</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html">is.infinite</a></span><span class="op">(</span><span class="va">log10_avg_wine</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html">is.nan</a></span><span class="op">(</span><span class="va">log10_avg_wine</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="potentials-summary" class="section level1">
<h1 class="hasAnchor">
<a href="#potentials-summary" class="anchor"></a>Potentials Summary</h1>
<p>Now that all of these data sources have been summarized and tidied, we will merge them together with <code>left_join()</code> sequentially, using the <code>trade</code> data (<strong>Transport potential</strong>) as the inital dataset that all others are joined to. The resultant datasets contain all permuatations of geopolitical units (<code>states</code> and <code>countries</code>) and infection scenarios (<code>present</code> and <code>future</code>).</p>
<p>During this process, we also use the <code>wine</code> and <code>grape</code> data to produce binary categorical data for each geopolitical unit to indicate whether it is involved directly in that industry. For this, we also manually add the <em>United States</em> as a grape producer in the <code>countries</code> datasets. Additionally, we manually add <code>$status</code> to the <code>countries</code> datasets as follows:</p>
<ul>
<li>Native: <strong>China, India, Taiwan, and Vietnam</strong>
</li>
<li>Established: <strong>Japan, South Korea, and United States</strong>
</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#STATES</span>

<span class="co">##PRESENT</span>

<span class="co">#add the binaries</span>
<span class="va">states_summary_present</span> <span class="op">&lt;-</span> <span class="va">summary_states_extracts</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>grapes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">geopol_unit</span> <span class="op">%in%</span> <span class="va">summary_states_grapes</span><span class="op">$</span><span class="va">geopol_unit</span>, yes <span class="op">=</span> <span class="st">"yes"</span>, no <span class="op">=</span> <span class="st">"no"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>wine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">geopol_unit</span> <span class="op">%in%</span> <span class="va">summary_states_wine</span><span class="op">$</span><span class="va">geopol_unit</span>, yes <span class="op">=</span> <span class="st">"yes"</span>, no <span class="op">=</span> <span class="st">"no"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>grapes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">grapes</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span><span class="op">)</span>, wine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">wine</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> 

<span class="co">#now add in the other data</span>
<span class="va">states_summary_present</span> <span class="op">&lt;-</span> <span class="va">states_summary_present</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>, <span class="va">summary_states_trade</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"geopol_unit"</span> <span class="op">=</span> <span class="st">"destination"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co">#trade</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>, <span class="va">summary_states_wine</span>, by <span class="op">=</span> <span class="st">"geopol_unit"</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co">#wine</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>, <span class="va">summary_states_grapes</span>, by <span class="op">=</span> <span class="st">"geopol_unit"</span><span class="op">)</span>     <span class="co">#grapes</span>

<span class="co">#deal with NA</span>
<span class="va">states_summary_present</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">states_summary_present</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>

<span class="co">#join the new ID's</span>
<span class="va">states_summary_present</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">stateid</span>, <span class="va">states_summary_present</span>, by <span class="op">=</span> <span class="st">"geopol_unit"</span><span class="op">)</span>
<span class="co">#################################</span>
<span class="co">#tidy the order of cols</span>
<span class="va">states_summary_present</span> <span class="op">&lt;-</span> <span class="va">states_summary_present</span> <span class="op">%&gt;%</span>
  <span class="co">#dplyr::select(ID, geopol_unit, status, grand_mean_max, grand_se_max, wine, grapes, avg_wine:log10_avg_prod, everything())</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">geopol_unit</span>, <span class="va">status</span>, <span class="va">grand_mean_max</span>, <span class="va">wine</span>, <span class="va">grapes</span>, <span class="va">avg_wine</span><span class="op">:</span><span class="va">log10_avg_prod</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>


<span class="co">##FUTURE</span>

<span class="co">#add the binaries</span>
<span class="va">states_summary_future</span> <span class="op">&lt;-</span> <span class="va">summary_states_extracts</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>grapes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">geopol_unit</span> <span class="op">%in%</span> <span class="va">summary_states_grapes</span><span class="op">$</span><span class="va">geopol_unit</span>, yes <span class="op">=</span> <span class="st">"yes"</span>, no <span class="op">=</span> <span class="st">"no"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>wine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">geopol_unit</span> <span class="op">%in%</span> <span class="va">summary_states_wine</span><span class="op">$</span><span class="va">geopol_unit</span>, yes <span class="op">=</span> <span class="st">"yes"</span>, no <span class="op">=</span> <span class="st">"no"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>grapes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">grapes</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span><span class="op">)</span>, wine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">wine</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> 

<span class="co">#now add in the other data</span>
<span class="va">states_summary_future</span> <span class="op">&lt;-</span> <span class="va">states_summary_future</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>, <span class="va">summary_states_trade_future</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"geopol_unit"</span> <span class="op">=</span> <span class="st">"destination"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co">#trade</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>, <span class="va">summary_states_wine</span>, by <span class="op">=</span> <span class="st">"geopol_unit"</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co">#wine</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>, <span class="va">summary_states_grapes</span>, by <span class="op">=</span> <span class="st">"geopol_unit"</span><span class="op">)</span>     <span class="co">#grapes</span>

<span class="co">#deal with NA</span>
<span class="va">states_summary_future</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">states_summary_future</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>

<span class="co">#join the new ID's</span>
<span class="va">states_summary_future</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">stateid</span>, <span class="va">states_summary_future</span>, by <span class="op">=</span> <span class="st">"geopol_unit"</span><span class="op">)</span>

<span class="co">#tidy the order of cols</span>
<span class="va">states_summary_future</span> <span class="op">&lt;-</span> <span class="va">states_summary_future</span> <span class="op">%&gt;%</span>
    <span class="co">#dplyr::select(ID, geopol_unit, status, grand_mean_max, grand_se_max, wine, grapes, avg_wine:log10_avg_prod, everything())</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">geopol_unit</span>, <span class="va">status</span>, <span class="va">grand_mean_max</span>, <span class="va">wine</span>, <span class="va">grapes</span>, <span class="va">avg_wine</span><span class="op">:</span><span class="va">log10_avg_prod</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>


<span class="co">#################################</span>



<span class="co">#COUNTRIES</span>

<span class="co">##PRESENT</span>

<span class="co">#add in the binaries</span>
<span class="va">countries_summary_present</span> <span class="op">&lt;-</span> <span class="va">summary_countries_extracts</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>grapes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">geopol_unit</span> <span class="op">%in%</span> <span class="va">summary_countries_grapes</span><span class="op">$</span><span class="va">geopol_unit</span>, yes <span class="op">=</span> <span class="st">"yes"</span>, no <span class="op">=</span> <span class="st">"no"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>wine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">geopol_unit</span> <span class="op">%in%</span> <span class="va">summary_countries_wine</span><span class="op">$</span><span class="va">geopol_unit</span>, yes <span class="op">=</span> <span class="st">"yes"</span>, no <span class="op">=</span> <span class="st">"no"</span><span class="op">)</span><span class="op">)</span>

<span class="co">#change U.S. from no to yes for grapes</span>
<span class="va">countries_summary_present</span><span class="op">$</span><span class="va">grapes</span><span class="op">[</span><span class="va">countries_summary_present</span><span class="op">$</span><span class="va">geopol_unit</span> <span class="op">==</span> <span class="st">"United States"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"yes"</span>

<span class="co">#The factor fixing step is now here</span>
<span class="va">countries_summary_present</span> <span class="op">&lt;-</span> <span class="va">countries_summary_present</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>grapes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">grapes</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span><span class="op">)</span>, wine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">wine</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> 

<span class="co">#now drop NAs for the extracts and add in the other data</span>
<span class="va">countries_summary_present</span> <span class="op">&lt;-</span> <span class="va">countries_summary_present</span> <span class="op">%&gt;%</span>
  <span class="fu">drop_na</span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>, <span class="va">summary_countries_trade</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"geopol_unit"</span> <span class="op">=</span> <span class="st">"destination"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co">#trade</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>, <span class="va">summary_countries_wine</span>, by <span class="op">=</span> <span class="st">"geopol_unit"</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co">#wine</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>, <span class="va">summary_countries_grapes</span>, by <span class="op">=</span> <span class="st">"geopol_unit"</span><span class="op">)</span>     <span class="co">#grapes</span>

<span class="co">#deal with NA</span>
<span class="va">countries_summary_present</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">countries_summary_present</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>

<span class="co"># add ID to make is simpler for labeling points</span>
<span class="va">countries_summary_present</span> <span class="op">&lt;-</span> <span class="va">countries_summary_present</span> <span class="op">%&gt;%</span>  <span class="fu">mutate</span><span class="op">(</span>ID <span class="op">=</span> <span class="va">geopol_unit</span><span class="op">)</span>

<span class="co"># add a column for status establishment</span>
<span class="va">countries_summary_present</span> <span class="op">&lt;-</span> <span class="va">countries_summary_present</span> <span class="op">%&gt;%</span>  <span class="fu">mutate</span><span class="op">(</span>status <span class="op">=</span> <span class="st">"not established"</span><span class="op">)</span>
<span class="va">countries_summary_present</span><span class="op">$</span><span class="va">status</span><span class="op">[</span><span class="va">countries_summary_present</span><span class="op">$</span><span class="va">geopol_unit</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"China"</span>, <span class="st">"India"</span>, <span class="st">"Taiwan"</span>, <span class="st">"Vietnam"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"native"</span>
<span class="va">countries_summary_present</span><span class="op">$</span><span class="va">status</span><span class="op">[</span><span class="va">countries_summary_present</span><span class="op">$</span><span class="va">geopol_unit</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Japan"</span>, <span class="st">"South Korea"</span>, <span class="st">"United States"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"established"</span>

<span class="co">#tidy the order of cols</span>
<span class="va">countries_summary_present</span> <span class="op">&lt;-</span> <span class="va">countries_summary_present</span> <span class="op">%&gt;%</span>
    <span class="co">#dplyr::select(ID, geopol_unit, status, grand_mean_max, grand_se_max, wine, grapes, avg_wine:log10_avg_prod, everything())</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">geopol_unit</span>, <span class="va">status</span>, <span class="va">grand_mean_max</span>, <span class="va">wine</span>, <span class="va">grapes</span>, <span class="va">avg_wine</span><span class="op">:</span><span class="va">log10_avg_prod</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co">##FUTURE</span>

<span class="co">#add in the binaries</span>
<span class="va">countries_summary_future</span> <span class="op">&lt;-</span> <span class="va">summary_countries_extracts</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>grapes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">geopol_unit</span> <span class="op">%in%</span> <span class="va">summary_countries_grapes</span><span class="op">$</span><span class="va">geopol_unit</span>, yes <span class="op">=</span> <span class="st">"yes"</span>, no <span class="op">=</span> <span class="st">"no"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>wine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">geopol_unit</span> <span class="op">%in%</span> <span class="va">summary_countries_wine</span><span class="op">$</span><span class="va">geopol_unit</span>, yes <span class="op">=</span> <span class="st">"yes"</span>, no <span class="op">=</span> <span class="st">"no"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># NOTE: must This also includes manually changing the **United States** to a grape producer.</span>
<span class="co">#change U.S. from no to yes for grapes</span>
<span class="va">countries_summary_future</span><span class="op">$</span><span class="va">grapes</span><span class="op">[</span><span class="va">countries_summary_future</span><span class="op">$</span><span class="va">geopol_unit</span> <span class="op">==</span> <span class="st">"United States"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"yes"</span>

<span class="co">#The factor fixing step is now here</span>
<span class="va">countries_summary_future</span> <span class="op">&lt;-</span> <span class="va">countries_summary_future</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>grapes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">grapes</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span><span class="op">)</span>, wine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">wine</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> 

<span class="co">#now drop NAs for the extracts and add in the other data</span>
<span class="va">countries_summary_future</span> <span class="op">&lt;-</span> <span class="va">countries_summary_future</span> <span class="op">%&gt;%</span>
  <span class="fu">drop_na</span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>, <span class="va">summary_countries_trade_future</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"geopol_unit"</span> <span class="op">=</span> <span class="st">"destination"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co">#trade</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>, <span class="va">summary_countries_wine</span>, by <span class="op">=</span> <span class="st">"geopol_unit"</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co">#wine</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>, <span class="va">summary_countries_grapes</span>, by <span class="op">=</span> <span class="st">"geopol_unit"</span><span class="op">)</span>     <span class="co">#grapes</span>

<span class="co">#deal with NA</span>
<span class="va">countries_summary_future</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">countries_summary_future</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>

<span class="co"># add ID to make is simpler for labeling points</span>
<span class="va">countries_summary_future</span> <span class="op">&lt;-</span> <span class="va">countries_summary_future</span> <span class="op">%&gt;%</span>  <span class="fu">mutate</span><span class="op">(</span>ID <span class="op">=</span> <span class="va">geopol_unit</span><span class="op">)</span>

<span class="co"># add a column for status establishment</span>
<span class="va">countries_summary_future</span> <span class="op">&lt;-</span> <span class="va">countries_summary_future</span> <span class="op">%&gt;%</span>  <span class="fu">mutate</span><span class="op">(</span>status <span class="op">=</span> <span class="st">"not established"</span><span class="op">)</span>
<span class="va">countries_summary_future</span><span class="op">$</span><span class="va">status</span><span class="op">[</span><span class="va">countries_summary_future</span><span class="op">$</span><span class="va">geopol_unit</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"China"</span>, <span class="st">"India"</span>, <span class="st">"Taiwan"</span>, <span class="st">"Vietnam"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"native"</span>
<span class="va">countries_summary_future</span><span class="op">$</span><span class="va">status</span><span class="op">[</span><span class="va">countries_summary_future</span><span class="op">$</span><span class="va">geopol_unit</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Japan"</span>, <span class="st">"South Korea"</span>, <span class="st">"United States"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"established"</span>

<span class="co">#tidy the order of cols</span>
<span class="va">countries_summary_future</span> <span class="op">&lt;-</span> <span class="va">countries_summary_future</span> <span class="op">%&gt;%</span>
    <span class="co">#dplyr::select(ID, geopol_unit, status, grand_mean_max, grand_se_max, wine, grapes, avg_wine:log10_avg_prod, everything())</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">geopol_unit</span>, <span class="va">status</span>, <span class="va">grand_mean_max</span>, <span class="va">wine</span>, <span class="va">grapes</span>, <span class="va">avg_wine</span><span class="op">:</span><span class="va">log10_avg_prod</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<hr>
</div>
<div id="save-data" class="section level1">
<h1 class="hasAnchor">
<a href="#save-data" class="anchor"></a>Save data</h1>
<p>This section provides the code to save each of the final summary objects to the <code>/data</code> directory. They are currently set to not run, as the package <strong>should</strong> ship with the files already in <code>/data</code>. Note that this chunk can be run by setting the top <code>if</code> from <code>FALSE</code> to <code>TRUE</code>!</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">states_summary_present</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"states_summary_present.rda"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">states_summary_future</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"states_summary_future.rda"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">countries_summary_present</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"countries_summary_present.rda"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">countries_summary_future</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"countries_summary_future.rda"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span>
<span class="va">states_summary_future_ensemble</span> <span class="op">&lt;-</span> <span class="va">states_summary_future</span>
<span class="va">states_summary_present_ensemble</span> <span class="op">&lt;-</span> <span class="va">states_summary_present</span>
<span class="va">countries_summary_future_ensemble</span> <span class="op">&lt;-</span> <span class="va">countries_summary_future</span>
<span class="va">countries_summary_present_ensemble</span> <span class="op">&lt;-</span> <span class="va">countries_summary_present</span>
  
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">states_summary_future_ensemble</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"states_summary_future_ensemble.rda"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">states_summary_present_ensemble</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"states_summary_present_ensemble.rda"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">countries_summary_future_ensemble</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"countries_summary_future_ensemble.rda"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">countries_summary_present_ensemble</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"countries_summary_present_ensemble.rda"</span><span class="op">)</span><span class="op">)</span>

<span class="op">}</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicholas A. Huron, Jocelyn E. Behm, Matthew R. Helmus.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
