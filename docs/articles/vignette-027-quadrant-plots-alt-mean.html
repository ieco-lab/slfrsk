<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Invasion Potential Alignment Alternative (Mean) â€¢ slfrsk</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Invasion Potential Alignment Alternative (Mean)">
<meta property="og:description" content="slfrsk">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">slfrsk</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/vignette-001-overview.html">Overview</a>
</li>
<li>
  <a href="../articles/vignette-002-terms.html">Definitions</a>
</li>
<li>
  <a href="../articles/vignette-040-ee-data.html">Paninvasion Severity App</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Analyses
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li>
      <a href="../articles/vignette-003-get-gbif-data.html">Get GBIF Records</a>
    </li>
    <li>
      <a href="../articles/vignette-010-tidy-data.html">Data Tidying</a>
    </li>
    <li>
      <a href="../articles/vignette-011-suitability-models.html">Suitability Modeling &amp; Evaluation</a>
    </li>
    <li>
      <a href="../articles/vignette-030-potentials-maps.html">Invasion Potentials Maps</a>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Invasion Potential Alignment</a>
      <ul class="dropdown-menu" role="menu">
<li class="divider">
        <li>
          <a href="../articles/vignette-021-quadrant-plots.html">Published (Max)</a>
        </li>
        <li>
          <a href="../articles/vignette-026-quadrant-plots-alt-median.html">Alternate (Median)</a>
        </li>
        <li>
          <a href="../articles/vignette-027-quadrant-plots-alt-mean.html">Alternate (Mean)</a>
        </li>
        <li class="divider">
      </ul>
</li>
    <li>
      <a href="../articles/vignette-041-market-plot.html">Wine Market Shock Severity Evaluation</a>
    </li>
    <li class="divider">
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ieco-lab/slfrsk">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="vignette-027-quadrant-plots-alt-mean_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Invasion Potential Alignment Alternative (Mean)</h1>
            
      
      
      <div class="hidden name"><code>vignette-027-quadrant-plots-alt-mean.Rmd</code></div>

    </div>

    
    
<p>Build and Save Risk Correlation Quadrant Plots (Ensemble Extracts, Alternate Extraction Data)</p>
<div id="load-required-packages-and-set-the-same-settings" class="section level1">
<h1 class="hasAnchor">
<a href="#load-required-packages-and-set-the-same-settings" class="anchor"></a>1. Load required packages and set the same settings</h1>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">slfrsk</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggrepel</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">grid</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">gridExtra</span>)</pre></body></html></div>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># Make transport scaled between one and zero</span>
<span class="no">one_zero</span> <span class="kw">&lt;-</span> <span class="fl">TRUE</span>

<span class="co"># switch between present or future transport</span>
<span class="no">present_transport</span> <span class="kw">&lt;-</span> <span class="fl">TRUE</span>

<span class="co"># Set what type of multiple correlation to calculate</span>
<span class="no">method_cor</span> <span class="kw">&lt;-</span> <span class="st">"spearman"</span>

<span class="co"># set whether to look at grape or wine production (PLOT LABELS ARE NOT CLEAN FOR WINE!!!)</span>
<span class="co">#impact_prod &lt;- "wine"</span>
<span class="no">impact_prod</span> <span class="kw">&lt;-</span> <span class="st">"grapes"</span>

<span class="co"># Plot the native countries?</span>
<span class="no">native</span> <span class="kw">&lt;-</span> <span class="fl">TRUE</span>

<span class="co"># remove USA?</span>
<span class="no">rem_usa</span> <span class="kw">&lt;-</span> <span class="fl">TRUE</span>

<span class="co"># Replace this with max mean quantile_0.50 quantile_0.75 quantile_0.90 to edit which metric to plot for establishment</span>
<span class="co">#estab_to_plot &lt;- "obs_max" # max was used for the quadrant figures</span>
<span class="no">estab_to_plot</span> <span class="kw">&lt;-</span> <span class="st">"obs_mean"</span>
<span class="co">#estab_to_plot &lt;- "quantile_0.50" #median</span></pre></body></html></div>
</div>
<div id="load-the-full-suitability-extract-ensemble-data-and-the-summary_future-data-states-and-countries-" class="section level1">
<h1 class="hasAnchor">
<a href="#load-the-full-suitability-extract-ensemble-data-and-the-summary_future-data-states-and-countries-" class="anchor"></a>2. Load the full <code>suitability extract ensemble</code> data and the <code>summary_future</code> data (<code>states</code> and <code>countries</code>).</h1>
<p>Join the two dataframes and resolve conflicts. Use the <code>summary_future</code> data to lead the merging with <code>left_join()</code>.</p>
<ul>
<li>mean suitability</li>
<li>median suitability</li>
</ul>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co">#suitability data load</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"states_extracts_ensemble"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"countries_extracts_ensemble"</span>)

<span class="co">#summary data load</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"states_summary_present_ensemble"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"countries_summary_present_ensemble"</span>)

<span class="co">#join the data</span>
<span class="no">states_summary_present_ensemble</span> <span class="kw">&lt;-</span> <span class="no">states_summary_present_ensemble</span> <span class="kw">%&gt;%</span>
  <span class="fu">left_join</span>(<span class="no">.</span>, <span class="no">states_extracts_ensemble</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"geopol_unit"</span>) <span class="kw">%&gt;%</span>
  <span class="co">#drop grandmeanmax col, it is redundant</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">grand_mean_max</span>)

<span class="no">countries_summary_present_ensemble</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_present_ensemble</span> <span class="kw">%&gt;%</span>
  <span class="fu">left_join</span>(<span class="no">.</span>, <span class="no">countries_extracts_ensemble</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"geopol_unit"</span>) <span class="kw">%&gt;%</span>
  <span class="co">#drop grandmeanmax col, it is redundant</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">grand_mean_max</span>)

<span class="co">#make it easier to port over parts of the vig-021 code by changing the names</span>
<span class="no">states_summary_present</span> <span class="kw">&lt;-</span>  <span class="no">states_summary_present_ensemble</span>
<span class="no">countries_summary_present</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_present_ensemble</span></pre></body></html></div>
</div>
<div id="drop-the-same-states-and-countries-that-we-dropped-in-the-regular-correlation-plot-" class="section level1">
<h1 class="hasAnchor">
<a href="#drop-the-same-states-and-countries-that-we-dropped-in-the-regular-correlation-plot-" class="anchor"></a>3. Drop the same <code>states</code> and <code>countries</code> that we dropped in the regular correlation plot.</h1>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co">#filter out some No Data for ensemble model</span>
<span class="no">countries_summary_present</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_present</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="no">ID</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Antarctica"</span>, <span class="st">"Monaco"</span>, <span class="st">"Norfolk Island"</span>, <span class="st">"Spratly Islands"</span>))

<span class="kw">if</span>(<span class="no">rem_usa</span>){ <span class="co"># TRUE if you want to remove the USA</span>
  <span class="no">rems</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Akrotiri and Dhekelia"</span>
            ,<span class="st">"?land"</span>
            ,<span class="st">"American Samoa"</span>
            ,<span class="st">"Bouvet Island"</span>
            ,<span class="st">"British Indian Ocean Territory"</span>
            ,<span class="st">"Caspian Sea"</span>
            ,<span class="st">"Christmas Island"</span>
            ,<span class="st">"Clipperton Island"</span>
            ,<span class="st">"Cocos Islands"</span>
            ,<span class="st">"Falkland Islands"</span>
            ,<span class="st">"Faroe Islands"</span>
            ,<span class="st">"French Southern Territories"</span>
            ,<span class="st">"Heard Island and McDonald Islands"</span>
            ,<span class="st">"Mayotte"</span>
            ,<span class="st">"Northern Mariana Islands"</span>
            ,<span class="st">"Paracel Islands"</span>
            ,<span class="st">"Pitcairn Islands"</span>
            ,<span class="st">"Saint Pierre and Miquelon"</span>
            ,<span class="st">"Tokelau"</span>
            ,<span class="st">"United States Minor Outlying Islands"</span>
            ,<span class="st">"Wallis and Futuna"</span>
            ,<span class="st">"United States"</span>
            ,<span class="st">"Philippines"</span>)
} <span class="kw">else</span> {
  <span class="no">rems</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Akrotiri and Dhekelia"</span>
            ,<span class="st">"?land"</span>
            ,<span class="st">"American Samoa"</span>
            ,<span class="st">"Bouvet Island"</span>
            ,<span class="st">"British Indian Ocean Territory"</span>
            ,<span class="st">"Caspian Sea"</span>
            ,<span class="st">"Christmas Island"</span>
            ,<span class="st">"Clipperton Island"</span>
            ,<span class="st">"Cocos Islands"</span>
            ,<span class="st">"Falkland Islands"</span>
            ,<span class="st">"Faroe Islands"</span>
            ,<span class="st">"French Southern Territories"</span>
            ,<span class="st">"Heard Island and McDonald Islands"</span>
            ,<span class="st">"Mayotte"</span>
            ,<span class="st">"Northern Mariana Islands"</span>
            ,<span class="st">"Paracel Islands"</span>
            ,<span class="st">"Pitcairn Islands"</span>
            ,<span class="st">"Saint Pierre and Miquelon"</span>
            ,<span class="st">"Tokelau"</span>
            ,<span class="st">"United States Minor Outlying Islands"</span>
            ,<span class="st">"Wallis and Futuna"</span>
            ,<span class="st">"Philippines"</span>)

}

<span class="co">#do the rm now</span>
<span class="no">countries_summary_present</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_present</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="no">ID</span> <span class="kw">%in%</span> <span class="no">rems</span>)

<span class="co">#set the native countries</span>
<span class="kw">if</span>(<span class="no">native</span>){
  <span class="no">countries_summary_present</span>$<span class="no">status</span>[<span class="no">countries_summary_present</span>$<span class="no">geopol_unit</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"China"</span>, <span class="st">"India"</span>, <span class="st">"Taiwan"</span>, <span class="st">"Vietnam"</span>)] <span class="kw">&lt;-</span> <span class="st">"native"</span>
} <span class="kw">else</span> {
  <span class="no">countries_summary_present</span>$<span class="no">status</span>[<span class="no">countries_summary_present</span>$<span class="no">geopol_unit</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"China"</span>, <span class="st">"India"</span>, <span class="st">"Taiwan"</span>, <span class="st">"Vietnam"</span>)] <span class="kw">&lt;-</span> <span class="st">"not established"</span>
  }</pre></body></html></div>
</div>
<div id="rescale-the-data-the-same-way-but-also-select-the-metric-to-look-at-" class="section level1">
<h1 class="hasAnchor">
<a href="#rescale-the-data-the-same-way-but-also-select-the-metric-to-look-at-" class="anchor"></a>4. Rescale the data the same way but also select the metric to look at.</h1>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># scale the import data</span>
<span class="kw">if</span>(<span class="no">one_zero</span>){
  <span class="no">states_summary_present</span> <span class="kw">&lt;-</span> <span class="no">states_summary_present</span> <span class="kw">%&gt;%</span>
    <span class="co"># transport</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span>(<span class="no">avg_infected_mass</span>+<span class="fl">1</span>)) <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> (<span class="no">avg_infected_mass_scaled</span> - <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">avg_infected_mass_scaled</span>))) <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="no">avg_infected_mass_scaled</span> / <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">avg_infected_mass_scaled</span>)) <span class="kw">%&gt;%</span>
    <span class="co"># establishment</span>
    <span class="co">#mutate(suitability_scaled = .[[estab_to_plot]])</span>
    <span class="co">#mutate(suitability_scaled = .[[estab_to_plot]] / max(.[[estab_to_plot]])) </span>
    <span class="fu">mutate</span>(<span class="kw">suitability_scaled</span> <span class="kw">=</span> <span class="no">.</span><span class="kw">[[</span><span class="no">estab_to_plot</span>]] - <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">.</span><span class="kw">[[</span><span class="no">estab_to_plot</span>]])) <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">suitability_scaled</span> <span class="kw">=</span> (<span class="no">suitability_scaled</span> / <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">suitability_scaled</span>)))
} <span class="kw">else</span> {
  <span class="no">states_summary_present</span> <span class="kw">&lt;-</span> <span class="no">states_summary_present</span> <span class="kw">%&gt;%</span>
    <span class="co"># transport</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">avg_infected_mass</span>+<span class="fl">1</span>)) <span class="kw">%&gt;%</span>
    <span class="co"># establishment</span>
    <span class="fu">mutate</span>(<span class="kw">suitability_scaled</span> <span class="kw">=</span> <span class="no">.</span><span class="kw">[[</span><span class="no">estab_to_plot</span>]])
}




<span class="kw">if</span>(<span class="no">one_zero</span>){
  <span class="no">countries_summary_present</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_present</span> <span class="kw">%&gt;%</span>
    <span class="co"># transport</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span>(<span class="no">avg_infected_mass</span>+<span class="fl">1</span>)) <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> (<span class="no">avg_infected_mass_scaled</span> - <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">avg_infected_mass_scaled</span>))) <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="no">avg_infected_mass_scaled</span> / <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">avg_infected_mass_scaled</span>)) <span class="kw">%&gt;%</span>
    <span class="co"># establishment</span>
    <span class="co">#mutate(suitability_scaled = .[[estab_to_plot]])</span>
    <span class="co">#mutate(suitability_scaled = .[[estab_to_plot]] / max(.[[estab_to_plot]]))</span>
    <span class="fu">mutate</span>(<span class="kw">suitability_scaled</span> <span class="kw">=</span> <span class="no">.</span><span class="kw">[[</span><span class="no">estab_to_plot</span>]] - <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">.</span><span class="kw">[[</span><span class="no">estab_to_plot</span>]])) <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">suitability_scaled</span> <span class="kw">=</span> (<span class="no">suitability_scaled</span> / <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">suitability_scaled</span>)))
} <span class="kw">else</span> {
  <span class="no">countries_summary_present</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_present</span> <span class="kw">%&gt;%</span>
    <span class="co"># transport</span>
    <span class="fu">mutate</span>(<span class="kw">avg_infected_mass_scaled</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">avg_infected_mass</span>+<span class="fl">1</span>)) <span class="kw">%&gt;%</span>
    <span class="co"># establishment</span>
    <span class="fu">mutate</span>(<span class="kw">suitability_scaled</span> <span class="kw">=</span> <span class="no">.</span><span class="kw">[[</span><span class="no">estab_to_plot</span>]])
}</pre></body></html></div>
</div>
<div id="plotting-settings" class="section level1">
<h1 class="hasAnchor">
<a href="#plotting-settings" class="anchor"></a>5. Plotting settings</h1>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># label both of the countries (or states) with established SLF?</span>
<span class="no">label.countries.est</span> <span class="kw">&lt;-</span> <span class="fl">TRUE</span>
<span class="no">label.states.est</span> <span class="kw">&lt;-</span> <span class="fl">TRUE</span>   <span class="co">#same for both present/future: CT, DE, MD, NJ, OH, WV</span>
<span class="co"># labeling aesthetics for label.countries.est and label.states.est</span>
<span class="no">nudge_countries.est.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.05</span>,<span class="fl">0.05</span>)
<span class="no">nudge_countries.est.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.12</span>,<span class="fl">0.11</span>)
<span class="no">nudge_countries.est_future.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.05</span>,<span class="fl">0.05</span>)  <span class="co">#jpn and kor</span>
<span class="no">nudge_countries.est_future.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.12</span>,<span class="fl">0.11</span>)
<span class="no">nudge_states.est.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">0.00</span>, <span class="fl">0.00</span>, -<span class="fl">0.10</span>,  <span class="fl">0.02</span>, <span class="fl">0.01</span>, <span class="fl">0.00</span>)  <span class="co">#adding OH, CT, DE, MD, NJ, WV</span>
<span class="no">nudge_states.est.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">0.10</span>, -<span class="fl">0.10</span>, <span class="fl">0.10</span>, -<span class="fl">0.17</span>,-<span class="fl">0.15</span>,-<span class="fl">0.10</span>)


<span class="co"># Choose quadrant intercepts</span>
<span class="no">q_intercepts</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">transport</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">establishment</span> <span class="kw">=</span> <span class="fl">0.5</span>)
<span class="co">#set margins</span>
<span class="no">hh</span> <span class="kw">=</span> <span class="fl">.001</span>
<span class="co"># Do not change this flips between plotting the states or plotting countries</span>
<span class="no">plots_which</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">TRUE</span>,<span class="fl">FALSE</span>)
<span class="co"># How many countries and states to highlight for labels?</span>
<span class="no">top_to_plot</span> <span class="kw">&lt;-</span> <span class="fl">10</span>
<span class="co">#color aesthetics</span>
<span class="no">risk_color</span> <span class="kw">&lt;-</span> <span class="st">"gray40"</span>
<span class="no">risk_size</span> <span class="kw">&lt;-</span> <span class="fl">5</span>


<span class="co">#lx &lt;- 0.22</span>
<span class="co">#ly &lt;- 0.25</span>
<span class="co">#hy &lt;- 0.77</span>
<span class="co">#hx &lt;- 0.78</span>
<span class="co">#</span>
<span class="co">#risk_labels &lt;-data.frame(label = c("low\nrisk","moderate\nrisk","moderate\nrisk","high\nrisk"),</span>
<span class="co">#                        x = c(lx,lx,hx,hx),</span>
<span class="co">#                        y = c(ly,hy,ly,hy),</span>
<span class="co">#                        hjust = c(0,0,0,0),</span>
<span class="co">#                        vjust = c(0,0,0,0))</span>

<span class="co">#constant looping var</span>
<span class="no">i</span> <span class="kw">&lt;-</span> <span class="fl">1</span></pre></body></html></div>
</div>
<div id="plotting-code-itself" class="section level1">
<h1 class="hasAnchor">
<a href="#plotting-code-itself" class="anchor"></a>6. Plotting code itself</h1>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">plots_which</span>)) {

  <span class="co">#selects states or countries to plot</span>
  <span class="no">statez</span> <span class="kw">=</span> <span class="no">plots_which</span>[<span class="no">i</span>]

  <span class="co">########################</span>
  <span class="co">#DATA SELECTION STEP</span>
  <span class="co">########################</span>

  <span class="co">#checks whether to use wine or grapes as the impact product to consider</span>
  <span class="kw">if</span>(<span class="no">impact_prod</span> <span class="kw">==</span> <span class="st">"wine"</span>){
    <span class="kw">if</span> (<span class="no">statez</span>) {
        <span class="no">data_to_plot</span> <span class="kw">&lt;-</span> <span class="no">states_summary_present</span>

      <span class="co">#calls the exact variables to plot</span>
      <span class="no">data_to_plot</span> <span class="kw">&lt;-</span> <span class="no">data_to_plot</span> <span class="kw">%&gt;%</span>
        <span class="fu">mutate</span>(
          <span class="kw">x_to_plot</span> <span class="kw">=</span> <span class="no">avg_infected_mass_scaled</span>,
          <span class="kw">y_to_plot</span> <span class="kw">=</span> <span class="no">suitability_scaled</span>,
          <span class="kw">fill_to_plot</span> <span class="kw">=</span> <span class="no">grapes</span>,
          <span class="kw">size_to_plot</span> <span class="kw">=</span> <span class="no">avg_wine</span>,
          <span class="kw">color_to_plot</span> <span class="kw">=</span> <span class="no">status</span>
        ) <span class="kw">%&gt;%</span>
        <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">grapes</span>), (<span class="no">size_to_plot</span>)) <span class="co">#so that the grape producers are on top</span>

      <span class="co">#order the data that gets labeled based on top_to_plot</span>
      <span class="no">data_to_label</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span>(<span class="no">data_to_plot</span>, <span class="no">top_to_plot</span>)  <span class="kw">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">size_to_plot</span>))
      <span class="co">#do welch t.test to assess if transport and establishment have the same relationship with grapes</span>
      <span class="co">#state_grape_t.test &lt;- list(transport = t.test(avg_infected_mass_scaled~grapes, data = data_to_plot),</span>
      <span class="co">#                           establishment = t.test(suitability_scaled~grapes, data = data_to_plot))</span>

      <span class="co">#add infected state labeling if turned on</span>
      <span class="kw">if</span>(<span class="no">label.states.est</span>){
        <span class="co">#PRESENT</span>
         <span class="no">data_to_label_states.est</span> <span class="kw">&lt;-</span> <span class="no">data_to_plot</span> <span class="kw">%&gt;%</span>
          <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">geopol_unit</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Connecticut"</span>, <span class="st">"Delaware"</span>, <span class="st">"Maryland"</span>, <span class="st">"New Jersey"</span>, <span class="st">"Ohio"</span>, <span class="st">"West Virginia"</span>)) <span class="kw">%&gt;%</span>
          <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">size_to_plot</span>))
        <span class="no">data_to_label</span> <span class="kw">&lt;-</span> <span class="fu">bind_rows</span>(<span class="no">data_to_label</span>,<span class="no">data_to_label_states.est</span>)
      } <span class="co">#end of labeling for infected states</span>

    } <span class="kw">else</span> {
      <span class="co">#selects the data to modify for plotting: COUNTRIES and selects the timing</span>
        <span class="no">data_to_plot</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_present</span>

      <span class="no">data_to_plot</span> <span class="kw">&lt;-</span> <span class="no">data_to_plot</span> <span class="kw">%&gt;%</span>
        <span class="fu">mutate</span>(
          <span class="kw">x_to_plot</span> <span class="kw">=</span> <span class="no">avg_infected_mass_scaled</span>,
          <span class="kw">y_to_plot</span> <span class="kw">=</span> <span class="no">suitability_scaled</span>,
          <span class="kw">fill_to_plot</span> <span class="kw">=</span> <span class="no">grapes</span>,
          <span class="kw">size_to_plot</span> <span class="kw">=</span> <span class="no">avg_wine</span>,
          <span class="kw">color_to_plot</span> <span class="kw">=</span> <span class="no">status</span>
        ) <span class="kw">%&gt;%</span>
        <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">grapes</span>), (<span class="no">size_to_plot</span>)) <span class="co">#so that the grape producers are on top</span>
      <span class="no">data_to_label</span> <span class="kw">&lt;-</span>
        <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span>(<span class="no">data_to_plot</span>, <span class="no">top_to_plot</span>)  <span class="kw">%&gt;%</span>
        <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">size_to_plot</span>)) <span class="kw">%&gt;%</span>
        <span class="fu">mutate</span>(
          <span class="kw">ID</span> <span class="kw">=</span> <span class="fu">recode</span>(              <span class="co">#add ISO3 codes for the labeled countries (rather than all)</span>
            <span class="no">ID</span>,
            <span class="kw">Italy</span> <span class="kw">=</span> <span class="st">"ITA"</span>,
            <span class="kw">France</span> <span class="kw">=</span> <span class="st">"FRA"</span>,
            <span class="kw">Spain</span> <span class="kw">=</span> <span class="st">"ESP"</span>,
            <span class="kw">China</span> <span class="kw">=</span> <span class="st">"CHN"</span>,
            <span class="kw">Argentina</span> <span class="kw">=</span> <span class="st">"ARG"</span>,
            <span class="kw">Chile</span> <span class="kw">=</span> <span class="st">"CHL"</span>,
            <span class="kw">Australia</span> <span class="kw">=</span> <span class="st">"AUS"</span>,
            <span class="kw">`South Africa`</span> <span class="kw">=</span> <span class="st">"ZAF"</span>,
            <span class="kw">Germany</span> <span class="kw">=</span> <span class="st">"DEU"</span>,
            <span class="kw">Portugal</span> <span class="kw">=</span> <span class="st">"PRT"</span>
          )
        )

      <span class="co">#do welch t.test to assess if transport and establishment have the same relationship with grapes</span>
      <span class="co">#country_grape_t.test &lt;- list(transport = t.test(avg_infected_mass_scaled~grapes, data = data_to_plot),</span>
      <span class="co">#                             establishment = t.test(suitability_scaled~grapes, data = data_to_plot))</span>
      <span class="kw">if</span>(<span class="no">label.countries.est</span>){
        <span class="no">data_to_label_countries.est</span> <span class="kw">&lt;-</span> <span class="no">data_to_plot</span> <span class="kw">%&gt;%</span>
          <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">geopol_unit</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Japan"</span>, <span class="st">"South Korea"</span>)) <span class="kw">%&gt;%</span>
          <span class="fu">mutate</span>(<span class="kw">ID</span> <span class="kw">=</span> <span class="fu">recode</span>(<span class="no">ID</span>,
                             <span class="kw">Japan</span> <span class="kw">=</span> <span class="st">"JPN"</span>,
                             <span class="kw">`South Korea`</span> <span class="kw">=</span> <span class="st">"KOR"</span>)) <span class="kw">%&gt;%</span>
          <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">size_to_plot</span>))
        <span class="no">data_to_label</span> <span class="kw">&lt;-</span> <span class="fu">bind_rows</span>(<span class="no">data_to_label</span>,<span class="no">data_to_label_countries.est</span>)
      }
    }
  } <span class="kw">else</span> <span class="kw">if</span>(<span class="no">impact_prod</span> <span class="kw">==</span> <span class="st">"grapes"</span>){
    <span class="kw">if</span> (<span class="no">statez</span>) {
      <span class="co">#selects the data to modify for plotting: STATES and chooses the timing</span>
        <span class="no">data_to_plot</span> <span class="kw">&lt;-</span> <span class="no">states_summary_present</span>

      <span class="no">data_to_plot</span> <span class="kw">&lt;-</span> <span class="no">data_to_plot</span> <span class="kw">%&gt;%</span>
        <span class="fu">mutate</span>(
          <span class="kw">x_to_plot</span> <span class="kw">=</span> <span class="no">avg_infected_mass_scaled</span>,
          <span class="kw">y_to_plot</span> <span class="kw">=</span> <span class="no">suitability_scaled</span>,
          <span class="kw">fill_to_plot</span> <span class="kw">=</span> <span class="no">wine</span>,
          <span class="kw">size_to_plot</span> <span class="kw">=</span> <span class="no">avg_prod</span>, <span class="co">#avg_yield or avg_prod are the two options here for grapes</span>
          <span class="kw">color_to_plot</span> <span class="kw">=</span> <span class="no">status</span>
        ) <span class="kw">%&gt;%</span>
        <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">grapes</span>), (<span class="no">size_to_plot</span>)) <span class="co">#so that the grape producers are on top</span>
      <span class="co">#change the zeros to one's for plot size</span>
      <span class="no">data_to_plot</span>$<span class="no">size_to_plot</span>[<span class="no">data_to_plot</span>$<span class="no">size_to_plot</span> <span class="kw">==</span> <span class="fl">0</span>] <span class="kw">&lt;-</span> <span class="fl">1</span>

      <span class="no">data_to_label</span> <span class="kw">&lt;-</span>
        <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span>(<span class="no">data_to_plot</span>, <span class="no">top_to_plot</span>)  <span class="kw">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">size_to_plot</span>))
      <span class="co">#state_grape_t.test &lt;- list(transport = t.test(avg_infected_mass_scaled~grapes, data = data_to_plot),</span>
       <span class="co">#                          establishment = t.test(suitability_scaled~grapes, data = data_to_plot))</span>

            <span class="co">#add infected state labeling if turned on</span>
      <span class="kw">if</span>(<span class="no">label.states.est</span>){
       <span class="co">#PRESENT</span>
          <span class="no">data_to_label_states.est</span> <span class="kw">&lt;-</span> <span class="no">data_to_plot</span> <span class="kw">%&gt;%</span>
          <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">geopol_unit</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Connecticut"</span>, <span class="st">"Delaware"</span>, <span class="st">"Maryland"</span>, <span class="st">"New Jersey"</span>, <span class="st">"Ohio"</span>, <span class="st">"West Virginia"</span>)) <span class="kw">%&gt;%</span>
          <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">size_to_plot</span>))
        <span class="no">data_to_label</span> <span class="kw">&lt;-</span> <span class="fu">bind_rows</span>(<span class="no">data_to_label</span>,<span class="no">data_to_label_states.est</span>)
      } <span class="co">#end of labeling for infected states</span>

    } <span class="kw">else</span> {
      <span class="co">#selects the data to modify for plotting: COUNTRIES and selects the timing</span>
        <span class="no">data_to_plot</span> <span class="kw">&lt;-</span> <span class="no">countries_summary_present</span>

      <span class="no">data_to_plot</span> <span class="kw">&lt;-</span> <span class="no">data_to_plot</span> <span class="kw">%&gt;%</span>
        <span class="fu">mutate</span>(
          <span class="kw">x_to_plot</span> <span class="kw">=</span> <span class="no">avg_infected_mass_scaled</span>,
          <span class="kw">y_to_plot</span> <span class="kw">=</span> <span class="no">suitability_scaled</span>,
          <span class="kw">fill_to_plot</span> <span class="kw">=</span> <span class="no">wine</span>,
          <span class="kw">size_to_plot</span> <span class="kw">=</span> <span class="no">avg_prod</span>, <span class="co">#avg_yield or avg_prod are the two options here for grapes</span>
          <span class="kw">color_to_plot</span> <span class="kw">=</span> <span class="no">status</span>
        ) <span class="kw">%&gt;%</span>
        <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">grapes</span>), (<span class="no">size_to_plot</span>)) <span class="co">#so that the grape producers are on top</span>
      <span class="co">#change the zeros to one's for plot size</span>
      <span class="no">data_to_plot</span>$<span class="no">size_to_plot</span>[<span class="no">data_to_plot</span>$<span class="no">size_to_plot</span> <span class="kw">==</span> <span class="fl">0</span>] <span class="kw">&lt;-</span> <span class="fl">1</span>

      <span class="no">data_to_label</span> <span class="kw">&lt;-</span>
        <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span>(<span class="no">data_to_plot</span>, <span class="no">top_to_plot</span>)  <span class="kw">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">size_to_plot</span>))

      <span class="no">data_to_label</span> <span class="kw">&lt;-</span> <span class="no">data_to_label</span> <span class="kw">%&gt;%</span>
        <span class="fu">mutate</span>(
          <span class="kw">ID</span> <span class="kw">=</span> <span class="fu">recode</span>(
            <span class="no">ID</span>,
            <span class="kw">Egypt</span> <span class="kw">=</span> <span class="st">"EGY"</span>,
            <span class="kw">Peru</span> <span class="kw">=</span> <span class="st">"PER"</span>,
            <span class="kw">India</span> <span class="kw">=</span> <span class="st">"IND"</span>,
            <span class="kw">Albania</span> <span class="kw">=</span> <span class="st">"ALB"</span>,
            <span class="kw">Iraq</span> <span class="kw">=</span> <span class="st">"IRQ"</span>,
            <span class="kw">Brazil</span> <span class="kw">=</span> <span class="st">"BRA"</span>,
            <span class="kw">Thailand</span> <span class="kw">=</span> <span class="st">"THA"</span>,
            <span class="kw">`South Africa`</span> <span class="kw">=</span> <span class="st">"ZAF"</span>,
            <span class="kw">China</span> <span class="kw">=</span> <span class="st">"CHN"</span>,
            <span class="kw">Armenia</span> <span class="kw">=</span> <span class="st">"ARM"</span>,
            <span class="kw">Italy</span> <span class="kw">=</span> <span class="st">"ITA"</span>,
            <span class="kw">Spain</span> <span class="kw">=</span> <span class="st">"ESP"</span>,
            <span class="kw">France</span> <span class="kw">=</span> <span class="st">"FRA"</span>,
            <span class="kw">Turkey</span> <span class="kw">=</span> <span class="st">"TUR"</span>,
            <span class="kw">Chile</span> <span class="kw">=</span> <span class="st">"CHL"</span>,
            <span class="kw">Argentina</span> <span class="kw">=</span> <span class="st">"ARG"</span>,
            <span class="kw">Australia</span> <span class="kw">=</span> <span class="st">"AUS"</span>,
            <span class="kw">`South Korea`</span> <span class="kw">=</span> <span class="st">"KOR"</span>,
            <span class="kw">Japan</span> <span class="kw">=</span> <span class="st">"JPN"</span>
          )
        )

     <span class="co"># country_grape_t.test &lt;- list(transport = t.test(avg_infected_mass_scaled~grapes, data = data_to_plot),</span>
      <span class="co">#                             establishment = t.test(suitability_scaled~grapes, data = data_to_plot))</span>
      <span class="kw">if</span>(<span class="no">label.countries.est</span>){
        <span class="no">data_to_label_countries.est</span> <span class="kw">&lt;-</span> <span class="no">data_to_plot</span> <span class="kw">%&gt;%</span>
          <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">geopol_unit</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Japan"</span>, <span class="st">"South Korea"</span>)) <span class="kw">%&gt;%</span>
          <span class="fu">mutate</span>(<span class="kw">ID</span> <span class="kw">=</span> <span class="fu">recode</span>(<span class="no">ID</span>,
                             <span class="kw">Japan</span> <span class="kw">=</span> <span class="st">"JPN"</span>,
                             <span class="kw">`South Korea`</span> <span class="kw">=</span> <span class="st">"KOR"</span>)) <span class="kw">%&gt;%</span>
          <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">size_to_plot</span>))
        <span class="no">data_to_label</span> <span class="kw">&lt;-</span> <span class="fu">bind_rows</span>(<span class="no">data_to_label</span>,<span class="no">data_to_label_countries.est</span>)
      } <span class="co"># end of if label plotting JPN KOR</span>
    }
  }


<span class="co">########################</span>
<span class="co">#PLOT SETTINGS STEP</span>
<span class="co">########################</span>

<span class="co">#SET ALL OF THE NUDGES FOR LABELS</span>
<span class="co">#need to add the conditional for present transport, since nudging only works based on the data</span>
<span class="kw">if</span>(<span class="no">present_transport</span> <span class="kw">==</span> <span class="fl">FALSE</span>){
  <span class="kw">if</span>(<span class="no">impact_prod</span> <span class="kw">==</span> <span class="st">"wine"</span>){
    <span class="co">#nudging</span>
    <span class="kw">if</span>(<span class="no">statez</span>) { <span class="co">#STATES FUTURE WINE</span>
      <span class="no">nudge.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">.1</span>,-<span class="fl">.1</span>,-<span class="fl">.1</span>,-<span class="fl">.05</span>,-<span class="fl">.1</span>,-<span class="fl">0.05</span>,-<span class="fl">.1</span>,<span class="fl">.06</span>,-<span class="fl">.01</span>,<span class="fl">.05</span>)
      <span class="no">nudge.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.2</span>,<span class="fl">.10</span>,<span class="fl">.10</span>,<span class="fl">.10</span>,<span class="fl">.07</span>,<span class="fl">.15</span>,<span class="fl">.15</span>,-<span class="fl">.07</span>,-<span class="fl">.12</span>,-<span class="fl">.12</span>)    <span class="co">#CA, WA, NY, PA, OR, GA, OH, MI, VA, NC</span>
      <span class="kw">if</span>(<span class="no">label.states.est</span>){
        <span class="no">nudge.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nudge.x</span>, <span class="no">nudge_states.est.x</span>)
        <span class="no">nudge.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nudge.y</span>, <span class="no">nudge_states.est.y</span>)
      }
      <span class="no">ytitle</span> <span class="kw">&lt;-</span> <span class="st">"Establishment Potential"</span>
    } <span class="kw">else</span> {  <span class="co">#COUNTRIES FUTURE WINE</span>
      <span class="no">nudge.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">.3</span>,-<span class="fl">.27</span>,-<span class="fl">.05</span>,-<span class="fl">.26</span>,<span class="fl">.14</span>,<span class="fl">.1</span>,<span class="fl">.20</span>,-<span class="fl">.21</span>,<span class="fl">.08</span>,<span class="fl">.2</span>)
      <span class="no">nudge.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.13</span>, <span class="fl">.095</span>, <span class="fl">.155</span>, <span class="fl">.09</span>, -<span class="fl">.11</span>, <span class="fl">.13</span>, <span class="fl">.15</span>,<span class="fl">.06</span>,-<span class="fl">.1</span>,-<span class="fl">.19</span>)  <span class="co">#ITA, FRA, ESP, CHN, ARG, CHL, AUS, ZAF, DEU, PRT</span>
      <span class="kw">if</span>(<span class="no">label.countries.est</span>) {
        <span class="no">nudge.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nudge.x</span>, <span class="no">nudge_countries.est_future.x</span>) <span class="co">#JPN KOR</span>
        <span class="no">nudge.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nudge.y</span>, <span class="no">nudge_countries.est_future.y</span>) <span class="co">#JPN KOR</span>
      }
      <span class="no">ytitle</span> <span class="kw">&lt;-</span> <span class="st">"Establishment Potential"</span>
    }
  } <span class="kw">else</span> <span class="kw">if</span>(<span class="no">impact_prod</span> <span class="kw">==</span> <span class="st">"grapes"</span>){
    <span class="co">#nudging</span>
    <span class="kw">if</span>(<span class="no">statez</span>) { <span class="co">#STATES FUTURE GRAPES</span>
      <span class="no">nudge.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">.00</span>,-<span class="fl">.05</span>,-<span class="fl">.06</span>,-<span class="fl">.02</span>, <span class="fl">.10</span>,-<span class="fl">.05</span>,-<span class="fl">.01</span>,-<span class="fl">.01</span>,-<span class="fl">.05</span>,-<span class="fl">.03</span>)   <span class="co">#yield: #CA, PA, WA, MI, NY, MO, OH, OR, GA, NC</span>
      <span class="no">nudge.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">.10</span>, <span class="fl">.10</span>, <span class="fl">.08</span>, <span class="fl">.08</span>,-<span class="fl">.05</span>, <span class="fl">.09</span>,-<span class="fl">.10</span>,-<span class="fl">.10</span>, <span class="fl">.09</span>, <span class="fl">.10</span>)   <span class="co">#production: CA, WA, NY, PA, MI, OR, TX, VA, NC, MO</span>
      <span class="kw">if</span>(<span class="no">label.states.est</span>){
        <span class="no">nudge.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nudge.x</span>, <span class="no">nudge_states.est.x</span>)
        <span class="no">nudge.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nudge.y</span>, <span class="no">nudge_states.est.y</span>)
      }
      <span class="no">ytitle</span> <span class="kw">&lt;-</span> <span class="st">"Establishment Potential"</span>
    } <span class="kw">else</span> {  <span class="co">#COUNTRIES FUTURE GRAPES</span>
      <span class="co">#ensemble version</span>
      <span class="co"># grape prod: CHN, ITA, ESP, FRA, TUR, IND, CHL, ARG, ZAF, AUS</span>
      <span class="no">nudge.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">0.00</span>,-<span class="fl">0.00</span>,-<span class="fl">0.01</span>,-<span class="fl">0.02</span>,-<span class="fl">0.00</span>, <span class="fl">0.03</span>,-<span class="fl">0.02</span>, <span class="fl">0.03</span>,-<span class="fl">0.02</span>,-<span class="fl">0.00</span>)
      <span class="no">nudge.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">0.10</span>, <span class="fl">0.085</span>, <span class="fl">0.15</span>, <span class="fl">0.07</span>,-<span class="fl">0.10</span>, <span class="fl">0.05</span>, <span class="fl">0.13</span>,-<span class="fl">0.15</span>, <span class="fl">0.29</span>,-<span class="fl">0.12</span>)
      <span class="co">#old version</span>
      <span class="co"># grape production: CHN, ITA, ESP, FRA, TUR, IND, CHL, ARG, ZAF, AUS</span>
      <span class="co">#nudge.x &lt;- c(-0.01,-0.00,-0.00,-0.04, 0.02,0.03,-0.04, 0.05,-0.03, 0.04)</span>
      <span class="co">#nudge.y &lt;- c(-0.10,-0.20,-0.27, 0.06,-0.24,0.07, 0.11,-0.23, 0.16,-0.10)</span>
      <span class="kw">if</span>(<span class="no">label.countries.est</span>) {
        <span class="no">nudge.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nudge.x</span>, <span class="no">nudge_countries.est_future.x</span>) <span class="co">#JPN KOR</span>
        <span class="no">nudge.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nudge.y</span>, <span class="no">nudge_countries.est_future.y</span>) <span class="co">#JPN KOR</span>
      }
      <span class="no">ytitle</span> <span class="kw">&lt;-</span> <span class="st">"Establishment Potential"</span>
    }
  }
} <span class="kw">else</span> { <span class="co"># grapes above wine below NOTE may not work with labeling JPN and KOR</span>
  <span class="kw">if</span>(<span class="no">impact_prod</span> <span class="kw">==</span> <span class="st">"wine"</span>){
    <span class="kw">if</span>(<span class="no">statez</span>) { <span class="co">#STATES PRESENT WINE</span>
      <span class="no">nudge.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.09</span>,-<span class="fl">.1</span>,-<span class="fl">.04</span>,-<span class="fl">.05</span>,-<span class="fl">.10</span>,-<span class="fl">0.12</span>,-<span class="fl">.1</span>,<span class="fl">.04</span>,-<span class="fl">.01</span>,<span class="fl">.05</span>)
      <span class="no">nudge.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">.10</span>,<span class="fl">.10</span>,<span class="fl">.10</span>,<span class="fl">.10</span>,<span class="fl">.07</span>,<span class="fl">.10</span>,<span class="fl">.12</span>,-<span class="fl">.07</span>,-<span class="fl">.12</span>,-<span class="fl">.12</span>)    <span class="co">#CA, WA, NY, PA, OR, GA, OH, MI, VA, NC</span>
      <span class="kw">if</span>(<span class="no">label.states.est</span>){
        <span class="no">nudge.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nudge.x</span>, <span class="no">nudge_states.est.x</span>)
        <span class="no">nudge.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nudge.y</span>, <span class="no">nudge_states.est.y</span>)
      }
      <span class="no">ytitle</span> <span class="kw">&lt;-</span> <span class="st">"Establishment Potential"</span>
    } <span class="kw">else</span> { <span class="co">#COUNTRIES PRESENT WINE</span>
      <span class="no">nudge.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">.03</span>,-<span class="fl">.10</span>,-<span class="fl">.02</span>,-<span class="fl">.03</span>,<span class="fl">.14</span>,-<span class="fl">.1</span>,-<span class="fl">.23</span>,-<span class="fl">.21</span>,<span class="fl">.08</span>,<span class="fl">.2</span>)
      <span class="no">nudge.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.13</span>, <span class="fl">.09</span>, <span class="fl">.155</span>, <span class="fl">.09</span>, -<span class="fl">.11</span>, <span class="fl">.13</span>, <span class="fl">.15</span>,<span class="fl">.09</span>,-<span class="fl">.08</span>,-<span class="fl">.15</span>)  <span class="co">#ITA, FRA, ESP, CHN, ARG, CHL, AUS, ZAF, DEU, PRT</span>
      <span class="kw">if</span>(<span class="no">label.countries.est</span>) {
        <span class="no">nudge.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nudge.x</span>, <span class="no">nudge_countries.est.x</span>) <span class="co">#JPN KOR</span>
        <span class="no">nudge.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nudge.y</span>, <span class="no">nudge_countries.est.y</span>) <span class="co">#JPN KOR</span>
      }
      <span class="no">ytitle</span> <span class="kw">&lt;-</span> <span class="st">"Establishment Potential"</span>
    }
  } <span class="kw">else</span> <span class="kw">if</span>(<span class="no">impact_prod</span> <span class="kw">==</span> <span class="st">"grapes"</span>){
    <span class="kw">if</span>(<span class="no">statez</span>) { <span class="co">#STATES PRESENT GRAPES</span>
      <span class="no">nudge.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">.00</span>,-<span class="fl">.05</span>,-<span class="fl">.06</span>,-<span class="fl">.02</span>, <span class="fl">.10</span>,-<span class="fl">.05</span>,-<span class="fl">.01</span>,-<span class="fl">.01</span>,-<span class="fl">.05</span>,-<span class="fl">.03</span>)   <span class="co">#yield: #CA, PA, WA, MI, NY, MO, OH, OR, GA, NC</span>
      <span class="no">nudge.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">.10</span>, <span class="fl">.10</span>, <span class="fl">.08</span>, <span class="fl">.08</span>,-<span class="fl">.05</span>, <span class="fl">.09</span>,-<span class="fl">.10</span>,-<span class="fl">.10</span>, <span class="fl">.09</span>, <span class="fl">.10</span>)   <span class="co">#production: CA, WA, NY, PA, MI, OR, TX, VA, NC, MO</span>

      <span class="kw">if</span>(<span class="no">label.states.est</span>){
        <span class="no">nudge.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nudge.x</span>, <span class="no">nudge_states.est.x</span>)
        <span class="no">nudge.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nudge.y</span>, <span class="no">nudge_states.est.y</span>)
      }
      <span class="no">ytitle</span> <span class="kw">&lt;-</span> <span class="st">"Establishment Potential"</span>
    } <span class="kw">else</span> { <span class="co">#COUNTRIES PRESENT GRAPES</span>
            <span class="co">#ensemble version</span>
      <span class="co"># grape prod: CHN, ITA, ESP, FRA, TUR, IND, CHL, ARG, ZAF, AUS</span>
      <span class="no">nudge.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">0.00</span>,-<span class="fl">0.00</span>,-<span class="fl">0.01</span>,-<span class="fl">0.02</span>,-<span class="fl">0.00</span>, <span class="fl">0.03</span>,-<span class="fl">0.02</span>, <span class="fl">0.05</span>,-<span class="fl">0.02</span>, <span class="fl">0.01</span>)
      <span class="no">nudge.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">0.10</span>, <span class="fl">0.08</span>, <span class="fl">0.15</span>, <span class="fl">0.07</span>,-<span class="fl">0.10</span>, <span class="fl">0.05</span>, <span class="fl">0.13</span>,-<span class="fl">0.12</span>, <span class="fl">0.29</span>,-<span class="fl">0.09</span>)
      <span class="co">#nudge.x &lt;- c(-0.01, 0.02, 0.10,-0.04, 0.06,-0.02,-0.07, 0.05,-0.20, 0.11)   #CHN, ITA, ESP, FRA, TUR, IND, CHL, ARG, ZAF, AUS</span>
      <span class="co">#nudge.y &lt;- c( 0.08,-0.08,-0.20, 0.07,-0.02, 0.10, 0.12,-0.09,-0.07,-0.25)</span>
      <span class="kw">if</span>(<span class="no">label.countries.est</span>) {
        <span class="no">nudge.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nudge.x</span>, <span class="no">nudge_countries.est.x</span>) <span class="co">#JPN KOR</span>
        <span class="no">nudge.y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">nudge.y</span>, <span class="no">nudge_countries.est.y</span>) <span class="co">#JPN KOR</span>
      }
      <span class="no">ytitle</span> <span class="kw">&lt;-</span> <span class="st">"Establishment Potential"</span>
    }
  }
}

  <span class="co">#CREATE THE STATES PLOT</span>
  (<span class="no">states_plot</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">data_to_plot</span>) +
      <span class="co">#geom_text(data = risk_labels, mapping = aes(x = x, y = y,label = label), color = risk_color, size = risk_size) +</span>
      <span class="fu">geom_hline</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="no">q_intercepts</span>$<span class="no">establishment</span>, <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">"dashed"</span>) +
      <span class="fu">geom_vline</span>(<span class="kw">xintercept</span> <span class="kw">=</span> <span class="no">q_intercepts</span>$<span class="no">transport</span>, <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">"dashed"</span>) +
      <span class="co">#  geom_abline(intercept = 0, slope = 1, linetype = "solid") + # add one to one</span>
      <span class="fu">geom_rect</span>(<span class="kw">mapping</span> <span class="kw">=</span> <span class="fu">aes</span>(<span class="kw">xmin</span><span class="kw">=</span><span class="fl">1.01</span>, <span class="kw">xmax</span><span class="kw">=</span><span class="fl">1.2</span>, <span class="kw">ymin</span><span class="kw">=</span><span class="fl">.49</span>, <span class="kw">ymax</span><span class="kw">=</span><span class="fl">.5</span>), <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"white"</span>) +
      <span class="fu">geom_rect</span>(<span class="kw">mapping</span> <span class="kw">=</span> <span class="fu">aes</span>(<span class="kw">ymin</span><span class="kw">=</span><span class="fl">1.01</span>, <span class="kw">ymax</span><span class="kw">=</span><span class="fl">1.2</span>, <span class="kw">xmin</span><span class="kw">=</span><span class="fl">.49</span>, <span class="kw">xmax</span><span class="kw">=</span><span class="fl">.51</span>), <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"white"</span>) +
      <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">data_to_label</span>,
                      <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">x_to_plot</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">y_to_plot</span>, <span class="kw">label</span> <span class="kw">=</span> <span class="no">ID</span>),
                      <span class="kw">min.segment.length</span> <span class="kw">=</span> <span class="fl">0</span>,
                      <span class="kw">direction</span> <span class="kw">=</span> <span class="st">"x"</span>,
                      <span class="kw">nudge_y</span> <span class="kw">=</span> <span class="no">nudge.y</span>,
                      <span class="kw">nudge_x</span> <span class="kw">=</span> <span class="no">nudge.x</span>
      ) +
      <span class="fu">geom_point</span>(
        <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">x_to_plot</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">y_to_plot</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">fill_to_plot</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="no">size_to_plot</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">color_to_plot</span>),
        <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">21</span>, <span class="kw">stroke</span> <span class="kw">=</span> <span class="fl">1.3</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.75</span>
      ) +
      <span class="fu">scale_fill_manual</span>(
        <span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"no"</span> <span class="kw">=</span> <span class="st">"#ffffff"</span>, <span class="st">"yes"</span> <span class="kw">=</span> <span class="st">"#C77CFF"</span>),
        <span class="kw">name</span> <span class="kw">=</span> <span class="st">"Wine Production"</span>,
        <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"high"</span>, <span class="st">"low"</span>)
      ) +
      <span class="fu">scale_color_manual</span>(
        <span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
          <span class="st">"red"</span>,
          <span class="st">"black"</span>,
          <span class="st">"blue"</span>),
        <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
          <span class="st">"established"</span>,
          <span class="st">"not established"</span>,
          <span class="st">"native"</span>),
        <span class="kw">name</span> <span class="kw">=</span> <span class="st">"Regional Status"</span>,
        <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"invaded"</span>,<span class="st">"uninvaded"</span>, <span class="st">"native"</span>)
      ) +
      <span class="fu">guides</span>(
        <span class="kw">fill</span> <span class="kw">=</span> <span class="fu">guide_legend</span>(
          <span class="kw">order</span> <span class="kw">=</span> <span class="fl">1</span>,
          <span class="kw">override.aes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">shape</span> <span class="kw">=</span> <span class="fl">22</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">1</span>)
        ),
        <span class="kw">color</span> <span class="kw">=</span> <span class="fu">guide_legend</span>(
          <span class="kw">order</span> <span class="kw">=</span> <span class="fl">3</span>,
          <span class="kw">override.aes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">1</span>)
        ),
        <span class="kw">size</span> <span class="kw">=</span> <span class="fu">guide_legend</span>(    <span class="co"># Adjust size to edit legend grape production</span>
          <span class="kw">order</span> <span class="kw">=</span> <span class="fl">2</span>,            <span class="co"># circles.</span>
          <span class="kw">override.aes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">6</span>), <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">1</span>)
        )
      ) +
      <span class="fu">scale_size_continuous</span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"Grape Production"</span>,
                            <span class="kw">trans</span> <span class="kw">=</span> <span class="st">"log10"</span>,
                            <span class="kw">range</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.5</span>, <span class="fl">6</span>),
                            <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.5</span>,<span class="fl">2</span>,<span class="fl">6</span>),
                            <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"low"</span>, <span class="st">"moderate"</span>, <span class="st">"high"</span>)
      ) +
      <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Transport Potential"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">ytitle</span>) +
      <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span>(<span class="fl">0</span>, <span class="fl">1.2</span>) + <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">xlim</a></span>(<span class="fl">0</span>, <span class="fl">1.2</span>) +
      <span class="fu">theme</span>(
        <span class="kw">panel.grid.major</span> <span class="kw">=</span> <span class="fu">element_line</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="st">"#f0f0f0"</span>),
        <span class="kw">panel.grid.minor</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="co">#panel.grid.major = element_blank(),</span>
        <span class="co">#panel.border = element_rect(colour = "black", fill=NA, size=1),</span>
        <span class="kw">axis.line</span> <span class="kw">=</span> <span class="fu">element_line</span>(<span class="kw">colour</span> <span class="kw">=</span> <span class="st">"black"</span>),
        <span class="kw">legend.position</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.7</span>, <span class="fl">0.25</span>),
        <span class="kw">panel.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">plot.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">legend.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),<span class="co">#element_rect(colour = 'black', fill = 'white', linetype='solid'),</span>
        <span class="kw">axis.text</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fu">rel</span>(<span class="fl">1</span>)),
        <span class="kw">axis.title.x</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">.4</span>),
        <span class="kw">axis.title.y</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">.35</span>),
        <span class="kw">legend.title</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">face</span> <span class="kw">=</span> <span class="st">"plain"</span>),
        <span class="kw">legend.key.size</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>),
        <span class="kw">legend.key</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">plot.margin</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">hh</span>, -<span class="fl">5</span>, <span class="no">hh</span>, <span class="no">hh</span>), <span class="kw">units</span> <span class="kw">=</span> <span class="st">"line"</span>),
        <span class="kw">axis.title</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fu">rel</span>(<span class="fl">1.3</span>))
      ) +
      <span class="fu">scale_x_continuous</span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">.5</span>,<span class="fl">1</span>),<span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"low"</span>, <span class="st">"moderate"</span>, <span class="st">"high"</span>)) +
      <span class="fu">scale_y_continuous</span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">.5</span>,<span class="fl">1</span>),<span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"low"</span>, <span class="st">"moderate"</span>, <span class="st">"high"</span>)) +
      <span class="fu">coord_flip</span>()
  )

  <span class="co">#get the legend</span>
  <span class="no">get_legend</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">myggplot</span>) {
    <span class="no">tmp</span> <span class="kw">&lt;-</span> <span class="fu">ggplot_gtable</span>(<span class="fu">ggplot_build</span>(<span class="no">myggplot</span>))
    <span class="no">leg</span> <span class="kw">&lt;-</span>
      <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">tmp</span>$<span class="no">grobs</span>, <span class="kw">function</span>(<span class="no">x</span>)
        <span class="no">x</span>$<span class="no">name</span>) <span class="kw">==</span> <span class="st">"guide-box"</span>)
    <span class="no">legend</span> <span class="kw">&lt;-</span> <span class="no">tmp</span>$<span class="no">grobs</span><span class="kw">[[</span><span class="no">leg</span>]]
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">legend</span>)
  }
  <span class="co">#plot all of it</span>
  <span class="kw">if</span>(<span class="no">statez</span>) {
    <span class="no">legend_state</span> <span class="kw">&lt;-</span> <span class="no">legend</span> <span class="kw">&lt;-</span> <span class="fu">get_legend</span>(<span class="no">states_plot</span>)
  } <span class="kw">else</span> {
    <span class="no">legend_country</span> <span class="kw">&lt;-</span> <span class="no">legend</span> <span class="kw">&lt;-</span> <span class="fu">get_legend</span>(<span class="no">states_plot</span>)
  }


  (<span class="no">states_plot</span> <span class="kw">&lt;-</span> <span class="no">states_plot</span> + <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>))


  <span class="co">#boxplot: ESTABLISHMENT</span>
  (
    <span class="no">states_box_estab</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>(<span class="no">data_to_plot</span>) +
      <span class="fu">geom_boxplot</span>(
        <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">fill_to_plot</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">y_to_plot</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">fill_to_plot</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">fill_to_plot</span>),
        <span class="kw">show.legend</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
        <span class="kw">outlier.shape</span> <span class="kw">=</span> <span class="fl">NA</span>,
        <span class="kw">notch</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
        <span class="kw">notchwidth</span> <span class="kw">=</span> <span class="fl">.25</span>
      ) +
    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span>(<span class="fl">0</span>, <span class="fl">1</span>) +
      <span class="fu">scale_fill_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"yes"</span> <span class="kw">=</span> <span class="st">"#C77CFF"</span>, <span class="st">"no"</span> <span class="kw">=</span> <span class="st">"#ffffff"</span>), <span class="kw">name</span> <span class="kw">=</span> <span class="st">""</span>) +
      <span class="fu">theme</span>(
        <span class="kw">axis.line</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">axis.text.x</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">axis.text.y</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">axis.ticks</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">axis.title.x</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">axis.title.y</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>,
        <span class="kw">panel.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">panel.border</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">panel.grid.major</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">panel.grid.minor</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">plot.margin</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">hh</span>, <span class="no">hh</span>, <span class="no">hh</span>, <span class="no">hh</span>), <span class="kw">units</span> <span class="kw">=</span> <span class="st">"line"</span>),
        <span class="kw">plot.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>()
      ) +
      <span class="fu">coord_flip</span>()
  )

  <span class="co">#boxplot: INTRODUCTION</span>
  (
    <span class="no">states_box_intro</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>(<span class="no">data_to_plot</span>) +
      <span class="fu">geom_boxplot</span>(
        <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">fill_to_plot</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">x_to_plot</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">fill_to_plot</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">fill_to_plot</span>),
        <span class="kw">show.legend</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
        <span class="kw">outlier.shape</span> <span class="kw">=</span> <span class="fl">NA</span>,
        <span class="kw">notch</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
        <span class="kw">notchwidth</span> <span class="kw">=</span> <span class="fl">.25</span>
      ) +
      <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"  "</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="kw">NULL</span>) +
      <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span>(<span class="fl">0</span>, <span class="fl">1</span>) +
      <span class="fu">scale_fill_manual</span>(
        <span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"yes"</span> <span class="kw">=</span> <span class="st">"#C77CFF"</span>, <span class="st">"no"</span> <span class="kw">=</span> <span class="st">"#ffffff"</span>),
        <span class="kw">name</span> <span class="kw">=</span> <span class="st">""</span>
      ) +
      <span class="fu">theme</span>(
        <span class="kw">axis.line</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">axis.text.x</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">axis.text.y</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">axis.ticks</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">axis.title.x</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>,
        <span class="kw">panel.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">panel.border</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">panel.grid.major</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">panel.grid.minor</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">plot.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>(),
        <span class="kw">plot.margin</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">hh</span>, <span class="no">hh</span>, <span class="no">hh</span>, <span class="no">hh</span>), <span class="kw">units</span> <span class="kw">=</span> <span class="st">"line"</span>)
      )
  )


  (
    <span class="no">states_plot_final</span> <span class="kw">&lt;-</span> <span class="no">states_plot</span> +
      <span class="fu">annotation_custom</span>(
        <span class="kw">grob</span> <span class="kw">=</span> <span class="fu">ggplotGrob</span>(<span class="no">states_box_estab</span>),
        <span class="kw">xmin</span> <span class="kw">=</span> <span class="fl">1.01</span>,
        <span class="kw">xmax</span> <span class="kw">=</span> <span class="fl">1.11</span>,
        <span class="kw">ymin</span> <span class="kw">=</span> -<span class="fl">Inf</span>,
        <span class="kw">ymax</span> <span class="kw">=</span> <span class="fl">1.05</span>
      ) +
      <span class="co"># Insert ybp_grob inside the scatter plot</span>
      <span class="fu">annotation_custom</span>(
        <span class="kw">grob</span> <span class="kw">=</span> <span class="fu">ggplotGrob</span>(<span class="no">states_box_intro</span>),
        <span class="kw">xmin</span> <span class="kw">=</span> -<span class="fl">.1</span>,
        <span class="kw">xmax</span> <span class="kw">=</span> <span class="fl">1.05</span>,
        <span class="kw">ymin</span> <span class="kw">=</span> <span class="fl">1</span>,
        <span class="kw">ymax</span> <span class="kw">=</span> <span class="fl">1.1</span>
      ) +

      <span class="fu">annotation_custom</span>(
        <span class="kw">grob</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/grid.rect.html">rectGrob</a></span>(<span class="kw">gp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="st">"white"</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"white"</span>)),
        <span class="kw">xmin</span> <span class="kw">=</span> -<span class="fl">1</span>,
        <span class="kw">xmax</span> <span class="kw">=</span> <span class="fl">1.21</span>,
        <span class="kw">ymin</span> <span class="kw">=</span> <span class="fl">1.1</span>,
        <span class="kw">ymax</span> <span class="kw">=</span> <span class="fl">1.21</span>
      ) +
      <span class="fu">annotation_custom</span>(
        <span class="kw">grob</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/grid.rect.html">rectGrob</a></span>(<span class="kw">gp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="st">"white"</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"white"</span>)),
        <span class="kw">ymin</span> <span class="kw">=</span> -<span class="fl">1</span>,
        <span class="kw">ymax</span> <span class="kw">=</span> <span class="fl">1.21</span>,
        <span class="kw">xmin</span> <span class="kw">=</span> <span class="fl">1.11</span>,
        <span class="kw">xmax</span> <span class="kw">=</span> <span class="fl">1.21</span>
      ) +
      <span class="fu">scale_x_continuous</span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">.5</span>,<span class="fl">1</span>),<span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"low"</span>, <span class="st">"moderate"</span>, <span class="st">"high"</span>), <span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1.15</span>)) +
      <span class="fu">scale_y_continuous</span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">.5</span>,<span class="fl">1</span>),<span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"low"</span>, <span class="st">"moderate"</span>, <span class="st">"high"</span>), <span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1.15</span>))
  )

  <span class="no">g</span> <span class="kw">&lt;-</span> <span class="fu">ggplotGrob</span>(<span class="no">states_plot_final</span>)
  <span class="no">g</span>$<span class="no">layout</span>$<span class="no">clip</span>[<span class="no">g</span>$<span class="no">layout</span>$<span class="no">name</span> <span class="kw">==</span> <span class="st">"panel"</span>] <span class="kw">&lt;-</span> <span class="st">"off"</span>
  <span class="co">#g$layout</span>
  <span class="no">g</span>$<span class="no">layout</span>$<span class="no">z</span>[<span class="no">g</span>$<span class="no">layout</span>$<span class="no">name</span> <span class="kw">==</span> <span class="st">"panel"</span>] <span class="kw">&lt;-</span> <span class="fl">17</span> <span class="co"># Note that z for panel is 1.  Change it to something bigger.</span>

<span class="co">#Correlation Analysis</span>
  <span class="co"># present or future</span>
 <span class="kw">if</span>(<span class="no">present_transport</span>){
    <span class="kw">if</span> (<span class="no">statez</span>) { <span class="co">#states present</span>
      <span class="no">states_grob</span> <span class="kw">&lt;-</span> <span class="no">g</span>
    } <span class="kw">else</span> {  <span class="co">#countries present</span>
      <span class="no">countries_grob</span> <span class="kw">&lt;-</span> <span class="no">g</span>
  }
   }  <span class="kw">else</span> {    <span class="co">#future cases</span>
    <span class="kw">if</span> (<span class="no">statez</span>) { <span class="co">#states future</span>
      <span class="no">states_grob</span> <span class="kw">&lt;-</span> <span class="no">g</span>
    } <span class="kw">else</span>{ <span class="co">#countries future</span>
      <span class="no">countries_grob</span> <span class="kw">&lt;-</span> <span class="no">g</span>
      }
            }

<span class="co">#SAVES RESULTS AS PDF</span>
<span class="co">#plot the states+legend and save</span>
<span class="kw">if</span> (<span class="no">statez</span>) {
    <span class="co">#pdf(file.path(here::here(),"vignettes", paste0("states_combined_future_max_",impact_prod,".pdf")),width = 7.5, height = 7)</span>
    <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span>(<span class="no">states_grob</span>, <span class="no">legend_state</span>, <span class="kw">nrow</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">widths</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>,<span class="fl">2</span>), <span class="kw">heights</span> <span class="kw">=</span> <span class="fl">1</span>)
    <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span>(<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>())
} <span class="kw">else</span>{
  <span class="co">#plot the countries+legend</span>
    <span class="co">#pdf(file.path(here::here(),"vignettes", paste0("countries_combined_future_max_",impact_prod,".pdf")),width = 7.5, height = 7)</span>
    <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span>(<span class="no">countries_grob</span>, <span class="no">legend_country</span>, <span class="kw">nrow</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">widths</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>,<span class="fl">2</span>), <span class="kw">heights</span> <span class="kw">=</span> <span class="fl">1</span>)
    <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span>(<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>())
}

} <span class="co"># end of the 2 loop for loop for plotting states and countries</span></pre></body></html></div>
</div>
<div id="display-the-plots" class="section level1">
<h1 class="hasAnchor">
<a href="#display-the-plots" class="anchor"></a>7. Display the plots</h1>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co">#set up a layout grid</span>
  <span class="no">lay1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>,<span class="fl">NA</span>,<span class="fl">NA</span>,<span class="fl">NA</span>),
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>,<span class="fl">NA</span>,<span class="fl">NA</span>,<span class="fl">NA</span>),
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>,<span class="fl">NA</span>, <span class="fl">3</span>, <span class="fl">3</span>),
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">NA</span>,<span class="fl">NA</span>,<span class="fl">NA</span>,<span class="fl">NA</span>, <span class="fl">3</span>, <span class="fl">3</span>),
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>,<span class="fl">NA</span>, <span class="fl">3</span>, <span class="fl">3</span>),
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>,<span class="fl">NA</span>,<span class="fl">NA</span>,<span class="fl">NA</span>),
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>,<span class="fl">NA</span>,<span class="fl">NA</span>,<span class="fl">NA</span>)
  )

<span class="co">#nice version for knitting</span>
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span>(<span class="no">states_grob</span>, <span class="no">countries_grob</span>, <span class="no">legend_country</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">7</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">6</span>, <span class="kw">layout_matrix</span> <span class="kw">=</span> <span class="no">lay1</span>, <span class="kw">heights</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>), <span class="kw">widths</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0.1</span>,<span class="fl">0.6</span>,<span class="fl">0.6</span>))</pre></body></html></div>
<p><img src="vignette-027-quadrant-plots-alt-mean_files/figure-html/plot%20viz-1.png" width="960"></p>
</div>
<div id="get-and-print-the-correlations" class="section level1">
<h1 class="hasAnchor">
<a href="#get-and-print-the-correlations" class="anchor"></a>8. Get and print the correlations</h1>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co">#grapes</span>
<span class="co">#STATES</span>

<span class="co">#build model</span>
<span class="no">states_grapes_impact_model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="kw">formula</span> <span class="kw">=</span> <span class="no">log10_avg_prod</span> ~ <span class="no">avg_infected_mass_scaled</span> + <span class="no">suitability_scaled</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">states_summary_present</span>)
<span class="co">#do cor</span>
<span class="no">states_grapes_impact_cor</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html">cor.test</a></span>(<span class="no">states_grapes_impact_model</span>$<span class="no">model</span>$<span class="no">log10_avg_prod</span>, <span class="no">states_grapes_impact_model</span>$<span class="no">fitted.values</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="no">method_cor</span>)

<span class="co">#COUNTRIES</span>
<span class="co">#build model</span>
<span class="no">countries_grapes_impact_model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="kw">formula</span> <span class="kw">=</span> <span class="no">log10_avg_prod</span> ~ <span class="no">avg_infected_mass_scaled</span> + <span class="no">suitability_scaled</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">countries_summary_present</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="no">ID</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"United States"</span>,
                      <span class="st">"China"</span>,
                      <span class="st">"India"</span>,
                      <span class="st">"Taiwan"</span>,
                      <span class="st">"Japan"</span>,
                      <span class="st">"South Korea"</span>,
                      <span class="st">"Vietnam"</span>)))
<span class="co">#do cor</span>
<span class="no">countries_grapes_impact_cor</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html">cor.test</a></span>(<span class="no">countries_grapes_impact_model</span>$<span class="no">model</span>$<span class="no">log10_avg_prod</span>, <span class="no">countries_grapes_impact_model</span>$<span class="no">fitted.values</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="no">method_cor</span>)

<span class="co">#wine</span>
<span class="co">#STATES</span>
<span class="co">#model</span>
<span class="no">states_wine_impact_model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="kw">formula</span> <span class="kw">=</span> <span class="no">log10_avg_wine</span> ~ <span class="no">avg_infected_mass_scaled</span> + <span class="no">suitability_scaled</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">states_summary_present</span>)
<span class="co">#cor</span>
<span class="no">states_wine_impact_cor</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html">cor.test</a></span>(<span class="no">states_wine_impact_model</span>$<span class="no">model</span>$<span class="no">log10_avg_wine</span>, <span class="no">states_wine_impact_model</span>$<span class="no">fitted.values</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="no">method_cor</span>)

<span class="co">#COUNTRIES</span>
<span class="co">#model</span>
<span class="no">countries_wine_impact_model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="kw">formula</span> <span class="kw">=</span> <span class="no">log10_avg_wine</span> ~ <span class="no">avg_infected_mass_scaled</span> + <span class="no">suitability_scaled</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">countries_summary_present</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="no">ID</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"United States"</span>,
                      <span class="st">"China"</span>,
                      <span class="st">"India"</span>,
                      <span class="st">"Taiwan"</span>,
                      <span class="st">"Japan"</span>,
                      <span class="st">"South Korea"</span>,
                      <span class="st">"Vietnam"</span>)))
<span class="co">#cor</span>
<span class="no">countries_wine_impact_cor</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html">cor.test</a></span>(<span class="no">countries_wine_impact_model</span>$<span class="no">model</span>$<span class="no">log10_avg_wine</span>, <span class="no">countries_wine_impact_model</span>$<span class="no">fitted.values</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="no">method_cor</span>)</pre></body></html></div>
<p>We can report the following alignment of potentials:</p>
<ol style="list-style-type: decimal">
<li><strong>GRAPES</strong></li>
</ol>
<ul>
<li>U.S. State Alignment Correlation = 0.444, p = 1.087 x 10<sup>-03</sup>
</li>
<li>Country Alignment Correlation = 0.605, p = 1.301 x 10<sup>-23</sup>
</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><strong>WINE</strong></li>
</ol>
<ul>
<li>U.S. State Alignment Correlation = 0.611, p = 1.955 x 10<sup>-06</sup>
</li>
<li>Country Alignment Correlation = 0.583, p = 1.033 x 10<sup>-21</sup>
</li>
</ul>
<blockquote>
<p>Note: <strong>grapes</strong> is the plotted impact product and <strong>mean</strong> is the metric of interest.</p>
</blockquote>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicholas A. Huron, Jocelyn E. Behm, Matthew R. Helmus.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
