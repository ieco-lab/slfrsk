<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trade and Regulatory Incident Relationship â€¢ slfrsk</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Trade and Regulatory Incident Relationship">
<meta property="og:description" content="slfrsk">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">slfrsk</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/vignette-001-overview.html">Overview</a>
</li>
<li>
  <a href="../articles/vignette-002-terms.html">Definitions</a>
</li>
<li>
  <a href="../articles/vignette-040-ee-data.html">Paninvasion Severity Assessment App</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Analyses
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    </li>
<li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Step 1: Estimate Invasion Potentials</a>
      <ul class="dropdown-menu" role="menu">
<li class="divider">
        </li>
<li>
          <a href="../articles/vignette-060-spread-figure.html">Identify Invaded States/Reg. Incidents</a>
        </li>
        <li>
          <a href="../articles/vignette-042-trade-presence.html">Confirm SLF--Trade Tonnage Relationship</a>
        </li>
        <li>
          <a href="../articles/vignette-003-get-gbif-data.html">Get GBIF Records</a>
        </li>
        <li>
          <a href="../articles/vignette-010-tidy-data.html">Data Tidying</a>
        </li>
        <li>
          <a href="../articles/vignette-011-suitability-models.html">Species Distribution Modeling</a>
        </li>
        <li class="divider">
      </li>
</ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Step 2: Calculate Alignment Correlations</a>
      <ul class="dropdown-menu" role="menu">
<li class="divider">
        </li>
<li>
          <a href="../articles/vignette-030-potentials-maps.html">Invasion Potential Maps</a>
        </li>
        <li class="dropdown-submenu">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Invasion Potential Alignment</a>
          <ul class="dropdown-menu" role="menu">
<li class="divider">
            </li>
<li>
              <a href="../articles/vignette-021-quadrant-plots.html">Published (Max)</a>
            </li>
            <li>
              <a href="../articles/vignette-026-quadrant-plots-alt-median.html">Alternate (Median)</a>
            </li>
            <li>
              <a href="../articles/vignette-027-quadrant-plots-alt-mean.html">Alternate (Mean)</a>
            </li>
            <li class="divider">
          </li>
</ul>
</li>
        <li class="divider">
      </li>
</ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Step 3: Quantify Paninvasion Risk</a>
      <ul class="dropdown-menu" role="menu">
<li class="divider">
        </li>
<li>
          <a href="../articles/vignette-041-market-plot.html">Paninvasion Risk</a>
        </li>
        <li class="divider">
      </li>
</ul>
</li>
    <li class="divider">
  </li>
</ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ieco-lab/slfrsk" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Trade and Regulatory Incident Relationship</h1>
            
      
      
      <div class="hidden name"><code>vignette-042-trade-presence.Rmd</code></div>

    </div>

    
    
<p>Evaluate if Trade with Established States Relates to Regulatory
Incidents or Establishment</p>
<hr>
<p>This vignette fits a simple logistic regression model in the form of
a binary dependent variable (either <strong>states with regulatory
incidents</strong> or <strong>states with established SLF</strong>) on a
continuous independent variable (trade with established states, mass in
metric tons transformed as <span class="math inline">\(log_{10}(value+1)\)</span>).</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="section level3">
<h3 id="load-packages">Load packages<a class="anchor" aria-label="anchor" href="#load-packages"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#packages to load</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span> <span class="co">#data tidying</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span> <span class="co">#fast pipe assign</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">stargazer</span><span class="op">)</span> <span class="co">#make easy model table for pub</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span> <span class="co">#manipulate by_county</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span> <span class="co">#easy relative pathing</span></span>
<span></span>
<span>  <span class="co">#packages to use to extract raw data</span></span>
<span><span class="co">#library(lubridate) #extract years</span></span>
<span><span class="co">#library(tigris) #county level shapefiles</span></span>
<span><span class="co">#library(lycormap) #package to get tinyslf dataset from</span></span>
<span><span class="co">#options(tigris_use_cache = TRUE) # make sure that tigris does not keep downloading the files</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="read-in-trade-data-and-established-states">Read in trade data and established states<a class="anchor" aria-label="anchor" href="#read-in-trade-data-and-established-states"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#data to load</span></span>
<span></span>
<span><span class="co">#slfrsk data (trade)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"states_summary_present_ensemble"</span>, package <span class="op">=</span> <span class="st">"slfrsk"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#recode the established variable as binary</span></span>
<span><span class="va">states_summary_present_ensemble</span> <span class="op">&lt;-</span> <span class="va">states_summary_present_ensemble</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>estab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">status</span> <span class="op">==</span> <span class="st">"established"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ID</span><span class="op">:</span><span class="va">status</span>, <span class="va">estab</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="read-in-slf-reporting-data">Read in SLF reporting data<a class="anchor" aria-label="anchor" href="#read-in-slf-reporting-data"></a>
</h3>
<p>The data used here for the spread figure are based on an upcoming
suite of packages (<code>lycodata</code> and <code>lycormap</code>)
produced by the iEcoLab. The records in these packages contain data that
are not yet available to the public, so all questions regarding the raw
data should be directed to the creator of the <code>lycor*</code> suite,
Seba De Bona (SDB, (<a href="mailto:sebastiano.debona@temple.edu">sebastiano.debona@temple.edu</a>))
or to Matthew R. Helmus (<a href="mailto:mrhelmus@temple.edu">mrhelmus@temple.edu</a>).</p>
<p>Notably these data are used only to get regulatory events. The
<code>slfrsk</code> data already has established states, but it lacks
the states that have regulatory events recorded but no established
populations.</p>
<p>Here, we will read in a <code>.rda</code> file that was created using
the example code below from the raw data. These example code chunks are
adapted from SDB code.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#data call</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">by_county</span>, package <span class="op">=</span> <span class="st">"slfrsk"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-code-for-raw-data-to-county-level-data">Example code for raw data to county-level data<a class="anchor" aria-label="anchor" href="#example-code-for-raw-data-to-county-level-data"></a>
</h3>
<div class="section level4">
<h4 id="read-in-county-shapefiles">Read in county shapefiles<a class="anchor" aria-label="anchor" href="#read-in-county-shapefiles"></a>
</h4>
<p>We obtain the counties shapefile as a simple feature (sf) from the
<code>tigris</code> package.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counties</span> <span class="op">&lt;-</span> <span class="fu">counties</span><span class="op">(</span>cb <span class="op">=</span> <span class="cn">T</span>, resolution <span class="op">=</span> <span class="st">"5m"</span><span class="op">)</span></span></code></pre></div>
<p>Now, we read in the SLF records from the package
<code>lycormap</code>. We also obtain the supplemental SLF records that
contain the updated transportation data for uninvaded states, which was
obtained from the raw data in the <code>lycodata</code> package. At the
time of publication of <code>slfrsk</code>, additional data were saved
as raw data that comes with <code>lycordata</code>
(<code>slf_county_record_timeline.csv</code>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"tinyslf"</span>, package <span class="op">=</span> <span class="st">"lycormap"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># reading manually added data (for a later step)</span></span>
<span><span class="va">man_county_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">".."</span>, <span class="st">".."</span>, <span class="st">"lycordata"</span>, <span class="st">"data-raw"</span>, <span class="st">"additional"</span>, <span class="st">"slf_county_record_timeline.csv"</span><span class="op">)</span>,</span>
<span>                            col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html" class="external-link">cols</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="st">"c"</span>, FIPS <span class="op">=</span> <span class="st">"d"</span>, </span>
<span>                                          RT_check <span class="op">=</span> <span class="st">"l"</span>, ST_check <span class="op">=</span> <span class="st">"l"</span>, RS_match <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="merge-and-clean-data">Merge and clean data<a class="anchor" aria-label="anchor" href="#merge-and-clean-data"></a>
</h4>
<div class="section level5">
<h5 id="tinyslf">tinyslf<a class="anchor" aria-label="anchor" href="#tinyslf"></a>
</h5>
<p>This code finds the county that each presence point corresponds to
and attaches the county shapefile data to those rows. It also removes
records that do not fall in a U.S. county (likely erroneous records). We
also remove an errant record for Wasatch county, UT.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#adapted from SDB code in lycordata</span></span>
<span></span>
<span><span class="co">#add column of temporary row ID's for later reference</span></span>
<span><span class="va">tinyslf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html" class="external-link">add_column</a></span><span class="op">(</span>row_ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tinyslf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="co"># reducing data to coordinates only, and ID for future merging</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">latitude</span>, <span class="va">longitude</span>, <span class="va">row_ID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># transforming into sf object</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>,</span>
<span>           crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">counties</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co">#intersecting state polygons with data coordinates to match them to U.S. counties</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">counties</span>, join <span class="op">=</span> <span class="va">st_intersects</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co">#make it a tibble now</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co">#simplify to row ID, county name and identity</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">row_ID</span>, county <span class="op">=</span> <span class="va">NAME</span>, <span class="va">GEOID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co">#then joining this into main tinyslf data</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">tinyslf</span>, <span class="va">.</span>, by <span class="op">=</span> <span class="st">"row_ID"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co">#remove the temporary id column</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">row_ID</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#remove the NA values for county. which are the points that do not fall in a county</span></span>
<span><span class="va">tinyslf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">county</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#rm errant Wasatch co, UT record</span></span>
<span><span class="va">tinyslf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">state</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"UT"</span> <span class="op">&amp;</span> <span class="va">county</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Wasatch"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Add the observations and establishment dates to the county outline
data. Now, the earliest year of establishment or recording of an
observation (dead or alive) are identified from the <code>tinyslf</code>
dataset and then added accordingly to county shapefile data. Lastly, the
projection is confirmed.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#get the year of establishment</span></span>
<span><span class="va">by_county</span> <span class="op">&lt;-</span> <span class="va">tinyslf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">GEOID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">slf_established</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>YearOfEstablishment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co">#join to the counties shapefile</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">counties</span>, <span class="va">.</span>, by <span class="op">=</span> <span class="st">"GEOID"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># and add the first record year</span></span>
<span><span class="va">by_county</span> <span class="op">&lt;-</span> <span class="va">tinyslf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">GEOID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">slf_present</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>FirstRecord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co">#join to shapefile that also includes year of establishment</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">by_county</span>, <span class="va">.</span>, by <span class="op">=</span> <span class="st">"GEOID"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># providing correct projections</span></span>
<span><span class="va">by_county</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="st">'+proj=longlat +datum=WGS84'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="slf_county_record_timeline-csv">slf_county_record_timeline.csv<a class="anchor" aria-label="anchor" href="#slf_county_record_timeline-csv"></a>
</h5>
<p>Because our first record and establishment data are constantly
updating from multiple sources, we have a googlesheet that is the source
of <code>man_by_county</code> (saved as
<code>slf_county_record_timeline.csv</code>). We again adapt code from
SDB to tidy and splice these new records into the counties dataset.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#we can use the FIPS code to merge to the main data</span></span>
<span><span class="co">#extract the status and the year of record/establishment</span></span>
<span><span class="co">#there are three date columns that hopefully can be collapsed into 1</span></span>
<span></span>
<span><span class="co">#standardize date format</span></span>
<span><span class="va">man_county_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_at</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span><span class="op">)</span>, .funs <span class="op">=</span> <span class="op">~</span><span class="fu">parsedate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/parsedate/man/parse_date.html" class="external-link">parse_date</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#data can have multiple dates associated to it, meaning a county can have info on when the first record was scored separately from establishment date</span></span>
<span><span class="co">#not all infestations have an establishment data set, so cases where it is absent will be set to 2020 based on when data were analyzed</span></span>
<span><span class="co"># for Date_Alive/Date_Morbound, we'll take the smallest, if both are present</span></span>
<span><span class="va">man_county_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Year_Alive <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">Date_Alive</span><span class="op">)</span>,</span>
<span>         Year_Morbund <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">Date_Morbund</span><span class="op">)</span>,</span>
<span>         Year_FirstRecord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Year_Alive</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Year_Morbund</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">Year_Alive</span>, <span class="va">Year_Morbund</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>                                   <span class="cn">NA</span><span class="op">)</span></span>
<span>         <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Year_Alive</span>, <span class="va">Year_Morbund</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#create two variables that echo those in the by_county for years of first record and establishment</span></span>
<span><span class="va">man_county_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Status</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co">#first grabbing the date (if present) from the Date_Establish or Date_Alive/Morbound columns or setting 2020 to established records without dates</span></span>
<span>  <span class="co">#establishment</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>YearOfEstablishment_man <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>    <span class="co">#if infestation and has a date of establishment</span></span>
<span>    <span class="va">Status</span> <span class="op">==</span> <span class="st">"Infestation"</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Date_Establish</span><span class="op">)</span>,</span>
<span>    <span class="fu">year</span><span class="op">(</span><span class="va">Date_Establish</span><span class="op">)</span>,</span>
<span>    <span class="co">#if infestation and no date, sets to 2020</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Status</span> <span class="op">==</span> <span class="st">"Infestation"</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Date_Establish</span><span class="op">)</span>, <span class="fl">2020</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="co">#first record</span></span>
<span>    FirstRecord_man <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>    <span class="co">#not infested and has a year of first record</span></span>
<span>    <span class="va">Status</span> <span class="op">!=</span> <span class="st">"Infestation"</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Year_FirstRecord</span><span class="op">)</span>,</span>
<span>    <span class="va">Year_FirstRecord</span>,</span>
<span>    <span class="co">#infested and does not have a year of first record is set to 2020</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Status</span> <span class="op">==</span> <span class="st">"Infestation"</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Year_FirstRecord</span><span class="op">)</span>, <span class="fl">2020</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Year_FirstRecord</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="merge-the-two-datasets-to-just-one-county-level-dataset">Merge the two datasets to just one county-level dataset<a class="anchor" aria-label="anchor" href="#merge-the-two-datasets-to-just-one-county-level-dataset"></a>
</h5>
<p>Now that both datasets are cleaned to have years of first record and
establishment, they can be combined. A combined FIPS code is added to
the full county dataset first.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#create combined FIPS columns</span></span>
<span><span class="va">by_county</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>FIPS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">STATEFP</span>, <span class="va">COUNTYFP</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#merge</span></span>
<span><span class="va">by_county</span> <span class="op">&lt;-</span> <span class="va">man_county_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">FIPS</span>, <span class="va">YearOfEstablishment_man</span>, <span class="va">FirstRecord_man</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">by_county</span>, <span class="va">.</span>, by <span class="op">=</span> <span class="st">"FIPS"</span><span class="op">)</span></span></code></pre></div>
<p>There may be some duplicate rows, and so the first record and
establishment rows are retained. This dataset contains incomplete data
for 2021, so we recode these as well, since our data are for as of
2020.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#pick earliest year (between the records mined from the data and the manually compiled records)</span></span>
<span><span class="va">by_county</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>YearOfEstablishment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">YearOfEstablishment</span>, <span class="va">YearOfEstablishment_man</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>         FirstRecord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">FirstRecord</span>, <span class="va">FirstRecord_man</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co">#recode the 2021 data</span></span>
<span>  <span class="co">#get cases where the first record is 2021, and set record to NA</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>FirstRecord <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">FirstRecord</span> <span class="op">==</span> <span class="fl">2021</span> <span class="op">~</span> <span class="cn">NA_real_</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">FirstRecord</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="co">#get cases where the first record or year of establishment is 2021 and set establish to NA</span></span>
<span>  YearOfEstablishment <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">FirstRecord</span> <span class="op">==</span> <span class="fl">2021</span> <span class="op">~</span> <span class="cn">NA_real_</span>,</span>
<span>    <span class="va">YearOfEstablishment</span> <span class="op">==</span> <span class="fl">2021</span> <span class="op">~</span> <span class="cn">NA_real_</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">YearOfEstablishment</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="save-the-cleaned-version-of-county-level-data-as--rda">Save the cleaned version of county-level data as
<code>.rda</code><a class="anchor" aria-label="anchor" href="#save-the-cleaned-version-of-county-level-data-as--rda"></a>
</h4>
<p><code>by_county</code> is now at a safe resolution for our use here.
It is saved as <code>by_county.rda</code> for use in this plotting
vignette.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">by_county</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"by_county.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="get-states-with-regulatory-incidents">Get states with regulatory incidents<a class="anchor" aria-label="anchor" href="#get-states-with-regulatory-incidents"></a>
</h2>
<p>This current version uses the
<code>data(by_country, package = "slfrsk")</code>. Again,
<code>states_summary_present_ensemble</code> comes with established
state data.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#by_county version</span></span>
<span><span class="va">reg_states</span> <span class="op">&lt;-</span> <span class="va">by_county</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">FirstRecord</span><span class="op">)</span> <span class="op">|</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">YearOfEstablishment</span><span class="op">)</span> <span class="op">|</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">FirstRecord_man</span><span class="op">)</span> <span class="op">|</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">YearOfEstablishment_man</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>states <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">STUSPS</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="co">#clear it to just unique values</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">states</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#recode the regulatory event states</span></span>
<span><span class="va">states_summary_present_ensemble</span> <span class="op">&lt;-</span> <span class="va">states_summary_present_ensemble</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>regulatory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">reg_states</span><span class="op">$</span><span class="va">states</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ID</span><span class="op">:</span><span class="va">estab</span>, <span class="va">regulatory</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-the-relationship">Model the relationship<a class="anchor" aria-label="anchor" href="#model-the-relationship"></a>
</h2>
<p>We have two models that we look at, specifically the relationship
between trade with established states AND:</p>
<ol style="list-style-type: decimal">
<li>establishment status as a binary (<code>estab</code>)</li>
<li>regulatory event status (<code>regulatory</code>)</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#logistic regression</span></span>
<span><span class="va">glm.fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">estab</span> <span class="op">~</span> <span class="va">log10_avg_infected_mass</span>, data <span class="op">=</span> <span class="va">states_summary_present_ensemble</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="co">#summarize to see fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">glm.fit1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = estab ~ log10_avg_infected_mass, family = "binomial", </span></span>
<span><span class="co">#&gt;     data = states_summary_present_ensemble)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;      Min        1Q    Median        3Q       Max  </span></span>
<span><span class="co">#&gt; -1.47592  -0.19554  -0.03601  -0.00405   2.02849  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                         Estimate Std. Error z value Pr(&gt;|z|)   </span></span>
<span><span class="co">#&gt; (Intercept)              -42.740     15.266  -2.800  0.00512 **</span></span>
<span><span class="co">#&gt; log10_avg_infected_mass    5.643      2.034   2.774  0.00554 **</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 47.532  on 50  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 19.608  on 49  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 23.608</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 8</span></span>
<span></span>
<span></span>
<span><span class="co">#logistic regression for regulatory event states</span></span>
<span><span class="va">glm.fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">regulatory</span> <span class="op">~</span> <span class="va">log10_avg_infected_mass</span>, data <span class="op">=</span> <span class="va">states_summary_present_ensemble</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="co">#summarize to see fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">glm.fit2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = regulatory ~ log10_avg_infected_mass, family = "binomial", </span></span>
<span><span class="co">#&gt;     data = states_summary_present_ensemble)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -1.6670  -0.6181  -0.2227   0.5172   2.6132  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                         Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)             -21.5407     6.0197  -3.578 0.000346 ***</span></span>
<span><span class="co">#&gt; log10_avg_infected_mass   2.9962     0.8472   3.537 0.000405 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 64.924  on 50  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 38.506  on 49  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 42.506</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 6</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="display-models">Display Models<a class="anchor" aria-label="anchor" href="#display-models"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">star_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/stargazer/man/stargazer.html" class="external-link">stargazer</a></span><span class="op">(</span><span class="va">glm.fit1</span>, <span class="va">glm.fit2</span>, </span>
<span>          type <span class="op">=</span> <span class="st">"html"</span>, </span>
<span>          intercept.bottom <span class="op">=</span> <span class="cn">T</span>,</span>
<span>          ci <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          digits <span class="op">=</span> <span class="fl">2</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"io"</span>,</span>
<span>          <span class="co">#style = "default",</span></span>
<span>          title <span class="op">=</span> <span class="st">"SI Table: Logistic regression of SLF status on trade"</span>,</span>
<span>          out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"/vignettes/logistic_models.doc"</span><span class="op">)</span></span>
<span>          <span class="op">)</span></span></code></pre></div>
<table style="text-align:center" class="table">
<caption>
<strong>SI Table: Logistic regression of SLF status on trade</strong>
</caption>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
estab
</td>
<td>
regulatory
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(1)
</td>
<td>
(2)
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
LOG10_AVG_INFECTED_MASS
</td>
<td>
5.64<sup>***</sup>
</td>
<td>
3.00<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(2.03)
</td>
<td>
(0.85)
</td>
</tr>
<tr>
<td style="text-align:left">
CONSTANT
</td>
<td>
-42.74<sup>***</sup>
</td>
<td>
-21.54<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(15.27)
</td>
<td>
(6.02)
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Observations</em>
</td>
<td>
51
</td>
<td>
51
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Log likelihood</em>
</td>
<td>
-9.80
</td>
<td>
-19.25
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Akaike information criterion</em>
</td>
<td>
23.61
</td>
<td>
42.51
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Notes:</em>
</td>
<td colspan="2" style="text-align:left">
<sup><em><strong></strong></em></sup>p &lt; .01; <sup></sup>p &lt; .05;
<sup></sup>p &lt; .1
</td>
</tr>
</table>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Nicholas A. Huron, Jocelyn E. Behm, Matthew R. Helmus.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
