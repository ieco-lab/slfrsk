<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Invasion Potential Maps â€¢ slfrsk</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Invasion Potential Maps">
<meta property="og:description" content="slfrsk">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">slfrsk</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/vignette-001-overview.html">Overview</a>
</li>
<li>
  <a href="../articles/vignette-002-terms.html">Definitions</a>
</li>
<li>
  <a href="../articles/vignette-040-ee-data.html">Paninvasion Severity Assessment App</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Analyses
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Step 1: Estimate Invasion Potentials</a>
      <ul class="dropdown-menu" role="menu">
<li class="divider">
        <li>
          <a href="../articles/vignette-060-spread-figure.html">Identify Invaded States/Reg. Incidents</a>
        </li>
        <li>
          <a href="../articles/vignette-042-trade-presence.html">Confirm SLF--Trade Tonnage Relationship</a>
        </li>
        <li>
          <a href="../articles/vignette-003-get-gbif-data.html">Get GBIF Records</a>
        </li>
        <li>
          <a href="../articles/vignette-010-tidy-data.html">Data Tidying</a>
        </li>
        <li>
          <a href="../articles/vignette-011-suitability-models.html">Species Distribution Modeling</a>
        </li>
        <li class="divider">
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Step 2: Calculate Alignment Correlations</a>
      <ul class="dropdown-menu" role="menu">
<li class="divider">
        <li>
          <a href="../articles/vignette-030-potentials-maps.html">Invasion Potential Maps</a>
        </li>
        <li class="dropdown-submenu">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Invasion Potential Alignment</a>
          <ul class="dropdown-menu" role="menu">
<li class="divider">
            <li>
              <a href="../articles/vignette-021-quadrant-plots.html">Published (Max)</a>
            </li>
            <li>
              <a href="../articles/vignette-026-quadrant-plots-alt-median.html">Alternate (Median)</a>
            </li>
            <li>
              <a href="../articles/vignette-027-quadrant-plots-alt-mean.html">Alternate (Mean)</a>
            </li>
            <li class="divider">
          </ul>
</li>
        <li class="divider">
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Step 3: Quantify Paninvasion Risk</a>
      <ul class="dropdown-menu" role="menu">
<li class="divider">
        <li>
          <a href="../articles/vignette-041-market-plot.html">Paninvasion Risk</a>
        </li>
        <li class="divider">
      </ul>
</li>
    <li class="divider">
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ieco-lab/slfrsk">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="vignette-030-potentials-maps_files/header-attrs-2.14/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Invasion Potential Maps</h1>
            
      
      
      <div class="hidden name"><code>vignette-030-potentials-maps.Rmd</code></div>

    </div>

    
    
<p>Build and Save Maps of Transport and Establishment Potential</p>
<hr>
<p>This vignette produces the published map figures that demonstrate
where <strong>SLF</strong> is most likely to become established, the
states and countries that trade most with the <code>present</code>
scenario infected states, and shows locations of important viticultural
areas (areas of high <strong>impact</strong> potential).</p>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>Here we load the packages required to visualize the maps.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">slfrsk</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/rgeos/">rgeos</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span></code></pre></div>
<div id="toggle-plotting-options" class="section level2">
<h2 class="hasAnchor">
<a href="#toggle-plotting-options" class="anchor"></a>Toggle plotting options</h2>
<p>As in <code>vignette-021-quadrant-plots</code>, we have several
parameters that can be modified to visualize different versions of the
figures. Here is where one could change the version of data for the map
figures via the following:</p>
<ol style="list-style-type: decimal">
<li>present_transport: Use <code>present</code> or <code>future</code>
infected U.S. states?
<ul>
<li>default is <code>TRUE</code> for <code>present</code>
</li>
</ul>
</li>
<li>top_to_plot: Set the number of top <strong>transport</strong>
potential partners to plot arrows for?
<ul>
<li>default is <code>10</code>
</li>
</ul>
</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#we need a switch for this map that does the same thing for including the following states: North Carolina</span>
<span class="va">present_transport</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>
<span class="co"># How many countries and states to highlight for labels?</span>
<span class="va">top_to_plot</span> <span class="op">&lt;-</span> <span class="fl">10</span> </code></pre></div>
<p>To build the map plots, we have several sources of data that we need
to read in, namely:</p>
<ol style="list-style-type: decimal">
<li>viticultural area geographic locations</li>
<li>suitability maps for <code>U.S. states</code> and all
<code>countries</code> from the ensemble model</li>
<li>locations to point to trade partners (capital cities of
<code>states</code> and <code>countries</code>)</li>
</ol>
<p>Of note, the actual trade data (<strong>transport</strong> potential)
will be read conditionally in a later chunk below.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#location of wineries (U.S. and COUNTRIES)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"wineries"</span><span class="op">)</span>
<span class="co">#need usa enviro raster</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"suitability_usa_df"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"suitability_countries_df"</span><span class="op">)</span>
<span class="co">#state centers for plot</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"states_centers"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"countries_centers"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="data-preparation" class="section level1">
<h1 class="hasAnchor">
<a href="#data-preparation" class="anchor"></a>Data preparation</h1>
<p>Now that we have most of the data loaded, we can go ahead and
conditionally load the <strong>transport</strong> potential data based
on the state of <code>present_transport</code>. The
<strong>transport</strong> potential data for <code>states</code> and
<code>countries</code> are then combined with the appropriate trade
partner coordinate data and an approximate center of the
<strong>SLF</strong> invasion in the U.S. is added as an origin for
depicting trade arrows in the map figures. The <code>states</code> data
are presented first and then the <code>countries</code> thereafter.</p>
<div id="states" class="section level2">
<h2 class="hasAnchor">
<a href="#states" class="anchor"></a>States</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#need states trade data</span>
<span class="co">#need to read in trade data to shape network in map figure</span>
<span class="kw">if</span><span class="op">(</span><span class="va">present_transport</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span>
  <span class="co">#data("states_summary_present")</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"states_summary_present_ensemble"</span><span class="op">)</span>
  <span class="va">states_centers</span> <span class="op">&lt;-</span> <span class="va">states_centers</span> <span class="op">%&gt;%</span>
    <span class="co">#remove the invaded states</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">geopol_unit</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Connecticut"</span>,<span class="st">"Delaware"</span>, <span class="st">"Maryland"</span>, <span class="st">"New Jersey"</span>, <span class="st">"New York"</span>, <span class="st">"Ohio"</span>, <span class="st">"Pennsylvania"</span>, <span class="st">"Virginia"</span>, <span class="st">"West Virginia"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">#remove the others in the dataset</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SLF"</span>, <span class="cn">NA</span>, <span class="fl">40.400189</span>, <span class="op">-</span><span class="fl">75.917622</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>
  
<span class="co">#now add the "invaded core" == SLF as a column</span>
<span class="va">states_summary_present</span> <span class="op">&lt;-</span> <span class="va">states_summary_present_ensemble</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="st">"SLF"</span>, <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>origin <span class="op">=</span> <span class="va">`"SLF"`</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">`"SLF"`</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">origin</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co">#now merge the coords for destinations (ONLY WINE PRODUCING STATES)</span>
<span class="va">states_trade_final</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">states_summary_present</span>, <span class="va">states_centers</span>, by <span class="op">=</span> <span class="st">"geopol_unit"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>

<span class="co">#add the coords for SLF as a separate set of cols</span>
<span class="va">states_trade_final</span> <span class="op">&lt;-</span> <span class="va">states_centers</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">geopol_unit</span> <span class="op">==</span> <span class="st">"SLF"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">x</span>, yend <span class="op">=</span> <span class="va">y</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">xend</span>, <span class="va">yend</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">states_trade_final</span>, <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span>
  
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  <span class="co">#data("states_summary_future")</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"states_summary_future_ensemble"</span><span class="op">)</span>
    <span class="va">states_centers</span> <span class="op">&lt;-</span> <span class="va">states_centers</span> <span class="op">%&gt;%</span>
    <span class="co">#remove the invaded states</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">geopol_unit</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Connecticut"</span>,<span class="st">"Delaware"</span>, <span class="st">"Maryland"</span>, <span class="st">"New Jersey"</span>, <span class="st">"New York"</span>, <span class="st">"North Carolina"</span>, <span class="st">"Ohio"</span>, <span class="st">"Pennsylvania"</span>, <span class="st">"Virginia"</span>, <span class="st">"West Virginia"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">#remove the others in the dataset</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SLF"</span>, <span class="cn">NA</span>, <span class="fl">40.400189</span>, <span class="op">-</span><span class="fl">75.917622</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>

        <span class="co">#now add the "invaded core" == SLF as a column</span>
    <span class="va">states_summary_future</span> <span class="op">&lt;-</span> <span class="va">states_summary_future_ensemble</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="st">"SLF"</span>, <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>origin <span class="op">=</span> <span class="va">`"SLF"`</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">`"SLF"`</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">origin</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
    
    <span class="co">#now merge the coords for destinations (ONLY WINE PRODUCING STATES)</span>
    <span class="va">states_trade_final</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">states_summary_future</span>, <span class="va">states_centers</span>, by <span class="op">=</span> <span class="st">"geopol_unit"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>
    
    <span class="co">#add the coords for SLF as a separate set of cols</span>
    <span class="va">states_trade_final</span> <span class="op">&lt;-</span> <span class="va">states_centers</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">geopol_unit</span> <span class="op">==</span> <span class="st">"SLF"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">x</span>, yend <span class="op">=</span> <span class="va">y</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">xend</span>, <span class="va">yend</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">states_trade_final</span>, <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span>

    <span class="op">}</span></code></pre></div>
</div>
<div id="countries" class="section level2">
<h2 class="hasAnchor">
<a href="#countries" class="anchor"></a>Countries</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">#edit the world centers to also have the SLF U.S. invasion point</span>
<span class="va">countries_centers</span> <span class="op">&lt;-</span> <span class="va">countries_centers</span> <span class="op">%&gt;%</span>
  <span class="co">#rm the others in the dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co">#add center for SLF invasion in U.S.</span>
  <span class="co">#rbind(c("SLF", NA, -75.917622, 40.400189)) %&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"SLF"</span>, times <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>, <span class="op">-</span><span class="fl">75.917622</span>, <span class="fl">40.400189</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co">#(x,y) for coords</span>
  <span class="co">#add the netherlands, not a wine country but needs a set of coords</span>
  <span class="co">#rbind(c("Netherlands", NA, unlist(gCentroid(SpatialPointsDataFrame(map_data('world')[map_data('world')$region %in% "Netherlands",1:2], data = map_data('world')[map_data('world')$region %in% "Netherlands",]))@coords))) %&gt;%</span>
  <span class="co">#same for indonesia</span>
  <span class="co">#rbind(c("Indonesia", NA, unlist(gCentroid(SpatialPointsDataFrame(map_data('world')[map_data('world')$region %in% "Indonesia",1:2], data = map_data('world')[map_data('world')$region %in% "Indonesia",]))@coords))) %&gt;%</span>
  <span class="co">#same for these if going for top 25: Singapore, Taiwan, Saudi Arabia, Vietnam, Venezuela, Gibraltar</span>
  <span class="co">#mutate(x = as.numeric(x), y = as.numeric(y), avg_wine = as.numeric(avg_wine))</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>

<span class="co">#now we manually bump Canada's coords up a little bit to make more visible</span>
<span class="va">countries_centers</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="va">countries_centers</span><span class="op">$</span><span class="va">geopol_unit</span> <span class="op">==</span> <span class="st">"Canada"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">countries_centers</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="va">countries_centers</span><span class="op">$</span><span class="va">geopol_unit</span> <span class="op">==</span> <span class="st">"Canada"</span><span class="op">]</span> <span class="op">+</span> <span class="fl">5</span>


<span class="kw">if</span><span class="op">(</span><span class="va">present_transport</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span>
  <span class="co">#data("countries_summary_present")</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"countries_summary_present_ensemble"</span><span class="op">)</span>
  
  <span class="co">#filter out the countries with SLF</span>
  <span class="va">countries_summary_present</span> <span class="op">&lt;-</span> <span class="va">countries_summary_present_ensemble</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">geopol_unit</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"China"</span>, <span class="st">"Japan"</span>, <span class="st">"Korea, South"</span>, <span class="st">"India"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="st">"SLF"</span>, <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>origin <span class="op">=</span> <span class="va">`"SLF"`</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">`"SLF"`</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">origin</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co">#now merge the coords for destinations (ONLY WINE PRODUCING countries)</span>
<span class="va">countries_trade_final</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">countries_summary_present</span>, <span class="va">countries_centers</span>, by <span class="op">=</span> <span class="st">"geopol_unit"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>


<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  <span class="co">#data("countries_summary_future")</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"countries_summary_future_ensemble"</span><span class="op">)</span>
  
  <span class="co">#filter out the countries with SLF</span>
  <span class="va">countries_summary_future</span> <span class="op">&lt;-</span> <span class="va">countries_summary_future_ensemble</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">geopol_unit</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"China"</span>, <span class="st">"Japan"</span>, <span class="st">"Korea, South"</span>, <span class="st">"India"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="st">"SLF"</span>, <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>origin <span class="op">=</span> <span class="va">`"SLF"`</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">`"SLF"`</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">origin</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

    <span class="co">#now merge the coords for destinations (ONLY WINE PRODUCING countries)</span>
<span class="va">countries_trade_final</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">countries_summary_future</span>, <span class="va">countries_centers</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>
  
<span class="op">}</span>

<span class="co">#add the coords for SLF as a separate set of cols</span>
<span class="va">countries_trade_final</span> <span class="op">&lt;-</span> <span class="va">countries_centers</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">geopol_unit</span> <span class="op">==</span> <span class="st">"SLF"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">x</span>, yend <span class="op">=</span> <span class="va">y</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">xend</span>, <span class="va">yend</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">countries_trade_final</span>, <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="plots" class="section level1">
<h1 class="hasAnchor">
<a href="#plots" class="anchor"></a>Plots</h1>
<p>We are now able to plot both the <code>states</code> and
<code>countries</code> published map figures. We stepwise add in the
different features, beginning with the suitability raster and
geopolitical boundary outlines (the latter ships with
<code>ggplot2</code> in <code>map_data()</code>). We then add <span style="color: red;">red outlines</span> for the U.S. states that have
established <strong>SLF</strong> according to the scenario selected with
<code>present_transport</code>. Following that, <span style="color:#a020f0;">purple points</span> are added for viticultural
areas. Lastly, we add arrows from the approximate center of the
<strong>SLF</strong> invasion in the U.S. to high
<strong>transport</strong> potential trade partners.</p>
<div id="states-1" class="section level2">
<h2 class="hasAnchor">
<a href="#states-1" class="anchor"></a>States</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">#plot just the states and suitability first</span>
<span class="va">map_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">suitability_usa_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html">rescale</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.9</span>, show.legend <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>limits<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Suitability"</span>, colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#e31a1c"</span>,<span class="st">"#fd8d3c"</span>, <span class="st">"#fecc5c"</span>, <span class="st">"#FFFFFF"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">'state'</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_quickmap</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">124.7628</span>, <span class="op">-</span><span class="fl">66.94889</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">24.52042</span>, <span class="fl">49.3833</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span>label <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="co">#add in lines for the infected states</span>
<span class="kw">if</span><span class="op">(</span><span class="va">present_transport</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span>
  <span class="va">map_plot</span> <span class="op">&lt;-</span> <span class="va">map_plot</span> <span class="op">+</span>
    <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">'state'</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Connecticut"</span>,<span class="st">"Delaware"</span>, <span class="st">"Maryland"</span>, <span class="st">"New Jersey"</span>, <span class="st">"New York"</span>, <span class="st">"Ohio"</span>, <span class="st">"Pennsylvania"</span>, <span class="st">"Virginia"</span>, <span class="st">"West Virginia"</span><span class="op">)</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"#e31a1c"</span>, lwd <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span>
    <span class="co">#geom_polygon(data = map_data('state', c("Connecticut","Delaware", "Indiana", "Maryland", "Massachusetts", "New Jersey", "New York", "Ohio", "Pennsylvania", "Virginia", "West Virginia")), aes(x = long, y = lat, group = group), fill = NA, color = "#000000", lwd = 0.75)</span>
  
<span class="op">}</span> <span class="kw">else</span><span class="op">{</span>
  <span class="va">map_plot</span> <span class="op">&lt;-</span> <span class="va">map_plot</span> <span class="op">+</span>
    <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">'state'</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Connecticut"</span>,<span class="st">"Delaware"</span>, <span class="st">"Maryland"</span>, <span class="st">"New Jersey"</span>, <span class="st">"New York"</span>, <span class="st">"North Carolina"</span>, <span class="st">"Ohio"</span>, <span class="st">"Pennsylvania"</span>, <span class="st">"Virginia"</span>, <span class="st">"West Virginia"</span><span class="op">)</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"#e31a1c"</span>, lwd <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">#add in the wine AVA data</span>
<span class="va">map_plot</span> <span class="op">&lt;-</span> <span class="va">map_plot</span> <span class="op">+</span>
    <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">wineries</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Country</span> <span class="op">==</span> <span class="st">"United States"</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"purple"</span>, size <span class="op">=</span> <span class="fl">1.5</span>, shape <span class="op">=</span> <span class="fl">21</span>, alpha <span class="op">=</span> <span class="fl">0.99</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co">#add in the trade</span>
<span class="va">map_plot</span> <span class="op">&lt;-</span> <span class="va">map_plot</span> <span class="op">+</span>
    <span class="fu">geom_curve</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">states_trade_final</span> <span class="op">%&gt;%</span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">avg_infected_mass</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">.</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">top_to_plot</span>,<span class="op">]</span>, size <span class="op">=</span> <span class="fl">1</span>, curvature <span class="op">=</span> <span class="fl">0.33</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, show.legend <span class="op">=</span> <span class="cn">T</span>, color <span class="op">=</span> <span class="st">"#778899"</span>,
               arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>ends <span class="op">=</span> <span class="st">"first"</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="st">"npc"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"closed"</span><span class="op">)</span><span class="op">)</span>

<span class="co">#show it</span>
<span class="va">map_plot</span>
<span class="co">#&gt; Warning: Raster pixels are placed at uneven horizontal intervals and will be</span>
<span class="co">#&gt; shifted. Consider using geom_tile() instead.</span>
<span class="co">#&gt; Warning: Raster pixels are placed at uneven vertical intervals and will be</span>
<span class="co">#&gt; shifted. Consider using geom_tile() instead.</span></code></pre></div>
<p><img src="vignette-030-potentials-maps_files/figure-html/the%20US%20map-1.png" width="768"></p>
</div>
<div id="countries-1" class="section level2">
<h2 class="hasAnchor">
<a href="#countries-1" class="anchor"></a>Countries</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#plot just the countries and suitability first</span>
<span class="va">map_plot_countries</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">suitability_countries_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html">rescale</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.9</span>, show.legend <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_gradientn</span><span class="op">(</span>limits<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Suitability"</span>, colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#e31a1c"</span>,<span class="st">"#fd8d3c"</span>, <span class="st">"#fecc5c"</span>, <span class="st">"#FFFFFF"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">'world'</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_quickmap</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">164.5</span>, <span class="fl">163.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">55</span>,<span class="fl">85</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span>label <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  
<span class="co">#add in lines for the infected states</span>
<span class="kw">if</span><span class="op">(</span><span class="va">present_transport</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span>
  <span class="va">map_plot_countries</span> <span class="op">&lt;-</span> <span class="va">map_plot_countries</span> <span class="op">+</span>
    <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">'state'</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Connecticut"</span>,<span class="st">"Delaware"</span>, <span class="st">"Maryland"</span>, <span class="st">"New Jersey"</span>, <span class="st">"New York"</span>, <span class="st">"Ohio"</span>, <span class="st">"Pennsylvania"</span>, <span class="st">"Virginia"</span>, <span class="st">"West Virginia"</span><span class="op">)</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
<span class="op">}</span> <span class="kw">else</span><span class="op">{</span>
  <span class="va">map_plot_countries</span> <span class="op">&lt;-</span> <span class="va">map_plot_countries</span> <span class="op">+</span>
    <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">'state'</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Connecticut"</span>,<span class="st">"Delaware"</span>, <span class="st">"Maryland"</span>, <span class="st">"New Jersey"</span>, <span class="st">"New York"</span>, <span class="st">"North Carolina"</span>, <span class="st">"Ohio"</span>, <span class="st">"Pennsylvania"</span>, <span class="st">"Virginia"</span>, <span class="st">"West Virginia"</span><span class="op">)</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"#e31a1c"</span>, lwd <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span>
<span class="op">}</span>
  

<span class="co">#add in the wine AVA data (global equivalent)</span>
<span class="va">map_plot_countries</span> <span class="op">&lt;-</span> <span class="va">map_plot_countries</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">wineries</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"purple"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, shape <span class="op">=</span> <span class="fl">21</span>, alpha <span class="op">=</span> <span class="fl">0.99</span>, stroke <span class="op">=</span> <span class="fl">0.2</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co">#add in the trade</span>
<span class="va">map_plot_countries</span> <span class="op">&lt;-</span> <span class="va">map_plot_countries</span> <span class="op">+</span>
  <span class="fu">geom_curve</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">countries_trade_final</span> <span class="op">%&gt;%</span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">avg_infected_mass</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">.</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">top_to_plot</span>,<span class="op">]</span>, size <span class="op">=</span> <span class="fl">0.45</span>, curvature <span class="op">=</span> <span class="fl">0.33</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, show.legend <span class="op">=</span> <span class="cn">T</span>, color <span class="op">=</span> <span class="st">"#778899"</span>, arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>ends <span class="op">=</span> <span class="st">"first"</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="st">"npc"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"closed"</span><span class="op">)</span><span class="op">)</span> 

<span class="co">#print it</span>
<span class="va">map_plot_countries</span> </code></pre></div>
<p><img src="vignette-030-potentials-maps_files/figure-html/plot%20map%20of%20countries-1.png" width="1152"></p>
</div>
</div>
<div id="save-plot-output" class="section level1">
<h1 class="hasAnchor">
<a href="#save-plot-output" class="anchor"></a>Save plot output</h1>
<p>Lastly, we can save the output of our map figure plots as
<code>.pdf</code> files to <code>/vignettes</code>. Note that this chunk
does not run by default but can be run by setting the top
<code>if</code> from <code>FALSE</code> to <code>TRUE</code>!</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">present_transport</span><span class="op">)</span><span class="op">{</span>
<span class="co">#states</span>
  <span class="fu">ggsave</span><span class="op">(</span>plot <span class="op">=</span> <span class="va">map_plot</span>, filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"vignettes"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"states_map_present.pdf"</span><span class="op">)</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">7.5</span>, height <span class="op">=</span> <span class="fl">6.5</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>
<span class="co">#countries</span>
  <span class="fu">ggsave</span><span class="op">(</span>plot <span class="op">=</span> <span class="va">map_plot_countries</span>, filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"vignettes"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"countries_map_present.pdf"</span><span class="op">)</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">7.5</span>, height <span class="op">=</span> <span class="fl">6.5</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>
<span class="op">}</span> <span class="kw">else</span><span class="op">{</span>
  <span class="co">#states</span>
  <span class="fu">ggsave</span><span class="op">(</span>plot <span class="op">=</span> <span class="va">map_plot</span>, filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"vignettes"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"states_map_future.pdf"</span><span class="op">)</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">7.5</span>, height <span class="op">=</span> <span class="fl">6.5</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>
<span class="co">#countries</span>
  <span class="fu">ggsave</span><span class="op">(</span>plot <span class="op">=</span> <span class="va">map_plot_countries</span>, filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"vignettes"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"countries_map_future.pdf"</span><span class="op">)</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">7.5</span>, height <span class="op">=</span> <span class="fl">6.5</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>
<span class="op">}</span>

<span class="op">}</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicholas A. Huron, Jocelyn E. Behm, Matthew R. Helmus.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
